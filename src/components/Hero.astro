---
const {
  eyebrow = "Bản đồ dữ liệu Hòa Lạc",
  title = "Giải mã nhu cầu đất nền Hòa Lạc 2025",
  description = "Tổng hợp quy hoạch, nhịp độ giao dịch và mức độ quan tâm theo phân khúc để bạn định vị sản phẩm nhanh hơn.",
  ctaLabel = "Nhận báo cáo mới",
} = Astro.props;

const baseEnv = import.meta.env.BASE_URL ?? '/';
const basePath = baseEnv.endsWith('/') ? baseEnv.slice(0, -1) : baseEnv;
const blogHref = `${basePath}/blog`;
---
<section class="section-shell section-shell--hero" data-hero>
  <div class="shell-inner hero-grid">
    <div class="hero-copy">
      <p class="tag">{eyebrow}</p>
      <h1>{title}</h1>
      <p class="hero-copy__lead">{description}</p>
      <p class="hero-copy__persona" data-hero-persona>Chọn mục tiêu để cá nhân hóa gợi ý.</p>
      <div class="hero-copy__cta">
        <a class="button" href="#lead-form" data-personalized-cta>{ctaLabel}</a>
        <a class="button button--ghost" href={blogHref}>
          Xem bài phân tích
        </a>
      </div>
    </div>
    <div class="insight-card">
      <div class="pulse-ribbon">
        <span>+312%</span>
        <small>Nhu cầu tìm kiếm 30 ngày</small>
      </div>
      <div class="sparkline" aria-hidden="true">
        <span></span>
      </div>
      <p class="insight-label">Khu CNC & trục Láng - Hòa Lạc</p>
      <div class="insight-grid">
        <article>
          <p>Lead nóng</p>
          <strong>48</strong>
          <small>7 ngày gần nhất</small>
        </article>
        <article>
          <p>Lead ấm</p>
          <strong>132</strong>
          <small>7 ngày gần nhất</small>
        </article>
      </div>
      <footer>
        <p>Được cập nhật 2 giờ trước</p>
      </footer>
    </div>
  </div>
</section>

<style>
  .hero-grid {
    display: grid;
    gap: 2.5rem;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    align-items: center;
  }
  .hero-copy h1 {
    font-size: clamp(2.4rem, 5vw, 3.8rem);
    line-height: 1.1;
    margin: 1.2rem 0;
  }
  .hero-copy__lead {
    font-size: 1.15rem;
    color: var(--muted);
    max-width: 520px;
  }
  .hero-copy__persona {
    margin: 0.75rem 0 0;
    font-weight: 600;
    color: var(--accent-dark);
  }
  .hero-copy__cta {
    margin-top: 2rem;
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }
  .insight-card {
    background: #fff;
    padding: 1.8rem;
    border-radius: 1.5rem;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.08);
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
    position: relative;
    overflow: hidden;
  }
  .pulse-ribbon {
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
    align-items: flex-start;
  }
  .pulse-ribbon span {
    font-size: 2.9rem;
    font-weight: 700;
    color: #0f172a;
  }
  .pulse-ribbon::after {
    content: "";
    width: 70px;
    height: 4px;
    border-radius: 999px;
    background: linear-gradient(90deg, var(--accent), var(--accent-dark));
    animation: pulse 2.8s ease-in-out infinite;
  }
  .pulse-ribbon small {
    color: var(--muted);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
  }
  .sparkline {
    position: relative;
    width: 100%;
    height: 90px;
    background: linear-gradient(135deg, rgba(15, 23, 42, 0.05), rgba(15, 23, 42, 0));
    border-radius: 1rem;
    overflow: hidden;
  }
  .sparkline span {
    position: absolute;
    inset: 0;
    background: url('data:image/svg+xml,%3Csvg width="200" height="80" xmlns="http://www.w3.org/2000/svg"%3E%3Cpolyline points="0,70 30,40 60,60 90,20 120,35 150,15 180,40 200,5" fill="none" stroke="%23d44809" stroke-width="4" stroke-linecap="round"/%3E%3C/svg%3E');
    background-size: 200px 80px;
    animation: scroll-line 6s linear infinite;
    opacity: 0.65;
  }
  .insight-label {
    margin: 0;
    font-weight: 600;
    color: var(--accent-dark);
  }
  .insight-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 1rem;
  }
  .insight-grid article {
    background: #f6f5f2;
    border-radius: 1rem;
    padding: 1rem;
  }
  .insight-grid p {
    margin: 0;
    font-weight: 600;
    color: #0f172a;
  }
  .insight-grid strong {
    display: block;
    font-size: 2rem;
    margin: 0.25rem 0;
  }
  .insight-grid small {
    color: var(--muted);
  }
  .insight-card footer {
    margin-top: auto;
    color: var(--muted);
    font-size: 0.9rem;
  }
  @keyframes pulse {
    0%, 100% {
      opacity: 0.4;
    }
    50% {
      opacity: 1;
    }
  }
  @keyframes scroll-line {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-200px);
    }
  }
</style>

<script type="module">
  const hero = document.querySelector('[data-hero]');
  const persona = hero?.querySelector('[data-hero-persona]');
  const primaryCta = hero?.querySelector('[data-personalized-cta]');

  const intentMessages = {
    o_thuc: {
      persona: 'Đang ưu tiên hạ tầng sống, pháp lý rõ ràng.',
      cta: 'Nhận shortlist khu ở thật'
    },
    dau_tu_trung_han: {
      persona: 'Tập trung suất sinh lời 18-24 tháng.',
      cta: 'Nhận deal đầu tư lọc sẵn'
    },
    luot_song: {
      persona: 'Ưu tiên biên độ giá, thanh khoản nhanh.',
      cta: 'Lọc sản phẩm lướt sóng'
    }
  };

  const updateHero = (intent) => {
    if (!intent || !intentMessages[intent]) return;
    const copy = intentMessages[intent];
    if (persona) {
      persona.textContent = copy.persona;
    }
    if (primaryCta) {
      primaryCta.textContent = copy.cta;
    }
  };

  window.addEventListener('lead-intent-change', (event) => {
    const intent = event?.detail?.intent;
    updateHero(intent);
  });
</script>
