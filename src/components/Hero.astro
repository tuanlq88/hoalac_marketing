---
const {
  eyebrow = "Bản đồ dữ liệu Hòa Lạc",
  title = "Giải mã nhu cầu đất nền Hòa Lạc 2025",
  description = "Tổng hợp quy hoạch, nhịp độ giao dịch và mức độ quan tâm theo phân khúc để bạn định vị sản phẩm nhanh hơn.",
  ctaLabel = "Nhận báo cáo mới",
} = Astro.props;

const baseEnv = import.meta.env.BASE_URL ?? '/';
const basePath = baseEnv.endsWith('/') ? baseEnv.slice(0, -1) : baseEnv;
const blogHref = `${basePath}/blog`;
---
<section class="hero" data-hero>
  <div class="shell-inner hero__grid">
    <div class="hero__copy">
      <p class="hero__eyebrow tag">{eyebrow}</p>
      <h1 class="hero__title">{title}</h1>
      <p class="hero__lead">{description}</p>
      <div class="hero__persona" data-hero-persona>
        Chọn mục tiêu để cá nhân hóa gợi ý.
      </div>
      <ul class="hero__badges">
        <li>Quy hoạch 2026 cập nhật</li>
        <li>Lead funnel tự động</li>
        <li>Snapshot mỗi 12 giờ</li>
      </ul>
      <div class="hero__cta">
        <a class="button" href="#lead-form" data-personalized-cta>{ctaLabel}</a>
        <a class="button button--ghost" href={blogHref}>Xem bài phân tích</a>
      </div>
    </div>

    <div class="hero-panel">
      <header class="hero-panel__header">
        <p>Động lực nhu cầu</p>
        <strong>+312%</strong>
        <small>Nhu cầu tìm kiếm 30 ngày</small>
      </header>
      <div class="hero-panel__sparkline" aria-hidden="true">
        <span></span>
      </div>
      <p class="hero-panel__label">Khu CNC &amp; trục Láng - Hòa Lạc</p>
      <div class="hero-panel__grid">
        <article>
          <p>Lead nóng</p>
          <strong>48</strong>
          <small>7 ngày gần nhất</small>
        </article>
        <article>
          <p>Lead ấm</p>
          <strong>132</strong>
          <small>7 ngày gần nhất</small>
        </article>
        <article>
          <p>Tỷ lệ qualify</p>
          <strong>62%</strong>
          <small>So với trung bình 45%</small>
        </article>
      </div>
      <footer>
        <p>Được cập nhật 2 giờ trước • Funnel MOFU ưu tiên</p>
      </footer>
    </div>
  </div>
</section>

<style>
  .hero {
    padding-top: clamp(2rem, 5vw, 4rem);
    padding-left: clamp(1.5rem, 5vw, 4rem);
    padding-right: clamp(1.5rem, 5vw, 4rem);
    --hero-title: clamp(2.6rem, 2.1rem + 1.6vw, 4.15rem);
    --hero-lead: clamp(1.05rem, 0.95rem + 0.35vw, 1.4rem);
    --hero-badge: clamp(0.85rem, 0.78rem + 0.25vw, 1.05rem);
    --hero-panel-headline: clamp(2.2rem, 1.95rem + 1.2vw, 3.6rem);
    --hero-panel-metric: clamp(1.75rem, 1.35rem + 0.9vw, 2.6rem);
    --hero-panel-label: clamp(1rem, 0.88rem + 0.4vw, 1.35rem);
    --hero-panel-footer: clamp(0.9rem, 0.82rem + 0.25vw, 1.1rem);
  }
  .hero__grid {
    display: grid;
    gap: clamp(1.75rem, 4vw, 3rem);
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    align-items: stretch;
  }
  .hero__copy {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  .hero__title {
    font-size: var(--hero-title);
    line-height: 1.1;
    margin: 0;
  }
  .hero__lead {
    font-size: var(--hero-lead);
    color: var(--muted);
    max-width: 560px;
  }
  .hero__persona {
    margin-top: 0.25rem;
    font-size: var(--font-small);
    font-weight: 600;
    color: var(--accent-dark);
    background: rgba(212, 72, 9, 0.08);
    padding: 0.65rem 0.85rem;
    border-radius: 0.8rem;
  }
  .hero__badges {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }
  .hero__badges li {
    background: rgba(15, 23, 42, 0.07);
    border-radius: 999px;
    padding: 0.35rem 0.9rem;
    font-size: var(--hero-badge);
    font-weight: 600;
    color: #0f172a;
  }
  .hero__cta {
    margin-top: 1rem;
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }
  .hero-panel {
    background: #0f172a;
    color: #fff;
    padding: 2rem;
    border-radius: 1.6rem;
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
  }
  .hero-panel__header {
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
  }
  .hero-panel__header p {
    margin: 0;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: rgba(255, 255, 255, 0.7);
    font-weight: 600;
  }
  .hero-panel__header strong {
    font-size: var(--hero-panel-headline);
    line-height: 1;
  }
  .hero-panel__header small {
    color: rgba(255, 255, 255, 0.75);
    font-weight: 600;
    font-size: var(--font-small);
  }
  .hero-panel__sparkline {
    position: relative;
    width: 100%;
    height: 100px;
    border-radius: 1.2rem;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0));
    overflow: hidden;
  }
  .hero-panel__sparkline span {
    position: absolute;
    inset: 0;
    background: url('data:image/svg+xml,%3Csvg width="200" height="80" xmlns="http://www.w3.org/2000/svg"%3E%3Cpolyline points="0,70 30,40 60,60 90,20 120,35 150,15 180,40 200,5" fill="none" stroke="%23ffb37b" stroke-width="4" stroke-linecap="round"/%3E%3C/svg%3E');
    background-size: 200px 80px;
    animation: scroll-line 6s linear infinite;
    opacity: 0.9;
  }
  .hero-panel__label {
    margin: 0;
    font-weight: 600;
    font-size: var(--hero-panel-label);
    color: #ffd7bd;
  }
  .hero-panel__grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 0.85rem;
  }
  .hero-panel__grid article {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 1rem;
    padding: 1rem;
  }
  .hero-panel__grid p {
    margin: 0;
    font-weight: 600;
  }
  .hero-panel__grid strong {
    display: block;
    font-size: var(--hero-panel-metric);
    margin: 0.2rem 0;
  }
  .hero-panel__grid small {
    color: rgba(255, 255, 255, 0.7);
    font-size: var(--font-small);
  }
  .hero-panel footer {
    margin-top: auto;
    color: rgba(255, 255, 255, 0.65);
    font-size: var(--hero-panel-footer);
  }
  @media (max-width: 768px) {
    .hero {
      padding-left: 1.25rem;
      padding-right: 1.25rem;
    }
    .hero__grid {
      grid-template-columns: 1fr;
    }
    .hero__cta {
      flex-direction: column;
    }
    .hero-panel {
      padding: 1.5rem;
    }
  }
  @media (max-width: 480px) {
    .hero {
      padding-left: 1rem;
      padding-right: 1rem;
    }
  }
  @keyframes scroll-line {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-200px);
    }
  }
</style>

<script type="module">
  const hero = document.querySelector('[data-hero]');
  const persona = hero?.querySelector('[data-hero-persona]');
  const primaryCta = hero?.querySelector('[data-personalized-cta]');

  const intentMessages = {
    o_thuc: {
      persona: 'Đang ưu tiên hạ tầng sống, pháp lý rõ ràng.',
      cta: 'Nhận shortlist khu ở thật'
    },
    dau_tu_trung_han: {
      persona: 'Tập trung suất sinh lời 18-24 tháng.',
      cta: 'Nhận deal đầu tư lọc sẵn'
    },
    luot_song: {
      persona: 'Ưu tiên biên độ giá, thanh khoản nhanh.',
      cta: 'Lọc sản phẩm lướt sóng'
    }
  };

  const updateHero = (intent) => {
    if (!intent || !intentMessages[intent]) return;
    const copy = intentMessages[intent];
    if (persona) {
      persona.textContent = copy.persona;
    }
    if (primaryCta) {
      primaryCta.textContent = copy.cta;
    }
  };

  window.addEventListener('lead-intent-change', (event) => {
    const intent = event?.detail?.intent;
    updateHero(intent);
  });
</script>
