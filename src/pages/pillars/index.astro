---
import Layout from "@components/Layout.astro";
import { getCollection } from "astro:content";

const pillars = await getCollection('pillars');
const baseEnv = import.meta.env.BASE_URL ?? '/';
const basePath = baseEnv.endsWith('/') ? baseEnv.slice(0, -1) : baseEnv;
const sorted = pillars.sort((a, b) => a.data.title.localeCompare(b.data.title));
---
<Layout title="Pillars Hòa Lạc" description="Các bài viết trung tâm kiến thức giúp anh/chị nắm tổng thể quy hoạch và hành động theo từng mục tiêu.">
  <section class="pillar-index">
    <header>
      <p class="pillar-eyebrow">Hệ thống</p>
      <h1>Bài tổng hợp</h1>
      <p>Những trang tổng hợp này đóng vai trò "điểm chuẩn" để kiểm tra timeline, danh mục hạ tầng và checklist pháp lý trước khi đi sâu vào từng khu vực.</p>
    </header>
    <div class="pillar-grid">
      {sorted.map((pillar) => (
        <article class="pillar-card">
          <p class="pillar-card-eyebrow">{pillar.data.stageFocus ?? 'Bài viết trung tâm'}</p>
          <h2><a href={`${basePath}/pillars/${pillar.slug}`}>{pillar.data.title}</a></h2>
          <p>{pillar.data.excerpt}</p>
          <p class="pillar-updated">Cập nhật {new Date(pillar.data.updatedAt).toLocaleDateString('vi-VN')}</p>
        </article>
      ))}
    </div>
  </section>
</Layout>

<style>
  .pillar-index {
    max-width: 1100px;
    margin: 3rem auto 4rem;
    padding: 0 1.5rem;
    --pillar-index-eyebrow: clamp(0.95rem, 0.82rem + 0.25vw, 1.2rem);
    --pillar-index-lede: clamp(1.35rem, 1.18rem + 0.45vw, 1.95rem);
    --pillar-card-body: clamp(1.2rem, 1.04rem + 0.35vw, 1.6rem);
    --pillar-card-updated: clamp(1.05rem, 0.9rem + 0.3vw, 1.35rem);
    --pillar-card-title: clamp(1.8rem, 1.6rem + 0.5vw, 2.4rem);
  }

  .pillar-index > header {
    max-width: 720px;
    margin-bottom: 2.5rem;
  }

  .pillar-eyebrow {
    font-size: var(--pillar-index-eyebrow);
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--muted);
  }

  .pillar-index > header p:last-of-type {
    font-size: var(--pillar-index-lede);
    color: var(--muted);
  }

  .pillar-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;
  }

  .pillar-card {
    padding: 1.75rem;
    border-radius: 1.25rem;
    border: 1px solid var(--shell-border, rgba(255, 255, 255, 0.08));
    background: var(--shell-bg, rgba(255, 255, 255, 0.02));
  }

  .pillar-card h2 {
    margin: 0.5rem 0;
    font-size: var(--pillar-card-title);
  }

  .pillar-card a {
    color: inherit;
    position: relative;
    padding: 0 0.12em;
    border-radius: 0.4rem;
    background-image: linear-gradient(120deg, rgba(249, 115, 22, 0.18), rgba(249, 115, 22, 0.32));
    background-size: 0% 100%;
    background-repeat: no-repeat;
    transition: color 160ms ease, background-size 220ms ease;
  }

  .pillar-card a:hover,
  .pillar-card a:focus-visible {
    color: var(--accent-dark);
    background-size: 100% 100%;
  }

  .pillar-card-eyebrow {
    font-size: var(--pillar-index-eyebrow);
    text-transform: uppercase;
    color: var(--muted);
    letter-spacing: 0.08em;
  }

  .pillar-card p {
    font-size: var(--pillar-card-body);
  }

  .pillar-updated {
    margin-top: 1rem;
    font-size: var(--pillar-card-updated);
    color: var(--muted);
  }
</style>
