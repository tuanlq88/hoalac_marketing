<!DOCTYPE html><html lang="vi"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Insight Hòa Lạc</title><meta name="description" content="Landing page phân tích thị trường địa ốc Hòa Lạc"><meta property="og:title" content="Insight Hòa Lạc"><meta property="og:description" content="Landing page phân tích thị trường địa ốc Hòa Lạc"><meta property="og:type" content="website"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&family=Playfair+Display:wght@500;600;700&display=swap" rel="stylesheet"><link rel="stylesheet" href="/hoalac_marketing/_astro/_slug_.Db8Iv-6v.css">
<link rel="stylesheet" href="/hoalac_marketing/_astro/index.DmWrXov1.css"></head> <body> <header class="site-header"> <div class="site-header__inner"> <a href="/hoalac_marketing" class="site-brand"> <span class="site-brand__title">Insight Hòa Lạc</span> <span class="site-brand__subtitle">Bản tin dữ liệu &amp; funnel 2026</span> </a> <nav class="site-nav" aria-label="Điều hướng chính"> <a href="#lead-form" class="site-nav__pill"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"> <path d="M8 6h8"></path> <path d="M8 12h8"></path> <path d="M8 18h5"></path> <rect x="4" y="3" width="16" height="18" rx="2" ry="2"></rect> </svg> <span>Form tư vấn</span> </a> <a href="/hoalac_marketing/blog" class="site-nav__pill site-nav__pill--accent"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"> <path d="M4 19.5C4 18.12 5.12 17 6.5 17h13"></path> <path d="M4 4.5C4 5.88 5.12 7 6.5 7h13"></path> <path d="M6.5 7C5.12 7 4 5.88 4 4.5V19.5C4 18.12 5.12 17 6.5 17"></path> <path d="M19.5 7C20.88 7 22 5.88 22 4.5V19.5C22 18.12 20.88 17 19.5 17"></path> </svg> <span>Bài viết</span> </a> <a href="/hoalac_marketing/pillars" class="site-nav__pill"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"> <circle cx="12" cy="12" r="3.5"></circle> <path d="M12 2v3"></path> <path d="M12 19v3"></path> <path d="M4 12h3"></path> <path d="M17 12h3"></path> </svg> <span>Trung tâm trụ cột</span> </a> </nav> </div> <div class="site-header__meta"> <a href="mailto:contact@example.com" class="site-meta__item">contact@example.com</a> <span class="site-meta__divider" aria-hidden="true">•</span> <a href="https://t.me/" class="site-meta__item" target="_blank" rel="noreferrer">Telegram cập nhật</a> </div> </header> <main class="site-main">  <section class="hero" data-hero data-astro-cid-bbe6dxrz> <div class="shell-inner hero__grid" data-astro-cid-bbe6dxrz> <div class="hero__copy" data-astro-cid-bbe6dxrz> <p class="hero__eyebrow tag" data-astro-cid-bbe6dxrz>Bản đồ dữ liệu Hòa Lạc</p> <h1 class="hero__title" data-astro-cid-bbe6dxrz>Giải mã nhu cầu đất nền Hòa Lạc 2025</h1> <p class="hero__lead" data-astro-cid-bbe6dxrz>Tổng hợp quy hoạch, nhịp độ giao dịch và mức độ quan tâm theo phân khúc để bạn định vị sản phẩm nhanh hơn.</p> <div class="hero__persona" data-hero-persona data-astro-cid-bbe6dxrz>
Chọn mục tiêu để cá nhân hóa gợi ý.
</div> <ul class="hero__badges" data-astro-cid-bbe6dxrz> <li data-astro-cid-bbe6dxrz>Quy hoạch 2026 cập nhật</li> <li data-astro-cid-bbe6dxrz>Lead funnel tự động</li> <li data-astro-cid-bbe6dxrz>Snapshot mỗi 12 giờ</li> </ul> <div class="hero__cta" data-astro-cid-bbe6dxrz> <a class="button" href="#lead-form" data-personalized-cta data-astro-cid-bbe6dxrz>Nhận báo cáo mới</a> <a class="button button--ghost" href="/hoalac_marketing/blog" data-astro-cid-bbe6dxrz>Xem bài phân tích</a> </div> </div> <div class="hero-panel" data-astro-cid-bbe6dxrz> <header class="hero-panel__header" data-astro-cid-bbe6dxrz> <p data-astro-cid-bbe6dxrz>Động lực nhu cầu</p> <strong data-astro-cid-bbe6dxrz>+312%</strong> <small data-astro-cid-bbe6dxrz>Nhu cầu tìm kiếm 30 ngày</small> </header> <div class="hero-panel__sparkline" aria-hidden="true" data-astro-cid-bbe6dxrz> <span data-astro-cid-bbe6dxrz></span> </div> <p class="hero-panel__label" data-astro-cid-bbe6dxrz>Khu CNC &amp; trục Láng - Hòa Lạc</p> <div class="hero-panel__grid" data-astro-cid-bbe6dxrz> <article data-astro-cid-bbe6dxrz> <p data-astro-cid-bbe6dxrz>Lead nóng</p> <strong data-astro-cid-bbe6dxrz>48</strong> <small data-astro-cid-bbe6dxrz>7 ngày gần nhất</small> </article> <article data-astro-cid-bbe6dxrz> <p data-astro-cid-bbe6dxrz>Lead ấm</p> <strong data-astro-cid-bbe6dxrz>132</strong> <small data-astro-cid-bbe6dxrz>7 ngày gần nhất</small> </article> <article data-astro-cid-bbe6dxrz> <p data-astro-cid-bbe6dxrz>Tỷ lệ qualify</p> <strong data-astro-cid-bbe6dxrz>62%</strong> <small data-astro-cid-bbe6dxrz>So với trung bình 45%</small> </article> </div> <footer data-astro-cid-bbe6dxrz> <p data-astro-cid-bbe6dxrz>Được cập nhật 2 giờ trước • Funnel MOFU ưu tiên</p> </footer> </div> </div> </section>  <script type="module">
  const hero = document.querySelector('[data-hero]');
  const persona = hero?.querySelector('[data-hero-persona]');
  const primaryCta = hero?.querySelector('[data-personalized-cta]');

  const intentMessages = {
    o_thuc: {
      persona: 'Đang ưu tiên hạ tầng sống, pháp lý rõ ràng.',
      cta: 'Nhận shortlist khu ở thật'
    },
    dau_tu_trung_han: {
      persona: 'Tập trung suất sinh lời 18-24 tháng.',
      cta: 'Nhận deal đầu tư lọc sẵn'
    },
    luot_song: {
      persona: 'Ưu tiên biên độ giá, thanh khoản nhanh.',
      cta: 'Lọc sản phẩm lướt sóng'
    }
  };

  const updateHero = (intent) => {
    if (!intent || !intentMessages[intent]) return;
    const copy = intentMessages[intent];
    if (persona) {
      persona.textContent = copy.persona;
    }
    if (primaryCta) {
      primaryCta.textContent = copy.cta;
    }
  };

  window.addEventListener('lead-intent-change', (event) => {
    const intent = event?.detail?.intent;
    updateHero(intent);
  });
</script> <section class="geo" data-geo data-astro-cid-o35ddonq> <div class="geo__inner" data-astro-cid-o35ddonq> <header class="geo__head" data-astro-cid-o35ddonq> <div data-astro-cid-o35ddonq> <p class="tag" data-astro-cid-o35ddonq>Hành chính 2025</p> <h2 data-astro-cid-o35ddonq>Bản đồ xã Hòa Lạc sau sáp nhập</h2> <p class="geo__lead" data-astro-cid-o35ddonq>
Một khối hành chính mới rộng 41,11 km² ôm trọn hành lang Đại Lộ Thăng Long, giữ vai trò vùng đệm chiến lược
          giữa khu Công nghệ cao và các đô thị vệ tinh phía Tây.
</p> </div> <div class="geo__badge" data-astro-cid-o35ddonq> <span data-astro-cid-o35ddonq>Update 11/2025</span> </div> </header> <div class="geo__map-hero" data-astro-cid-o35ddonq> <iframe src="https://www.openstreetmap.org/export/embed.html?bbox=105.44%2C20.97%2C105.59%2C21.06&layer=mapnik&marker=21.0119%2C105.514" loading="lazy" referrerpolicy="no-referrer-when-downgrade" aria-label="Bản đồ xã Hòa Lạc" data-astro-cid-o35ddonq></iframe> <div class="geo__map-pillars" data-astro-cid-o35ddonq> <div data-astro-cid-o35ddonq> <p data-astro-cid-o35ddonq>Toạ độ trung tâm</p> <strong data-astro-cid-o35ddonq>21.0119°N • 105.514°E</strong> </div> <div data-astro-cid-o35ddonq> <p data-astro-cid-o35ddonq>Trụ sở</p> <strong data-astro-cid-o35ddonq>Thôn 1, Thạch Hòa</strong> </div> <div data-astro-cid-o35ddonq> <p data-astro-cid-o35ddonq>Portal</p> <strong data-astro-cid-o35ddonq><a href="https://hoalac.hanoi.gov.vn/" target="_blank" rel="noreferrer" data-astro-cid-o35ddonq>hoalac.hanoi.gov.vn</a></strong> </div> </div> <p class="geo__source" data-astro-cid-o35ddonq>Nguồn dữ liệu: TinhThanhVN 11/2025 · Map layer: OpenStreetMap</p> </div> <div class="geo__details" data-astro-cid-o35ddonq> <div class="geo__stats" data-astro-cid-o35ddonq> <article data-astro-cid-o35ddonq> <p class="geo__stat-label" data-astro-cid-o35ddonq>Diện tích tự nhiên</p> <p class="geo__stat-value" data-astro-cid-o35ddonq>41,11 km²</p> </article><article data-astro-cid-o35ddonq> <p class="geo__stat-label" data-astro-cid-o35ddonq>Dân số 2025</p> <p class="geo__stat-value" data-astro-cid-o35ddonq>30.864 người</p> </article><article data-astro-cid-o35ddonq> <p class="geo__stat-label" data-astro-cid-o35ddonq>Mật độ</p> <p class="geo__stat-value" data-astro-cid-o35ddonq>751 người/km²</p> </article><article data-astro-cid-o35ddonq> <p class="geo__stat-label" data-astro-cid-o35ddonq>Ngày hiệu lực</p> <p class="geo__stat-value" data-astro-cid-o35ddonq>01/07/2025</p> </article> </div> <div class="geo__admin" data-geo-accordion data-astro-cid-o35ddonq> <button class="geo__accordion-toggle" type="button" data-geo-toggle aria-expanded="true" data-astro-cid-o35ddonq> <span data-astro-cid-o35ddonq>Layer hành chính & mô tả chi tiết</span> <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true" data-astro-cid-o35ddonq> <path fill="currentColor" d="M7 10l5 5 5-5" data-astro-cid-o35ddonq></path> </svg> </button> <div class="geo__admin-body" data-geo-body data-astro-cid-o35ddonq> <div class="geo__admin-map" data-astro-cid-o35ddonq> <iframe data-geo-map-frame src="" data-src="https://www.openstreetmap.org/export/embed.html?bbox=105.44%2C20.97%2C105.59%2C21.06&layer=transportmap" loading="lazy" referrerpolicy="no-referrer-when-downgrade" aria-label="Bản đồ hành chính Hòa Lạc" data-astro-cid-o35ddonq></iframe> </div> <div class="geo__admin-info" data-astro-cid-o35ddonq> <h3 data-astro-cid-o35ddonq>Bản đồ hành chính</h3> <p data-astro-cid-o35ddonq>
Nghị quyết 202/2025/QH15 hợp nhất 6 xã: Tiến Xuân, Thạch Hòa, Cổ Đông (phần còn lại), Bình Yên (phần còn lại), Hạ Bằng (phần còn lại), Tân Xã (phần còn lại). Khối mới được quy hoạch cho
              nông nghiệp công nghệ cao, du lịch sinh thái và logistic hỗ trợ khu CNC.
</p> <ul data-astro-cid-o35ddonq> <li data-astro-cid-o35ddonq>Trạng thái: hoạt động từ 01/07/2025</li> <li data-astro-cid-o35ddonq>Đơn vị quản lý: UBND xã Hòa Lạc</li> <li data-astro-cid-o35ddonq>Mã định danh: 09988</li> </ul> </div> </div> </div> </div> </div> </section>  <script type="module">
  const geoSection = document.querySelector('[data-geo]');
  if (geoSection) {
    const accordion = geoSection.querySelector('[data-geo-accordion]');
    const toggle = geoSection.querySelector('[data-geo-toggle]');
    const body = geoSection.querySelector('[data-geo-body]');
    const frame = geoSection.querySelector('[data-geo-map-frame]');
    const mobileQuery = window.matchMedia('(max-width: 768px)');
    let isCollapsed = mobileQuery.matches;
    let mapLoaded = false;

    const loadAdminMap = () => {
      if (mapLoaded) return;
      if (frame && frame instanceof HTMLIFrameElement) {
        const src = frame.dataset.src;
        if (src) {
          frame.src = src;
          mapLoaded = true;
        }
      }
    };

    const updateState = () => {
      accordion?.setAttribute('data-collapsed', isCollapsed ? 'true' : 'false');
      toggle?.setAttribute('aria-expanded', String(!isCollapsed));
      if (!isCollapsed) {
        loadAdminMap();
      }
    };

    updateState();

    toggle?.addEventListener('click', () => {
      isCollapsed = !isCollapsed;
      updateState();
    });

    const onMediaChange = (event) => {
      isCollapsed = event.matches;
      updateState();
    };

    if (mobileQuery.addEventListener) {
      mobileQuery.addEventListener('change', onMediaChange);
    } else if (mobileQuery.addListener) {
      mobileQuery.addListener(onMediaChange);
    }

    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting && !isCollapsed) {
          loadAdminMap();
        }
      });
    }, { rootMargin: '0px 0px 200px 0px' });

    if (body) {
      observer.observe(body);
    }
  }
</script> <section class="section-shell section-shell--alt article-list" data-article-shelf data-astro-cid-shu4jsu4> <div class="shell-inner" data-astro-cid-shu4jsu4> <div class="article-list__head" data-astro-cid-shu4jsu4> <div data-astro-cid-shu4jsu4> <h2 data-astro-cid-shu4jsu4>Snapshot thị trường</h2> <p data-article-context data-astro-cid-shu4jsu4>Chưa chọn ưu tiên cụ thể.</p> </div> <a class="button button--ghost" href="/hoalac_marketing/blog" data-astro-cid-shu4jsu4>Xem tất cả bài</a> </div> <div class="article-list__grid" data-astro-cid-shu4jsu4> <article class="article-card" data-article-tags="" data-astro-cid-shu4jsu4>  <h3 style="margin: 0.8rem 0 0.5rem;" data-astro-cid-shu4jsu4> <a href="/hoalac_marketing/blog/cac-moc-gia-khu-cong-nghe-cao-mo-rong" data-astro-cid-shu4jsu4>Các mốc giá khu Công nghệ cao mở rộng: cập nhật 2026</a> </h3> <p style="margin: 0; color: var(--muted);" data-astro-cid-shu4jsu4>So sánh các mốc giá chính quanh khu Công nghệ cao Hòa Lạc mở rộng, phân tầng theo phân khu và giai đoạn pháp lý để nhà đầu tư lọc cơ hội.</p> <p class="article-card__status" style="margin: 0.75rem 0 0; color: var(--accent-dark); display: none;" data-personalized-badge data-astro-cid-shu4jsu4>
Khớp với ưu tiên của bạn
</p> <p style="margin-top: 1rem; font-weight: 600;" data-astro-cid-shu4jsu4> 19/1/2026 </p> </article><article class="article-card" data-article-tags="" data-astro-cid-shu4jsu4>  <h3 style="margin: 0.8rem 0 0.5rem;" data-astro-cid-shu4jsu4> <a href="/hoalac_marketing/blog/diem-nong-dau-tu-tien-xuan" data-astro-cid-shu4jsu4>Điểm nóng đầu tư Tiến Xuân 2026: chọn cụm nào để xuống tiền an toàn</a> </h3> <p style="margin: 0; color: var(--muted);" data-astro-cid-shu4jsu4>Phân tích các cụm hot ở Tiến Xuân 2026, so sánh với khu lân cận và liệt kê kịch bản đầu tư, rủi ro cần khóa trước khi xuống tiền.</p> <p class="article-card__status" style="margin: 0.75rem 0 0; color: var(--accent-dark); display: none;" data-personalized-badge data-astro-cid-shu4jsu4>
Khớp với ưu tiên của bạn
</p> <p style="margin-top: 1rem; font-weight: 600;" data-astro-cid-shu4jsu4> 19/1/2026 </p> </article><article class="article-card" data-article-tags="" data-astro-cid-shu4jsu4>  <h3 style="margin: 0.8rem 0 0.5rem;" data-astro-cid-shu4jsu4> <a href="/hoalac_marketing/blog/quy-trinh-kiem-tra-so-do-hoa-lac" data-astro-cid-shu4jsu4>Quy trình kiểm tra sổ đỏ Hòa Lạc: 6 bước xác nhận pháp lý trước khi đặt cọc</a> </h3> <p style="margin: 0; color: var(--muted);" data-astro-cid-shu4jsu4>Quy trình 6 bước để kiểm tra sổ đỏ, nguồn gốc và rủi ro quy hoạch tại Hòa Lạc trước khi xuống tiền trong giai đoạn 2026.</p> <p class="article-card__status" style="margin: 0.75rem 0 0; color: var(--accent-dark); display: none;" data-personalized-badge data-astro-cid-shu4jsu4>
Khớp với ưu tiên của bạn
</p> <p style="margin-top: 1rem; font-weight: 600;" data-astro-cid-shu4jsu4> 19/1/2026 </p> </article> </div> </div> </section>  <script type="module">
  const shelf = document.querySelector('[data-article-shelf]');
  if (!shelf) {
    console.warn('Article shelf not found.');
  } else {
    const contextLine = shelf.querySelector('[data-article-context]');
    const cards = shelf.querySelectorAll('.article-card');

    const intentToKeywords = {
      o_thuc: ['ở thật', 'an cư', 'pháp lý'],
      dau_tu_trung_han: ['đầu tư', 'room tài chính', 'lợi nhuận'],
      luot_song: ['thanh khoản', 'sóng']
    };

    const areaKeywords = {
      'ĐHQG': ['ĐHQG', 'Đại học Quốc gia'],
      'khu CNC': ['CNC', 'công nghệ cao'],
      'Bình Yên': ['Bình Yên', 'Thạch Hòa'],
      'Tiến Xuân': ['Tiến Xuân', 'Yên Bình']
    };

    const highlightArticles = ({ intent, areas }) => {
      cards.forEach((card) => {
        card.removeAttribute('data-highlight');
      });

      if (!intent && (!areas || areas.length === 0)) {
        if (contextLine) contextLine.textContent = 'Chưa chọn ưu tiên cụ thể.';
        return;
      }

      const hasAreas = Array.isArray(areas) && areas.length > 0;

      const keywords = new Set();
      if (intent && intentToKeywords[intent]) {
        intentToKeywords[intent].forEach((word) => keywords.add(word));
      }
      if (hasAreas) {
        areas.forEach((areaLabel) => {
          Object.entries(areaKeywords).forEach(([key, values]) => {
            if (areaLabel.toLowerCase().includes(key.toLowerCase())) {
              values.forEach((word) => keywords.add(word));
            }
          });
        });
      }

      const matched = [];
      cards.forEach((card) => {
        const tagString = card.dataset.articleTags ?? '';
        const tagList = tagString.split(',').map((tag) => tag.trim().toLowerCase());
        const hasMatch = Array.from(keywords).some((word) =>
          tagList.some((tag) => tag.includes(word.toLowerCase()))
        );
        if (hasMatch) {
          card.setAttribute('data-highlight', 'true');
          matched.push(card);
        }
      });

      if (contextLine) {
        if (matched.length > 0) {
          const intentLabel = intent
            ? intent === 'o_thuc'
              ? 'an cư'
              : intent === 'dau_tu_trung_han'
                ? 'đầu tư'
                : 'sóng'
            : 'khu vực đã chọn';
          contextLine.textContent = `Đang ưu tiên ${intentLabel}, ${matched.length} bài viết khớp.`;
        } else {
          contextLine.textContent = 'Chưa tìm thấy bài nào khớp, xem tất cả bên dưới.';
        }
      }
    };

    let currentIntent = '';
    let currentAreas = [];

    window.addEventListener('lead-intent-change', (event) => {
      currentIntent = event?.detail?.intent ?? '';
      highlightArticles({ intent: currentIntent, areas: currentAreas });
    });

    window.addEventListener('lead-areas-change', (event) => {
      currentAreas = event?.detail?.areas ?? [];
      highlightArticles({ intent: currentIntent, areas: currentAreas });
    });
  }
</script> <section class="section-shell section-shell--dark advisor" data-astro-cid-bhoyyzq4> <div class="shell-inner advisor__inner" data-astro-cid-bhoyyzq4> <div class="advisor__profile" data-astro-cid-bhoyyzq4> <img src="https://placehold.co/96x96" alt="Advisor Lê Quốc Tuấn" loading="lazy" width="96" height="96" data-astro-cid-bhoyyzq4> <div data-astro-cid-bhoyyzq4> <p class="tag" style="background: rgba(255,255,255,0.2); color: #fff;" data-astro-cid-bhoyyzq4>Advisor on demand</p> <h2 data-astro-cid-bhoyyzq4>Lê Quốc Tuấn</h2> <p class="advisor__meta" data-astro-cid-bhoyyzq4>Lead Advisor • Hòa Lạc · Online 9h00 - 21h00</p> </div> </div> <blockquote data-astro-cid-bhoyyzq4> <p data-astro-cid-bhoyyzq4>Anh/chị mô tả nhu cầu càng cụ thể, em càng dễ shortlist sản phẩm đủ pháp lý và thanh khoản nhanh.</p> <footer data-astro-cid-bhoyyzq4>Chuyên sâu các khu vực: ĐHQG, CNC, cụm Bình Yên - Thạch Hòa. Đã chốt 38 giao dịch trong 12 tháng.</footer> </blockquote> <div class="advisor__cta" data-astro-cid-bhoyyzq4> <a class="button" href="#lead-form" data-astro-cid-bhoyyzq4>Tùy chỉnh shortlist trong 24h</a> <div class="advisor__quick" data-astro-cid-bhoyyzq4> <p data-astro-cid-bhoyyzq4>Hoặc chat nhanh:</p> <div class="advisor__quick-links" data-astro-cid-bhoyyzq4> <a href="https://zalo.me/" target="_blank" rel="noreferrer" data-astro-cid-bhoyyzq4>Zalo</a> <a href="https://t.me/" target="_blank" rel="noreferrer" data-astro-cid-bhoyyzq4>Telegram</a> </div> </div> </div> </div> </section>  <section id="lead-form" class="section-shell section-shell--lead" data-lead-shell data-defer="true" data-endpoint="https://script.google.com/macros/s/AKfycbwM3REFLKfi9x765dPhBp2Hyd5hpEcx_DEL36kxudIMhnjCE5nIV7--HTeERxdpA-erLg/exec" data-global="false" data-force-modal="false" data-floating-enabled="true" data-astro-cid-xyq5hly5> <div class="lead-modal-overlay" data-lead-overlay aria-hidden="true" data-astro-cid-xyq5hly5></div> <div class="shell-inner lead-shell" data-astro-cid-xyq5hly5> <div class="lead-card" data-astro-cid-xyq5hly5> <div class="lead-copy" data-astro-cid-xyq5hly5> <p class="tag" data-astro-cid-xyq5hly5>Lead Qualification</p> <h2 data-astro-cid-xyq5hly5>Đánh giá mức phù hợp Hòa Lạc</h2> <p data-astro-cid-xyq5hly5>Trả lời 5 câu để đội ngũ gợi ý khu vực, pháp lý và room tài chính khớp với nhu cầu trong 24 giờ.</p> </div> <form class="lead-form" data-lead-form novalidate data-astro-cid-xyq5hly5> <button class="lead-form__close" type="button" data-lead-close aria-label="Đóng form" data-astro-cid-xyq5hly5> <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" data-astro-cid-xyq5hly5> <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" data-astro-cid-xyq5hly5></path> </svg> </button> <fieldset class="field" data-field-group="intent" data-astro-cid-xyq5hly5> <legend data-astro-cid-xyq5hly5>Anh/chị quan tâm đất Hòa Lạc để:</legend> <div class="option-grid" data-astro-cid-xyq5hly5> <label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="intent" value="o_thuc" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Ở thật</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="intent" value="dau_tu_trung_han" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Đầu tư trung hạn</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="intent" value="luot_song" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Lướt sóng</span> </div> </label> </div> </fieldset> <p class="field-error" data-error-for="intent" role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> <fieldset class="field" data-field-group="budgetRange" data-astro-cid-xyq5hly5> <legend data-astro-cid-xyq5hly5>Tầm tài chính:</legend> <div class="option-grid" data-astro-cid-xyq5hly5> <label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="budgetRange" value="<1.5" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>&lt; 1,5 tỷ</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="budgetRange" value="1.5-2.5" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>1,5 – 2,5 tỷ</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="budgetRange" value="2.5-3.5" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>2,5 – 3,5 tỷ</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="budgetRange" value=">3.5" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>&gt; 3,5 tỷ</span> </div> </label> </div> </fieldset> <p class="field-error" data-error-for="budgetRange" role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> <fieldset class="field" data-field-group="areas" data-astro-cid-xyq5hly5> <legend data-astro-cid-xyq5hly5>Khu vực ưu tiên:</legend> <p class="hint" data-astro-cid-xyq5hly5>Chọn tối đa 2 khu vực (nếu cần).</p> <div class="option-grid" data-astro-cid-xyq5hly5> <label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="gan_dhqg" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Gần ĐHQG</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="gan_cnc" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Gần khu CNC</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="binh_yen_thach_hoa" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Bình Yên – Thạch Hòa</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="tien_xuan_yen_binh" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Tiến Xuân – Yên Bình</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="hoa_lac_trung_tam" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Trung tâm Hòa Lạc</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="khu_tay_bac" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Cụm Tây Bắc</span> </div> </label> </div> </fieldset> <p class="field-error" data-error-for="areas" role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> <fieldset class="field" data-field-group="legalRisk" data-astro-cid-xyq5hly5> <legend data-astro-cid-xyq5hly5>Mức chấp nhận pháp lý:</legend> <div class="option-grid option-grid--legal" data-astro-cid-xyq5hly5> <label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="legalRisk" value="so_do_san" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Chỉ sổ đỏ</span> <small data-astro-cid-xyq5hly5>Nhận đất ở ngay, pháp lý chuẩn</small> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="legalRisk" value="cho_len_tho_cu" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Chờ lên thổ cư</span> <small data-astro-cid-xyq5hly5>Chấp nhận 6–12 tháng làm thủ tục</small> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="legalRisk" value="co_the_rui_ro" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Có thể rủi ro</span> <small data-astro-cid-xyq5hly5>Chấp nhận đất vườn, quy hoạch chờ</small> </div> </label> </div> </fieldset> <p class="field-error" data-error-for="legalRisk" role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> <div class="field" data-field-group="contact" data-astro-cid-xyq5hly5> <label data-astro-cid-xyq5hly5>Để lại Zalo / SĐT</label> <input type="tel" name="contact" required inputmode="tel" pattern="^(03|05|07|08|09|01[2689])[0-9]{8}$" placeholder="Zalo hoặc số điện thoại" data-astro-cid-xyq5hly5> <p class="field-error" data-error-for="contact" role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> </div> <input type="hidden" name="source" value="lead-inline" data-astro-cid-xyq5hly5> <input type="hidden" name="leadTag" value="pending_classification" data-lead-tag data-astro-cid-xyq5hly5> <input type="text" name="company" class="hp" tabindex="-1" autocomplete="off" data-astro-cid-xyq5hly5> <button class="button" type="submit" data-astro-cid-xyq5hly5>Gửi yêu cầu</button> <p class="status" data-status role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> </form> </div> </div> <button class="floating-cta" type="button" data-floating-cta aria-hidden="true" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Đánh giá mức phù hợp</span> <small data-astro-cid-xyq5hly5>Trả lời 5 câu, nhận shortlist trong 24h</small> </button> </section>  <script type="module">
  (() => {
    const AREA_LIMIT = 2;
    const SCROLL_THRESHOLD = 0.65;
    const intentWeights = {
      o_thuc: 3,
      dau_tu_trung_han: 2,
      luot_song: 0
    };
    const budgetWeights = {
      '<1.5': 0,
      '1.5-2.5': 1,
      '2.5-3.5': 2,
      '>3.5': 3
    };
    const legalWeights = {
      so_do_san: 3,
      cho_len_tho_cu: 1,
      co_the_rui_ro: 0
    };
    const priorityAreas = ['gan_dhqg', 'gan_cnc'];
    const SECTION_FLOW = ['intent', 'budgetRange', 'areas', 'legalRisk', 'contact'];
    const SECTION_MESSAGES = {
      intent: 'Vui lòng chọn mục đích sử dụng.',
      budgetRange: 'Vui lòng chọn tầm tài chính.',
      areas: 'Vui lòng chọn ít nhất 1 khu vực ưu tiên.',
      legalRisk: 'Vui lòng chọn mức chấp nhận pháp lý.',
      contact: 'Vui lòng nhập số liên hệ hợp lệ.'
    };
    const PHONE_PATTERN = /^(03|05|07|08|09|01[2689])[0-9]{8}$/;

    const initKey = '__hoaLacLeadFormInit__';
    if (window[initKey]) {
      return;
    }

    window[initKey] = true;

    const boot = () => {
      const shells = Array.from(document.querySelectorAll('[data-lead-shell]'));
      shells.forEach((shell) => initLeadShell(shell));
    };

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', boot, { once: true });
    } else {
      boot();
    }

    function initLeadShell(shell) {
      const form = shell.querySelector('[data-lead-form]');
      if (!form) return;

      const status = shell.querySelector('[data-status]');
      const setStatus = createStatusSetter(status);
      const fieldErrors = createFieldErrorRegistry(form);
      const floatingCta = shell.querySelector('button[data-floating-cta]');
      const overlay = shell.querySelector('[data-lead-overlay]');
      const closeControls = Array.from(shell.querySelectorAll('[data-lead-close]'));
      const endpoint = shell.dataset.endpoint ?? '';
      const deferDisplay = shell.dataset.defer === 'true';
      const showFloatingCta = shell.dataset.floatingEnabled !== 'false';
      const isGlobalFallback = shell.dataset.global === 'true';
      const forceModal = shell.dataset.forceModal === 'true';
      const leadTagInput = form.querySelector('[data-lead-tag]');
      const fallbackLeadTag = leadTagInput?.value ?? 'pending_classification';
      let modalQuery;
      let preferModal = forceModal;
      let previousOverflow = '';

      setupValidationListeners(form, fieldErrors, setStatus);
      applySequentialTabIndex(form);
      const sectionFlow = setupSectionFlow(form, fieldErrors);
      form.addEventListener('reset', () => sectionFlow?.reset?.());

      const areaCheckboxes = form.querySelectorAll('input[name="areas"]');
      areaCheckboxes.forEach((checkbox) => {
        checkbox.addEventListener('change', (event) => handleAreaLimit(event, form, setStatus, fieldErrors));
      });

      const intentInputs = form.querySelectorAll('input[name="intent"]');
      intentInputs.forEach((input) => {
        input.addEventListener('change', () => broadcastIntentChange(input.value));
        if (input.checked) {
          broadcastIntentChange(input.value);
        }
      });

      const areaInputs = form.querySelectorAll('input[name="areas"]');
      areaInputs.forEach((input) => {
        input.addEventListener('change', () => broadcastAreasChange(getSelectedAreaLabels(form)));
      });

      const setBodyScrollLock = (locked) => {
        if (typeof document === 'undefined') return;
        if (locked) {
          previousOverflow = document.body.style.overflow;
          document.body.style.overflow = 'hidden';
        } else {
          document.body.style.overflow = previousOverflow;
        }
      };

      const closeModal = () => {
        if (!shell.classList.contains('is-modal-open')) return;
        shell.classList.remove('is-modal-open');
        overlay?.setAttribute('aria-hidden', 'true');
        setBodyScrollLock(false);
        form.reset();
        sectionFlow?.reset();
        if (leadTagInput) {
          leadTagInput.value = fallbackLeadTag;
        }
        setStatus('');
        fieldErrors.clearAll();
        shell.classList.remove('is-expanded');
        if (deferDisplay && showFloatingCta) {
          shell.classList.add('is-collapsed');
          shell.classList.add('cta-visible');
          floatingCta?.removeAttribute('aria-hidden');
        }
      };

      const openModal = () => {
        shell.classList.add('is-modal-open');
        shell.classList.add('is-expanded');
        shell.classList.remove('is-collapsed');
        shell.classList.remove('cta-visible');
        floatingCta?.setAttribute('aria-hidden', 'true');
        overlay?.removeAttribute('aria-hidden');
        setBodyScrollLock(true);
        const firstField = form.querySelector('input, select, textarea');
        firstField?.focus({ preventScroll: true });
      };

      const shouldUseModal = () => forceModal || preferModal;

      const updateModalPreference = () => {
        if (typeof window === 'undefined' || !deferDisplay || !showFloatingCta || forceModal) {
          return;
        }
        if (!modalQuery) {
          modalQuery = window.matchMedia('(max-width: 768px)');
          modalQuery.addEventListener('change', (event) => {
            preferModal = event.matches;
            if (!preferModal) {
              closeModal();
            }
          });
        }
        preferModal = modalQuery.matches;
      };

      updateModalPreference();

      const revealLeadCapture = () => {
        if (shouldUseModal()) {
          openModal();
          return;
        }
        shell.classList.add('is-expanded');
        shell.classList.remove('is-collapsed');
        shell.classList.remove('cta-visible');
        floatingCta?.setAttribute('aria-hidden', 'true');
        const firstField = form.querySelector('input, select, textarea');
        firstField?.focus();
        form.scrollIntoView({ behavior: 'smooth', block: 'center' });
      };

      closeControls.forEach((control) => {
        control.addEventListener('click', closeModal);
      });
      overlay?.addEventListener('click', closeModal);

      window.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') {
          closeModal();
        }
      });
      window.addEventListener('resize', updateModalPreference);

      function handleScrollReveal() {
        if (!deferDisplay || !floatingCta || !showFloatingCta) return;
        shell.classList.add('is-collapsed');

        const showCta = () => {
          const maxScroll = document.documentElement.scrollHeight - window.innerHeight;
          const progress = maxScroll <= 0 ? 1 : window.scrollY / maxScroll;
          if (progress >= SCROLL_THRESHOLD) {
            shell.classList.add('cta-visible');
            floatingCta.removeAttribute('aria-hidden');
            window.removeEventListener('scroll', onScroll);
          }
        };

        let ticking = false;
        const onScroll = () => {
          if (ticking) return;
          ticking = true;
          requestAnimationFrame(() => {
            showCta();
            ticking = false;
          });
        };

        window.addEventListener('scroll', onScroll, { passive: true });
        setTimeout(showCta, 8000);

        floatingCta.addEventListener('click', revealLeadCapture);
      }

      handleScrollReveal();

      function attachAnchorReveal() {
        if (!shell.id) return;
        const inlineAnchors = Array.from(document.querySelectorAll(`a[href="#${shell.id}"]`));
        if (inlineAnchors.length === 0) return;

        inlineAnchors.forEach((anchor) => {
          anchor.addEventListener('click', (event) => {
            if (!shell.classList.contains('is-collapsed')) return;
            if (!deferDisplay || !showFloatingCta) return;
            if (shouldUseModal()) return;
            event.preventDefault();
            revealLeadCapture();
          });
        });
      }

      attachAnchorReveal();

      if (isGlobalFallback) {
        const portalQueueKey = '__hoaLacLeadPortalQueue__';
        window.addEventListener('lead-form:request-open', openModal);
        window.addEventListener('lead-form:request-close', closeModal);

        window.__hoaLacLeadPortal = {
          open: () => openModal(),
          close: () => closeModal()
        };

        const queue = window[portalQueueKey];
        if (Array.isArray(queue) && queue.length > 0) {
          while (queue.length > 0) {
            const action = queue.shift();
            if (action === 'open') {
              openModal();
            } else if (action === 'close') {
              closeModal();
            }
          }
        }
        window[portalQueueKey] = [];
      }

      form.addEventListener('submit', (event) => {
        submitLead({
          event,
          form,
          setStatus,
          fieldErrors,
          sectionFlow,
          endpoint,
          leadTagInput,
          fallbackLeadTag,
          onSuccess: () => {
            if (shell.classList.contains('is-modal-open')) {
              setTimeout(() => closeModal(), 2000);
            }
          }
        });
      });
    }

    function createStatusSetter(statusEl) {
      const setter = (message = '', state = 'info') => {
        if (!statusEl) return;
        const text = message ?? '';
        statusEl.textContent = text;
        if (text) {
          statusEl.dataset.state = state;
        } else {
          statusEl.removeAttribute('data-state');
        }
        setter.currentMessage = text;
        setter.currentState = text ? state : undefined;
      };
      setter.currentMessage = statusEl?.textContent ?? '';
      setter.currentState = statusEl?.dataset?.state;
      return setter;
    }

    function handleAreaLimit(event, form, setStatus, fieldErrors) {
      const checkedAreas = form.querySelectorAll('input[name="areas"]:checked');
      if (checkedAreas.length > AREA_LIMIT) {
        event.target.checked = false;
        setStatus(`Chỉ chọn tối đa ${AREA_LIMIT} khu vực.`, 'error');
        fieldErrors?.set('areas', `Chỉ chọn tối đa ${AREA_LIMIT} khu vực.`);
        focusField(event.target);
        return;
      }
      if (typeof setStatus === 'function' && setStatus.currentMessage?.includes('Chỉ chọn tối đa')) {
        setStatus('');
      }
      fieldErrors?.clear('areas');
    }

    function getSelectedAreaLabels(form) {
      return Array.from(form.querySelectorAll('input[name="areas"]:checked'))
        .map((input) => input.nextElementSibling?.textContent?.trim())
        .filter((label) => Boolean(label));
    }

    function broadcastIntentChange(intentValue) {
      if (typeof window === 'undefined' || !intentValue) return;
      window.dispatchEvent(new CustomEvent('lead-intent-change', {
        detail: { intent: intentValue }
      }));
    }

    function broadcastAreasChange(labels) {
      if (typeof window === 'undefined') return;
      window.dispatchEvent(new CustomEvent('lead-areas-change', {
        detail: { areas: labels }
      }));
    }

    function setupValidationListeners(form, fieldErrors, setStatus) {
      if (!form) return;
      SECTION_FLOW.forEach((key) => {
        const group = form.querySelector(`[data-field-group="${key}"]`);
        if (!group) return;
        const inputs = group.querySelectorAll('input, select, textarea');
        inputs.forEach((input) => {
          const eventName = input.type === 'radio' || input.type === 'checkbox' ? 'change' : 'input';
          input.addEventListener(eventName, () => {
            const result = validateSection(key, form);
            if (result.valid) {
              fieldErrors?.clear(key);
              if (allSectionsValid(form) && setStatus?.currentState !== 'success') {
                setStatus?.('');
              }
            } else if (result.message) {
              fieldErrors?.set(key, result.message);
            }
          });
        });
      });

      form.addEventListener('reset', () => {
        fieldErrors?.clearAll();
      });
    }

    function serializeForm(formElement) {
      const formData = new FormData(formElement);
      const data = Object.fromEntries(formData);
      const selectedAreas = formData.getAll('areas');
      if (selectedAreas.length > 0) {
        data.areas = selectedAreas.join(', ');
      }
      return data;
    }

    function computeLeadTag({ intent, budgetRange, legalRisk, areas }) {
      let score = 0;
      score += intentWeights[intent] ?? 0;
      score += budgetWeights[budgetRange] ?? 0;
      score += legalWeights[legalRisk] ?? 0;
      if (areas?.some((area) => priorityAreas.includes(area))) {
        score += 1;
      }

      if (intent === 'luot_song' && legalRisk === 'co_the_rui_ro') {
        return 'lead_cold';
      }
      if (score >= 6) {
        return 'lead_hot';
      }
      if (score >= 3) {
        return 'lead_warm';
      }
      return 'lead_cold';
    }

    async function submitLead({ event, form, setStatus, fieldErrors, sectionFlow, endpoint, leadTagInput, fallbackLeadTag, onSuccess }) {
      event.preventDefault();
      if (!form) return;

      const validation = runSequentialValidation({ form, fieldErrors, setStatus });
      if (!validation.ok) {
        focusSection(validation.section, form);
        return;
      }

      const selectedAreaValues = Array.from(form.querySelectorAll('input[name="areas"]:checked')).map((input) => input.value);

      const now = new Date();
      const vnDateTime = now.toLocaleString('vi-VN', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        hour12: false
      });

      const data = serializeForm(form);
      data.areas = selectedAreaValues.join(', ');
      const computedTag = computeLeadTag({
        intent: data.intent,
        budgetRange: data.budgetRange,
        legalRisk: data.legalRisk,
        areas: selectedAreaValues
      }) ?? fallbackLeadTag;
      data.leadTag = computedTag;
      if (typeof data.contact === 'string') {
        data.contact = data.contact.replace(/\s+/g, '').replace(/^0*/, (match) => (match ? '0' : ''));
      }
      if (leadTagInput) {
        leadTagInput.value = computedTag;
      }
      data.submittedAt = now.toISOString();
      data.submittedAtLocal = vnDateTime;

      if (data.company) {
        setStatus?.('Đã chặn spam.', 'warning');
        return;
      }

      if (!endpoint) {
        setStatus?.('Chưa cấu hình PUBLIC_LEAD_ENDPOINT.', 'error');
        return;
      }

      setStatus?.('Đang gửi...', 'info');
      try {
        const body = new URLSearchParams();
        Object.entries(data).forEach(([key, value]) => {
          body.append(key, typeof value === 'string' ? value : String(value ?? ''));
        });

        const response = await fetch(endpoint, {
          method: 'POST',
          body
        });

        if (response.ok) {
          let payloadMessage = 'Đã nhận thông tin!';
          try {
            const payload = await response.json();
            if (payload?.message) payloadMessage = payload.message;
          } catch (parseErr) {
            console.warn('Không parse được payload, dùng message mặc định.', parseErr);
          }
          setStatus?.(payloadMessage, 'success');
          form.reset();
          sectionFlow?.reset?.();
          fieldErrors?.clearAll();
          if (typeof onSuccess === 'function') {
            onSuccess();
          }
          return;
        }

        throw new Error(`Request failed with status ${response.status}`);
      } catch (error) {
        console.error(error);
        if (error instanceof TypeError) {
          setStatus?.('Đã nhận thông tin!', 'success');
          if (typeof onSuccess === 'function') {
            onSuccess();
          }
          form.reset();
          sectionFlow?.reset?.();
          fieldErrors?.clearAll();
        } else {
          setStatus?.('Không gửi được, vui lòng thử lại.', 'error');
        }
      }
    }

    function runSequentialValidation({ form, fieldErrors, setStatus }) {
      if (!form) {
        return { ok: false, section: undefined };
      }
      for (const key of SECTION_FLOW) {
        const result = validateSection(key, form);
        if (!result.valid) {
          if (result.message) {
            fieldErrors?.set(key, result.message);
            setStatus?.(result.message, 'error');
          }
          return { ok: false, section: key };
        }
        fieldErrors?.clear(key);
      }
      if (setStatus?.currentState !== 'success') {
        setStatus?.('');
      }
      return { ok: true };
    }

    function createFieldErrorRegistry(form) {
      const errorNodes = new Map();
      form.querySelectorAll('[data-error-for]').forEach((node) => {
        if (!(node instanceof HTMLElement)) return;
        const key = node.dataset.errorFor;
        if (!key) return;
        errorNodes.set(key, node);
        node.setAttribute('hidden', 'hidden');
      });

      const getGroup = (key) => form.querySelector(`[data-field-group="${key}"]`);

      const set = (key, message = '') => {
        if (!key) return;
        const node = errorNodes.get(key);
        const text = message?.trim() ?? '';
        if (node) {
          if (text) {
            node.textContent = text;
            node.removeAttribute('hidden');
          } else {
            node.textContent = '';
            node.setAttribute('hidden', 'hidden');
          }
        }
        const group = getGroup(key);
        if (group) {
          if (text) {
            group.classList.add('is-invalid');
          } else {
            group.classList.remove('is-invalid');
          }
        }
      };

      const clear = (key) => set(key, '');
      const clearAll = () => {
        errorNodes.forEach((_node, key) => {
          clear(key);
        });
      };

      return { set, clear, clearAll };
    }

    function focusField(field) {
      if (!field) return;
      requestAnimationFrame(() => {
        if (typeof field.scrollIntoView === 'function') {
          field.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'nearest' });
        }
        if (typeof field.focus === 'function') {
          field.focus({ preventScroll: true });
        }
      });
    }

    function getFieldErrorKey(field) {
      if (!field) return '';
      if (field.name) return field.name;
      if (field.dataset?.errorKey) return field.dataset.errorKey;
      const group = field.closest('[data-field-group]');
      return group instanceof HTMLElement ? group.dataset.fieldGroup ?? '' : '';
    }

    function setupSectionFlow(form, fieldErrors) {
      if (!form) return null;
      const completedSections = new Set();

      const handleProgress = (key) => {
        if (!isSectionComplete(key, form)) {
          completedSections.delete(key);
          return;
        }
        if (completedSections.has(key)) {
          return;
        }
        completedSections.add(key);
        fieldErrors?.clear(key);
        const nextKey = getNextSectionKey(key);
        if (nextKey) {
          focusSection(nextKey, form);
        } else {
          const submitButton = form.querySelector('button[type="submit"]');
          focusField(submitButton);
        }
      };

      SECTION_FLOW.forEach((key) => {
        const group = form.querySelector(`[data-field-group="${key}"]`);
        if (!group) return;
        const inputs = group.querySelectorAll('input, select, textarea');
        inputs.forEach((input) => {
          const eventName = input.type === 'radio' || input.type === 'checkbox' ? 'change' : 'input';
          input.addEventListener(eventName, () => handleProgress(key));
        });
      });

      return {
        reset: () => completedSections.clear()
      };
    }

    function isSectionComplete(key, form) {
      switch (key) {
        case 'intent':
        case 'budgetRange':
        case 'legalRisk':
          return Boolean(form.querySelector(`input[name="${key}"]:checked`));
        case 'areas':
          return form.querySelectorAll('input[name="areas"]:checked').length > 0;
        case 'contact': {
          const input = form.querySelector('input[name="contact"]');
          const value = input?.value?.trim() ?? '';
          return PHONE_PATTERN.test(value);
        }
        default:
          return true;
      }
    }

    function validateSection(key, form) {
      switch (key) {
        case 'intent': {
          const checked = form.querySelector('input[name="intent"]:checked');
          return checked ? { valid: true } : { valid: false, message: SECTION_MESSAGES.intent };
        }
        case 'budgetRange': {
          const checked = form.querySelector('input[name="budgetRange"]:checked');
          return checked ? { valid: true } : { valid: false, message: SECTION_MESSAGES.budgetRange };
        }
        case 'areas': {
          const checkedCount = form.querySelectorAll('input[name="areas"]:checked').length;
          if (checkedCount === 0) {
            return { valid: false, message: SECTION_MESSAGES.areas };
          }
          if (checkedCount > AREA_LIMIT) {
            return { valid: false, message: `Chỉ chọn tối đa ${AREA_LIMIT} khu vực.` };
          }
          return { valid: true };
        }
        case 'legalRisk': {
          const checked = form.querySelector('input[name="legalRisk"]:checked');
          return checked ? { valid: true } : { valid: false, message: SECTION_MESSAGES.legalRisk };
        }
        case 'contact': {
          const input = form.querySelector('input[name="contact"]');
          const value = input?.value?.trim() ?? '';
          if (!value) {
            return { valid: false, message: 'Vui lòng nhập số liên hệ.' };
          }
          if (!PHONE_PATTERN.test(value)) {
            return { valid: false, message: 'Số liên hệ phải đủ 10 số và bắt đầu bằng 03, 05, 07, 08, 09 hoặc 01[2|6|8|9].' };
          }
          return { valid: true };
        }
        default:
          return { valid: true };
      }
    }

    function focusSection(key, form) {
      if (!key || !form) return;
      const group = form.querySelector(`[data-field-group="${key}"]`);
      if (!group) return;
      const focusable = group.querySelector('input:not([type="hidden"]), select, textarea, button');
      if (focusable) {
        focusField(focusable);
      }
    }

    function getNextSectionKey(key) {
      const index = SECTION_FLOW.indexOf(key);
      if (index === -1) return undefined;
      return SECTION_FLOW[index + 1];
    }

    function allSectionsValid(form) {
      return SECTION_FLOW.every((key) => validateSection(key, form).valid);
    }

    function applySequentialTabIndex(form) {
      if (!form) return;
      const focusableSelectors = [
        'input:not([type="hidden"]):not(.hp)',
        'select',
        'textarea',
        'button'
      ].join(',');
      const focusables = Array.from(form.querySelectorAll(focusableSelectors));
      let order = 1;
      focusables.forEach((node) => {
        if (node instanceof HTMLInputElement || node instanceof HTMLSelectElement || node instanceof HTMLTextAreaElement || node instanceof HTMLButtonElement) {
          if (node.disabled || node.tabIndex < 0) {
            return;
          }
          node.tabIndex = order;
          order += 1;
        }
      });
    }
  })();
</script>  </main> <footer class="site-footer"> <div class="site-footer__inner"> <div> <p class="site-footer__brand">Insight Hòa Lạc © 2026</p> <p class="site-footer__copy">Landing page thử nghiệm GitHub Pages + funnel marketing.</p> </div> <div class="site-footer__links"> <a href="/hoalac_marketing/blog">Truy cập blog</a> <a href="#lead-form" class="site-footer__cta">Đăng ký tư vấn</a> </div> <div class="site-footer__contact"> <a href="mailto:contact@example.com">contact@example.com</a> <a href="https://t.me/" target="_blank" rel="noreferrer">Telegram</a> </div> </div> </footer> <section id="lead-form-global" class="section-shell section-shell--lead lead-shell--portal" data-lead-shell data-defer="true" data-endpoint="https://script.google.com/macros/s/AKfycbwM3REFLKfi9x765dPhBp2Hyd5hpEcx_DEL36kxudIMhnjCE5nIV7--HTeERxdpA-erLg/exec" data-global="true" data-force-modal="true" data-floating-enabled="false" data-astro-cid-xyq5hly5> <div class="lead-modal-overlay" data-lead-overlay aria-hidden="true" data-astro-cid-xyq5hly5></div> <div class="shell-inner lead-shell" data-astro-cid-xyq5hly5> <div class="lead-card" data-astro-cid-xyq5hly5> <div class="lead-copy" data-astro-cid-xyq5hly5> <p class="tag" data-astro-cid-xyq5hly5>Lead Qualification</p> <h2 data-astro-cid-xyq5hly5>Đánh giá mức phù hợp Hòa Lạc</h2> <p data-astro-cid-xyq5hly5>Trả lời 5 câu để đội ngũ gợi ý khu vực, pháp lý và room tài chính khớp với nhu cầu trong 24 giờ.</p> </div> <form class="lead-form" data-lead-form novalidate data-astro-cid-xyq5hly5> <button class="lead-form__close" type="button" data-lead-close aria-label="Đóng form" data-astro-cid-xyq5hly5> <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" data-astro-cid-xyq5hly5> <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" data-astro-cid-xyq5hly5></path> </svg> </button> <fieldset class="field" data-field-group="intent" data-astro-cid-xyq5hly5> <legend data-astro-cid-xyq5hly5>Anh/chị quan tâm đất Hòa Lạc để:</legend> <div class="option-grid" data-astro-cid-xyq5hly5> <label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="intent" value="o_thuc" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Ở thật</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="intent" value="dau_tu_trung_han" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Đầu tư trung hạn</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="intent" value="luot_song" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Lướt sóng</span> </div> </label> </div> </fieldset> <p class="field-error" data-error-for="intent" role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> <fieldset class="field" data-field-group="budgetRange" data-astro-cid-xyq5hly5> <legend data-astro-cid-xyq5hly5>Tầm tài chính:</legend> <div class="option-grid" data-astro-cid-xyq5hly5> <label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="budgetRange" value="<1.5" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>&lt; 1,5 tỷ</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="budgetRange" value="1.5-2.5" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>1,5 – 2,5 tỷ</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="budgetRange" value="2.5-3.5" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>2,5 – 3,5 tỷ</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="budgetRange" value=">3.5" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>&gt; 3,5 tỷ</span> </div> </label> </div> </fieldset> <p class="field-error" data-error-for="budgetRange" role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> <fieldset class="field" data-field-group="areas" data-astro-cid-xyq5hly5> <legend data-astro-cid-xyq5hly5>Khu vực ưu tiên:</legend> <p class="hint" data-astro-cid-xyq5hly5>Chọn tối đa 2 khu vực (nếu cần).</p> <div class="option-grid" data-astro-cid-xyq5hly5> <label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="gan_dhqg" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Gần ĐHQG</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="gan_cnc" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Gần khu CNC</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="binh_yen_thach_hoa" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Bình Yên – Thạch Hòa</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="tien_xuan_yen_binh" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Tiến Xuân – Yên Bình</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="hoa_lac_trung_tam" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Trung tâm Hòa Lạc</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="khu_tay_bac" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Cụm Tây Bắc</span> </div> </label> </div> </fieldset> <p class="field-error" data-error-for="areas" role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> <fieldset class="field" data-field-group="legalRisk" data-astro-cid-xyq5hly5> <legend data-astro-cid-xyq5hly5>Mức chấp nhận pháp lý:</legend> <div class="option-grid option-grid--legal" data-astro-cid-xyq5hly5> <label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="legalRisk" value="so_do_san" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Chỉ sổ đỏ</span> <small data-astro-cid-xyq5hly5>Nhận đất ở ngay, pháp lý chuẩn</small> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="legalRisk" value="cho_len_tho_cu" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Chờ lên thổ cư</span> <small data-astro-cid-xyq5hly5>Chấp nhận 6–12 tháng làm thủ tục</small> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="legalRisk" value="co_the_rui_ro" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Có thể rủi ro</span> <small data-astro-cid-xyq5hly5>Chấp nhận đất vườn, quy hoạch chờ</small> </div> </label> </div> </fieldset> <p class="field-error" data-error-for="legalRisk" role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> <div class="field" data-field-group="contact" data-astro-cid-xyq5hly5> <label data-astro-cid-xyq5hly5>Để lại Zalo / SĐT</label> <input type="tel" name="contact" required inputmode="tel" pattern="^(03|05|07|08|09|01[2689])[0-9]{8}$" placeholder="Zalo hoặc số điện thoại" data-astro-cid-xyq5hly5> <p class="field-error" data-error-for="contact" role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> </div> <input type="hidden" name="source" value="lead-portal" data-astro-cid-xyq5hly5> <input type="hidden" name="leadTag" value="pending_classification" data-lead-tag data-astro-cid-xyq5hly5> <input type="text" name="company" class="hp" tabindex="-1" autocomplete="off" data-astro-cid-xyq5hly5> <button class="button" type="submit" data-astro-cid-xyq5hly5>Gửi yêu cầu</button> <p class="status" data-status role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> </form> </div> </div>  </section>  <script type="module">
  (() => {
    const AREA_LIMIT = 2;
    const SCROLL_THRESHOLD = 0.65;
    const intentWeights = {
      o_thuc: 3,
      dau_tu_trung_han: 2,
      luot_song: 0
    };
    const budgetWeights = {
      '<1.5': 0,
      '1.5-2.5': 1,
      '2.5-3.5': 2,
      '>3.5': 3
    };
    const legalWeights = {
      so_do_san: 3,
      cho_len_tho_cu: 1,
      co_the_rui_ro: 0
    };
    const priorityAreas = ['gan_dhqg', 'gan_cnc'];
    const SECTION_FLOW = ['intent', 'budgetRange', 'areas', 'legalRisk', 'contact'];
    const SECTION_MESSAGES = {
      intent: 'Vui lòng chọn mục đích sử dụng.',
      budgetRange: 'Vui lòng chọn tầm tài chính.',
      areas: 'Vui lòng chọn ít nhất 1 khu vực ưu tiên.',
      legalRisk: 'Vui lòng chọn mức chấp nhận pháp lý.',
      contact: 'Vui lòng nhập số liên hệ hợp lệ.'
    };
    const PHONE_PATTERN = /^(03|05|07|08|09|01[2689])[0-9]{8}$/;

    const initKey = '__hoaLacLeadFormInit__';
    if (window[initKey]) {
      return;
    }

    window[initKey] = true;

    const boot = () => {
      const shells = Array.from(document.querySelectorAll('[data-lead-shell]'));
      shells.forEach((shell) => initLeadShell(shell));
    };

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', boot, { once: true });
    } else {
      boot();
    }

    function initLeadShell(shell) {
      const form = shell.querySelector('[data-lead-form]');
      if (!form) return;

      const status = shell.querySelector('[data-status]');
      const setStatus = createStatusSetter(status);
      const fieldErrors = createFieldErrorRegistry(form);
      const floatingCta = shell.querySelector('button[data-floating-cta]');
      const overlay = shell.querySelector('[data-lead-overlay]');
      const closeControls = Array.from(shell.querySelectorAll('[data-lead-close]'));
      const endpoint = shell.dataset.endpoint ?? '';
      const deferDisplay = shell.dataset.defer === 'true';
      const showFloatingCta = shell.dataset.floatingEnabled !== 'false';
      const isGlobalFallback = shell.dataset.global === 'true';
      const forceModal = shell.dataset.forceModal === 'true';
      const leadTagInput = form.querySelector('[data-lead-tag]');
      const fallbackLeadTag = leadTagInput?.value ?? 'pending_classification';
      let modalQuery;
      let preferModal = forceModal;
      let previousOverflow = '';

      setupValidationListeners(form, fieldErrors, setStatus);
      applySequentialTabIndex(form);
      const sectionFlow = setupSectionFlow(form, fieldErrors);
      form.addEventListener('reset', () => sectionFlow?.reset?.());

      const areaCheckboxes = form.querySelectorAll('input[name="areas"]');
      areaCheckboxes.forEach((checkbox) => {
        checkbox.addEventListener('change', (event) => handleAreaLimit(event, form, setStatus, fieldErrors));
      });

      const intentInputs = form.querySelectorAll('input[name="intent"]');
      intentInputs.forEach((input) => {
        input.addEventListener('change', () => broadcastIntentChange(input.value));
        if (input.checked) {
          broadcastIntentChange(input.value);
        }
      });

      const areaInputs = form.querySelectorAll('input[name="areas"]');
      areaInputs.forEach((input) => {
        input.addEventListener('change', () => broadcastAreasChange(getSelectedAreaLabels(form)));
      });

      const setBodyScrollLock = (locked) => {
        if (typeof document === 'undefined') return;
        if (locked) {
          previousOverflow = document.body.style.overflow;
          document.body.style.overflow = 'hidden';
        } else {
          document.body.style.overflow = previousOverflow;
        }
      };

      const closeModal = () => {
        if (!shell.classList.contains('is-modal-open')) return;
        shell.classList.remove('is-modal-open');
        overlay?.setAttribute('aria-hidden', 'true');
        setBodyScrollLock(false);
        form.reset();
        sectionFlow?.reset();
        if (leadTagInput) {
          leadTagInput.value = fallbackLeadTag;
        }
        setStatus('');
        fieldErrors.clearAll();
        shell.classList.remove('is-expanded');
        if (deferDisplay && showFloatingCta) {
          shell.classList.add('is-collapsed');
          shell.classList.add('cta-visible');
          floatingCta?.removeAttribute('aria-hidden');
        }
      };

      const openModal = () => {
        shell.classList.add('is-modal-open');
        shell.classList.add('is-expanded');
        shell.classList.remove('is-collapsed');
        shell.classList.remove('cta-visible');
        floatingCta?.setAttribute('aria-hidden', 'true');
        overlay?.removeAttribute('aria-hidden');
        setBodyScrollLock(true);
        const firstField = form.querySelector('input, select, textarea');
        firstField?.focus({ preventScroll: true });
      };

      const shouldUseModal = () => forceModal || preferModal;

      const updateModalPreference = () => {
        if (typeof window === 'undefined' || !deferDisplay || !showFloatingCta || forceModal) {
          return;
        }
        if (!modalQuery) {
          modalQuery = window.matchMedia('(max-width: 768px)');
          modalQuery.addEventListener('change', (event) => {
            preferModal = event.matches;
            if (!preferModal) {
              closeModal();
            }
          });
        }
        preferModal = modalQuery.matches;
      };

      updateModalPreference();

      const revealLeadCapture = () => {
        if (shouldUseModal()) {
          openModal();
          return;
        }
        shell.classList.add('is-expanded');
        shell.classList.remove('is-collapsed');
        shell.classList.remove('cta-visible');
        floatingCta?.setAttribute('aria-hidden', 'true');
        const firstField = form.querySelector('input, select, textarea');
        firstField?.focus();
        form.scrollIntoView({ behavior: 'smooth', block: 'center' });
      };

      closeControls.forEach((control) => {
        control.addEventListener('click', closeModal);
      });
      overlay?.addEventListener('click', closeModal);

      window.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') {
          closeModal();
        }
      });
      window.addEventListener('resize', updateModalPreference);

      function handleScrollReveal() {
        if (!deferDisplay || !floatingCta || !showFloatingCta) return;
        shell.classList.add('is-collapsed');

        const showCta = () => {
          const maxScroll = document.documentElement.scrollHeight - window.innerHeight;
          const progress = maxScroll <= 0 ? 1 : window.scrollY / maxScroll;
          if (progress >= SCROLL_THRESHOLD) {
            shell.classList.add('cta-visible');
            floatingCta.removeAttribute('aria-hidden');
            window.removeEventListener('scroll', onScroll);
          }
        };

        let ticking = false;
        const onScroll = () => {
          if (ticking) return;
          ticking = true;
          requestAnimationFrame(() => {
            showCta();
            ticking = false;
          });
        };

        window.addEventListener('scroll', onScroll, { passive: true });
        setTimeout(showCta, 8000);

        floatingCta.addEventListener('click', revealLeadCapture);
      }

      handleScrollReveal();

      function attachAnchorReveal() {
        if (!shell.id) return;
        const inlineAnchors = Array.from(document.querySelectorAll(`a[href="#${shell.id}"]`));
        if (inlineAnchors.length === 0) return;

        inlineAnchors.forEach((anchor) => {
          anchor.addEventListener('click', (event) => {
            if (!shell.classList.contains('is-collapsed')) return;
            if (!deferDisplay || !showFloatingCta) return;
            if (shouldUseModal()) return;
            event.preventDefault();
            revealLeadCapture();
          });
        });
      }

      attachAnchorReveal();

      if (isGlobalFallback) {
        const portalQueueKey = '__hoaLacLeadPortalQueue__';
        window.addEventListener('lead-form:request-open', openModal);
        window.addEventListener('lead-form:request-close', closeModal);

        window.__hoaLacLeadPortal = {
          open: () => openModal(),
          close: () => closeModal()
        };

        const queue = window[portalQueueKey];
        if (Array.isArray(queue) && queue.length > 0) {
          while (queue.length > 0) {
            const action = queue.shift();
            if (action === 'open') {
              openModal();
            } else if (action === 'close') {
              closeModal();
            }
          }
        }
        window[portalQueueKey] = [];
      }

      form.addEventListener('submit', (event) => {
        submitLead({
          event,
          form,
          setStatus,
          fieldErrors,
          sectionFlow,
          endpoint,
          leadTagInput,
          fallbackLeadTag,
          onSuccess: () => {
            if (shell.classList.contains('is-modal-open')) {
              setTimeout(() => closeModal(), 2000);
            }
          }
        });
      });
    }

    function createStatusSetter(statusEl) {
      const setter = (message = '', state = 'info') => {
        if (!statusEl) return;
        const text = message ?? '';
        statusEl.textContent = text;
        if (text) {
          statusEl.dataset.state = state;
        } else {
          statusEl.removeAttribute('data-state');
        }
        setter.currentMessage = text;
        setter.currentState = text ? state : undefined;
      };
      setter.currentMessage = statusEl?.textContent ?? '';
      setter.currentState = statusEl?.dataset?.state;
      return setter;
    }

    function handleAreaLimit(event, form, setStatus, fieldErrors) {
      const checkedAreas = form.querySelectorAll('input[name="areas"]:checked');
      if (checkedAreas.length > AREA_LIMIT) {
        event.target.checked = false;
        setStatus(`Chỉ chọn tối đa ${AREA_LIMIT} khu vực.`, 'error');
        fieldErrors?.set('areas', `Chỉ chọn tối đa ${AREA_LIMIT} khu vực.`);
        focusField(event.target);
        return;
      }
      if (typeof setStatus === 'function' && setStatus.currentMessage?.includes('Chỉ chọn tối đa')) {
        setStatus('');
      }
      fieldErrors?.clear('areas');
    }

    function getSelectedAreaLabels(form) {
      return Array.from(form.querySelectorAll('input[name="areas"]:checked'))
        .map((input) => input.nextElementSibling?.textContent?.trim())
        .filter((label) => Boolean(label));
    }

    function broadcastIntentChange(intentValue) {
      if (typeof window === 'undefined' || !intentValue) return;
      window.dispatchEvent(new CustomEvent('lead-intent-change', {
        detail: { intent: intentValue }
      }));
    }

    function broadcastAreasChange(labels) {
      if (typeof window === 'undefined') return;
      window.dispatchEvent(new CustomEvent('lead-areas-change', {
        detail: { areas: labels }
      }));
    }

    function setupValidationListeners(form, fieldErrors, setStatus) {
      if (!form) return;
      SECTION_FLOW.forEach((key) => {
        const group = form.querySelector(`[data-field-group="${key}"]`);
        if (!group) return;
        const inputs = group.querySelectorAll('input, select, textarea');
        inputs.forEach((input) => {
          const eventName = input.type === 'radio' || input.type === 'checkbox' ? 'change' : 'input';
          input.addEventListener(eventName, () => {
            const result = validateSection(key, form);
            if (result.valid) {
              fieldErrors?.clear(key);
              if (allSectionsValid(form) && setStatus?.currentState !== 'success') {
                setStatus?.('');
              }
            } else if (result.message) {
              fieldErrors?.set(key, result.message);
            }
          });
        });
      });

      form.addEventListener('reset', () => {
        fieldErrors?.clearAll();
      });
    }

    function serializeForm(formElement) {
      const formData = new FormData(formElement);
      const data = Object.fromEntries(formData);
      const selectedAreas = formData.getAll('areas');
      if (selectedAreas.length > 0) {
        data.areas = selectedAreas.join(', ');
      }
      return data;
    }

    function computeLeadTag({ intent, budgetRange, legalRisk, areas }) {
      let score = 0;
      score += intentWeights[intent] ?? 0;
      score += budgetWeights[budgetRange] ?? 0;
      score += legalWeights[legalRisk] ?? 0;
      if (areas?.some((area) => priorityAreas.includes(area))) {
        score += 1;
      }

      if (intent === 'luot_song' && legalRisk === 'co_the_rui_ro') {
        return 'lead_cold';
      }
      if (score >= 6) {
        return 'lead_hot';
      }
      if (score >= 3) {
        return 'lead_warm';
      }
      return 'lead_cold';
    }

    async function submitLead({ event, form, setStatus, fieldErrors, sectionFlow, endpoint, leadTagInput, fallbackLeadTag, onSuccess }) {
      event.preventDefault();
      if (!form) return;

      const validation = runSequentialValidation({ form, fieldErrors, setStatus });
      if (!validation.ok) {
        focusSection(validation.section, form);
        return;
      }

      const selectedAreaValues = Array.from(form.querySelectorAll('input[name="areas"]:checked')).map((input) => input.value);

      const now = new Date();
      const vnDateTime = now.toLocaleString('vi-VN', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        hour12: false
      });

      const data = serializeForm(form);
      data.areas = selectedAreaValues.join(', ');
      const computedTag = computeLeadTag({
        intent: data.intent,
        budgetRange: data.budgetRange,
        legalRisk: data.legalRisk,
        areas: selectedAreaValues
      }) ?? fallbackLeadTag;
      data.leadTag = computedTag;
      if (typeof data.contact === 'string') {
        data.contact = data.contact.replace(/\s+/g, '').replace(/^0*/, (match) => (match ? '0' : ''));
      }
      if (leadTagInput) {
        leadTagInput.value = computedTag;
      }
      data.submittedAt = now.toISOString();
      data.submittedAtLocal = vnDateTime;

      if (data.company) {
        setStatus?.('Đã chặn spam.', 'warning');
        return;
      }

      if (!endpoint) {
        setStatus?.('Chưa cấu hình PUBLIC_LEAD_ENDPOINT.', 'error');
        return;
      }

      setStatus?.('Đang gửi...', 'info');
      try {
        const body = new URLSearchParams();
        Object.entries(data).forEach(([key, value]) => {
          body.append(key, typeof value === 'string' ? value : String(value ?? ''));
        });

        const response = await fetch(endpoint, {
          method: 'POST',
          body
        });

        if (response.ok) {
          let payloadMessage = 'Đã nhận thông tin!';
          try {
            const payload = await response.json();
            if (payload?.message) payloadMessage = payload.message;
          } catch (parseErr) {
            console.warn('Không parse được payload, dùng message mặc định.', parseErr);
          }
          setStatus?.(payloadMessage, 'success');
          form.reset();
          sectionFlow?.reset?.();
          fieldErrors?.clearAll();
          if (typeof onSuccess === 'function') {
            onSuccess();
          }
          return;
        }

        throw new Error(`Request failed with status ${response.status}`);
      } catch (error) {
        console.error(error);
        if (error instanceof TypeError) {
          setStatus?.('Đã nhận thông tin!', 'success');
          if (typeof onSuccess === 'function') {
            onSuccess();
          }
          form.reset();
          sectionFlow?.reset?.();
          fieldErrors?.clearAll();
        } else {
          setStatus?.('Không gửi được, vui lòng thử lại.', 'error');
        }
      }
    }

    function runSequentialValidation({ form, fieldErrors, setStatus }) {
      if (!form) {
        return { ok: false, section: undefined };
      }
      for (const key of SECTION_FLOW) {
        const result = validateSection(key, form);
        if (!result.valid) {
          if (result.message) {
            fieldErrors?.set(key, result.message);
            setStatus?.(result.message, 'error');
          }
          return { ok: false, section: key };
        }
        fieldErrors?.clear(key);
      }
      if (setStatus?.currentState !== 'success') {
        setStatus?.('');
      }
      return { ok: true };
    }

    function createFieldErrorRegistry(form) {
      const errorNodes = new Map();
      form.querySelectorAll('[data-error-for]').forEach((node) => {
        if (!(node instanceof HTMLElement)) return;
        const key = node.dataset.errorFor;
        if (!key) return;
        errorNodes.set(key, node);
        node.setAttribute('hidden', 'hidden');
      });

      const getGroup = (key) => form.querySelector(`[data-field-group="${key}"]`);

      const set = (key, message = '') => {
        if (!key) return;
        const node = errorNodes.get(key);
        const text = message?.trim() ?? '';
        if (node) {
          if (text) {
            node.textContent = text;
            node.removeAttribute('hidden');
          } else {
            node.textContent = '';
            node.setAttribute('hidden', 'hidden');
          }
        }
        const group = getGroup(key);
        if (group) {
          if (text) {
            group.classList.add('is-invalid');
          } else {
            group.classList.remove('is-invalid');
          }
        }
      };

      const clear = (key) => set(key, '');
      const clearAll = () => {
        errorNodes.forEach((_node, key) => {
          clear(key);
        });
      };

      return { set, clear, clearAll };
    }

    function focusField(field) {
      if (!field) return;
      requestAnimationFrame(() => {
        if (typeof field.scrollIntoView === 'function') {
          field.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'nearest' });
        }
        if (typeof field.focus === 'function') {
          field.focus({ preventScroll: true });
        }
      });
    }

    function getFieldErrorKey(field) {
      if (!field) return '';
      if (field.name) return field.name;
      if (field.dataset?.errorKey) return field.dataset.errorKey;
      const group = field.closest('[data-field-group]');
      return group instanceof HTMLElement ? group.dataset.fieldGroup ?? '' : '';
    }

    function setupSectionFlow(form, fieldErrors) {
      if (!form) return null;
      const completedSections = new Set();

      const handleProgress = (key) => {
        if (!isSectionComplete(key, form)) {
          completedSections.delete(key);
          return;
        }
        if (completedSections.has(key)) {
          return;
        }
        completedSections.add(key);
        fieldErrors?.clear(key);
        const nextKey = getNextSectionKey(key);
        if (nextKey) {
          focusSection(nextKey, form);
        } else {
          const submitButton = form.querySelector('button[type="submit"]');
          focusField(submitButton);
        }
      };

      SECTION_FLOW.forEach((key) => {
        const group = form.querySelector(`[data-field-group="${key}"]`);
        if (!group) return;
        const inputs = group.querySelectorAll('input, select, textarea');
        inputs.forEach((input) => {
          const eventName = input.type === 'radio' || input.type === 'checkbox' ? 'change' : 'input';
          input.addEventListener(eventName, () => handleProgress(key));
        });
      });

      return {
        reset: () => completedSections.clear()
      };
    }

    function isSectionComplete(key, form) {
      switch (key) {
        case 'intent':
        case 'budgetRange':
        case 'legalRisk':
          return Boolean(form.querySelector(`input[name="${key}"]:checked`));
        case 'areas':
          return form.querySelectorAll('input[name="areas"]:checked').length > 0;
        case 'contact': {
          const input = form.querySelector('input[name="contact"]');
          const value = input?.value?.trim() ?? '';
          return PHONE_PATTERN.test(value);
        }
        default:
          return true;
      }
    }

    function validateSection(key, form) {
      switch (key) {
        case 'intent': {
          const checked = form.querySelector('input[name="intent"]:checked');
          return checked ? { valid: true } : { valid: false, message: SECTION_MESSAGES.intent };
        }
        case 'budgetRange': {
          const checked = form.querySelector('input[name="budgetRange"]:checked');
          return checked ? { valid: true } : { valid: false, message: SECTION_MESSAGES.budgetRange };
        }
        case 'areas': {
          const checkedCount = form.querySelectorAll('input[name="areas"]:checked').length;
          if (checkedCount === 0) {
            return { valid: false, message: SECTION_MESSAGES.areas };
          }
          if (checkedCount > AREA_LIMIT) {
            return { valid: false, message: `Chỉ chọn tối đa ${AREA_LIMIT} khu vực.` };
          }
          return { valid: true };
        }
        case 'legalRisk': {
          const checked = form.querySelector('input[name="legalRisk"]:checked');
          return checked ? { valid: true } : { valid: false, message: SECTION_MESSAGES.legalRisk };
        }
        case 'contact': {
          const input = form.querySelector('input[name="contact"]');
          const value = input?.value?.trim() ?? '';
          if (!value) {
            return { valid: false, message: 'Vui lòng nhập số liên hệ.' };
          }
          if (!PHONE_PATTERN.test(value)) {
            return { valid: false, message: 'Số liên hệ phải đủ 10 số và bắt đầu bằng 03, 05, 07, 08, 09 hoặc 01[2|6|8|9].' };
          }
          return { valid: true };
        }
        default:
          return { valid: true };
      }
    }

    function focusSection(key, form) {
      if (!key || !form) return;
      const group = form.querySelector(`[data-field-group="${key}"]`);
      if (!group) return;
      const focusable = group.querySelector('input:not([type="hidden"]), select, textarea, button');
      if (focusable) {
        focusField(focusable);
      }
    }

    function getNextSectionKey(key) {
      const index = SECTION_FLOW.indexOf(key);
      if (index === -1) return undefined;
      return SECTION_FLOW[index + 1];
    }

    function allSectionsValid(form) {
      return SECTION_FLOW.every((key) => validateSection(key, form).valid);
    }

    function applySequentialTabIndex(form) {
      if (!form) return;
      const focusableSelectors = [
        'input:not([type="hidden"]):not(.hp)',
        'select',
        'textarea',
        'button'
      ].join(',');
      const focusables = Array.from(form.querySelectorAll(focusableSelectors));
      let order = 1;
      focusables.forEach((node) => {
        if (node instanceof HTMLInputElement || node instanceof HTMLSelectElement || node instanceof HTMLTextAreaElement || node instanceof HTMLButtonElement) {
          if (node.disabled || node.tabIndex < 0) {
            return;
          }
          node.tabIndex = order;
          order += 1;
        }
      });
    }
  })();
</script> <script type="module">
      const anchors = Array.from(document.querySelectorAll('a[href="#lead-form"]'));
      const portalQueueKey = '__hoaLacLeadPortalQueue__';
      window[portalQueueKey] = window[portalQueueKey] || [];

      const requestPortalOpen = () => {
        window.dispatchEvent(new CustomEvent('lead-form:request-open', {
          detail: { source: 'global-nav' }
        }));

        if (window.__hoaLacLeadPortal?.open) {
          window.__hoaLacLeadPortal.open();
          return;
        }

        window[portalQueueKey].push('open');
      };

      anchors.forEach((anchor) => {
        anchor.addEventListener('click', (event) => {
          const inlineForm = document.getElementById('lead-form');
          if (inlineForm) {
            return;
          }
          event.preventDefault();
          requestPortalOpen();
        });
      });
    </script> <script type="module" src="data:video/mp2t;base64,aW1wb3J0IGluaXRUYWJsZUVuaGFuY2VyIGZyb20gJy4vdGFibGVFbmhhbmNlcic7DQoNCmluaXRUYWJsZUVuaGFuY2VyKHsgc2VsZWN0b3I6ICcucmVhZGluZy1jb250ZW50IHRhYmxlJyB9KTsNCmluaXRUYWJsZUVuaGFuY2VyKHsgc2VsZWN0b3I6ICcucGlsbGFyLWNvbnRlbnQgdGFibGUnIH0pOw0K"></script> </body> </html>