<!DOCTYPE html><html lang="vi"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Quy trình kiểm tra sổ đỏ Hòa Lạc: 6 bước xác nhận pháp lý trước khi đặt cọc</title><meta name="description" content="Quy trình 6 bước để kiểm tra sổ đỏ, nguồn gốc và rủi ro quy hoạch tại Hòa Lạc trước khi xuống tiền trong giai đoạn 2026."><meta property="og:title" content="Quy trình kiểm tra sổ đỏ Hòa Lạc: 6 bước xác nhận pháp lý trước khi đặt cọc"><meta property="og:description" content="Quy trình 6 bước để kiểm tra sổ đỏ, nguồn gốc và rủi ro quy hoạch tại Hòa Lạc trước khi xuống tiền trong giai đoạn 2026."><meta property="og:type" content="website"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&family=Playfair+Display:wght@500;600;700&display=swap" rel="stylesheet"><link rel="stylesheet" href="/hoalac_marketing/_astro/_slug_.Db8Iv-6v.css">
<style>.reading-cta[data-astro-cid-4sn4zg3r]{margin-top:4rem}
</style></head> <body> <header class="site-header"> <div class="site-header__inner"> <a href="/hoalac_marketing" class="site-brand"> <span class="site-brand__title">Insight Hòa Lạc</span> <span class="site-brand__subtitle">Bản tin dữ liệu &amp; funnel 2026</span> </a> <nav class="site-nav" aria-label="Điều hướng chính"> <a href="#lead-form" class="site-nav__pill"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"> <path d="M8 6h8"></path> <path d="M8 12h8"></path> <path d="M8 18h5"></path> <rect x="4" y="3" width="16" height="18" rx="2" ry="2"></rect> </svg> <span>Form tư vấn</span> </a> <a href="/hoalac_marketing/blog" class="site-nav__pill site-nav__pill--accent"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"> <path d="M4 19.5C4 18.12 5.12 17 6.5 17h13"></path> <path d="M4 4.5C4 5.88 5.12 7 6.5 7h13"></path> <path d="M6.5 7C5.12 7 4 5.88 4 4.5V19.5C4 18.12 5.12 17 6.5 17"></path> <path d="M19.5 7C20.88 7 22 5.88 22 4.5V19.5C22 18.12 20.88 17 19.5 17"></path> </svg> <span>Bài viết</span> </a> <a href="/hoalac_marketing/pillars" class="site-nav__pill"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"> <circle cx="12" cy="12" r="3.5"></circle> <path d="M12 2v3"></path> <path d="M12 19v3"></path> <path d="M4 12h3"></path> <path d="M17 12h3"></path> </svg> <span>Trung tâm trụ cột</span> </a> </nav> </div> <div class="site-header__meta"> <a href="mailto:contact@example.com" class="site-meta__item">contact@example.com</a> <span class="site-meta__divider" aria-hidden="true">•</span> <a href="https://t.me/" class="site-meta__item" target="_blank" rel="noreferrer">Telegram cập nhật</a> </div> </header> <main class="site-main">  <article class="reading-shell" data-astro-cid-4sn4zg3r> <div class="reading-meta" data-astro-cid-4sn4zg3r>  <p data-astro-cid-4sn4zg3r>19/1/2026</p> </div> <h1 class="reading-title" data-astro-cid-4sn4zg3r>Quy trình kiểm tra sổ đỏ Hòa Lạc: 6 bước xác nhận pháp lý trước khi đặt cọc</h1> <div class="reading-content" data-astro-cid-4sn4zg3r> <p>Nhà đầu tư và người mua để ở tại Hòa Lạc thường cảm thấy thiếu tự tin trước khi đặt cọc vì hồ sơ địa chính phức tạp, lịch sử chuyển đổi mục đích đa tầng và tốc độ điều chỉnh quy hoạch diễn ra liên tục. Báo cáo của Phòng Tài nguyên &#x26; Môi trường huyện Thạch Thất (12/2025) cho biết 17% hồ sơ chuyển nhượng bị trả lại do sai thông tin thửa đất hoặc vướng tranh chấp tài sản gắn liền. Bài viết này tổng hợp một quy trình kiểm tra sổ đỏ gồm 6 bước, giúp người mua tự đối chiếu với thực tế và nhận diện rủi ro ngay từ giai đoạn thương lượng.</p>
<h2 id="1-vì-sao-cần-một-quy-trình-rõ-ràng-khi-kiểm-tra-sổ-đỏ-hòa-lạc">1. Vì sao cần một quy trình rõ ràng khi kiểm tra sổ đỏ Hòa Lạc?</h2>
<ul>
<li><strong>Nguồn gốc sử dụng đa dạng</strong>: đất nông nghiệp xen kẽ đất thổ cư, đất trong quy hoạch R&#x26;D hoặc quỹ tái định cư khiến sổ đỏ dễ có phụ lục phức tạp.</li>
<li><strong>Chính sách phân lô bị siết lại</strong>: từ 2025, huyện Quốc Oai và Thạch Thất áp dụng hạn chế tách thửa dưới 60 m² tại các trục đang chờ nâng cấp. Người mua phải chắc chắn thửa không vi phạm quy định mới.</li>
<li><strong>Hệ thống dữ liệu số hóa chưa đồng bộ</strong>: thông tin trên sổ đỏ giấy có thể chưa cập nhật biến động mới nhất, nhất là với các thửa từng tham gia dự án đầu tư công.</li>
</ul>
<p>Nếu không chuẩn hóa quy trình, người mua rất dễ bỏ sót nghĩa vụ tài chính, sai sót đo đạc hoặc thậm chí giao dịch nhầm thửa đang có lệnh thu hồi. Một quy trình chuẩn còn giúp khi làm việc với luật sư, ngân hàng hay môi giới, mọi bên nói cùng “ngôn ngữ” và giảm thời gian rà soát.</p>
<h2 id="2-khung-quy-trình-6-bước">2. Khung quy trình 6 bước</h2>















































<table><thead><tr><th>Bước</th><th>Nội dung chính</th><th>Người phụ trách</th><th>Sản phẩm đầu ra</th></tr></thead><tbody><tr><td>1</td><td>Thu thập bản gốc và bản sao hồ sơ sổ đỏ</td><td>Người bán + người mua</td><td>Bộ hồ sơ đầy đủ, biên bản giao nhận</td></tr><tr><td>2</td><td>Đối chiếu thông tin thửa và đo đạc thực địa</td><td>Đội đo đạc hoặc văn phòng đăng ký</td><td>Biên bản xác nhận diện tích, mốc giới</td></tr><tr><td>3</td><td>Tra cứu quy hoạch, hành lang an toàn</td><td>Người mua + cán bộ địa chính</td><td>Phiếu trích đo hoặc văn bản xác nhận quy hoạch</td></tr><tr><td>4</td><td>Kiểm tra lịch sử giao dịch, nghĩa vụ tài chính</td><td>Văn phòng công chứng, thuế</td><td>Giấy xác nhận tình trạng pháp lý, biên lai thuế</td></tr><tr><td>5</td><td>Soát rủi ro tranh chấp, thế chấp</td><td>Tòa án, ngân hàng, CIC</td><td>Văn bản xác nhận không tranh chấp/thế chấp</td></tr><tr><td>6</td><td>Chuẩn bị hồ sơ đặt cọc, phụ lục cam kết</td><td>Người mua</td><td>Bộ checklist, deadline theo tiến độ</td></tr></tbody></table>
<p>Phần tiếp theo đi sâu từng bước với ví dụ cụ thể tại Hòa Lạc.</p>
<h2 id="3-bước-1--thu-thập-hồ-sơ-gốc-và-lập-biên-bản-bàn-giao">3. Bước 1 – Thu thập hồ sơ gốc và lập biên bản bàn giao</h2>
<p>Yêu cầu người bán cung cấp bản gốc sổ đỏ, quyết định giao đất (nếu có), sơ đồ kỹ thuật kèm toàn bộ phụ lục biến động từ năm 2010 đến nay. Nên lập biên bản bàn giao ghi rõ số lượng trang, tình trạng hồ sơ. Nếu sổ đỏ cũ bị nhòe, hãy đề nghị sao y tại Văn phòng Đăng ký đất đai Hòa Lạc để tránh tranh luận khi soạn hợp đồng. Đây cũng là thời điểm đối chiếu thông tin chủ sở hữu với giấy tờ tùy thân để phát hiện dấu hiệu ủy quyền giả hoặc đồng sở hữu chưa thống nhất.</p>
<h2 id="4-bước-2--đo-đạc-và-đối-chiếu-thông-tin-thửa">4. Bước 2 – Đo đạc và đối chiếu thông tin thửa</h2>
<p>Tại Hòa Lạc, nhiều thửa được hợp thửa hoặc tách thửa sau quá trình dồn điền đổi thửa. Vì vậy, nên thuê tổ đo đạc độc lập hoặc sử dụng dịch vụ của Văn phòng Đăng ký đất đai để xác nhận diện tích thực tế. Khi so sánh với dữ liệu trên sổ đỏ, hãy chú ý:</p>
<ol>
<li><strong>Sai số diện tích</strong>: nếu chênh lệch trên 0,5% so với diện tích ghi trong giấy, cần làm thủ tục điều chỉnh trước khi đặt cọc lớn.</li>
<li><strong>Mốc giới trùng đường quy hoạch</strong>: nhiều khu đất nằm sát hành lang thoát nước hoặc đường gom Đại lộ Thăng Long; mốc cây số trên thực địa cần trùng với bản đồ 1/2000.</li>
<li><strong>Công trình phụ phát sinh</strong>: chuồng trại, nhà xưởng xây không phép sẽ khiến hồ sơ hoàn công bị từ chối, ảnh hưởng quyền sử dụng lâu dài.</li>
</ol>
<p>Việc đo đạc sớm giúp tránh rủi ro tranh chấp ranh giới với hàng xóm khi chuyển đổi mục đích hoặc xin giấy phép xây dựng.</p>
<h2 id="5-bước-3--tra-cứu-quy-hoạch-và-hành-lang-bảo-vệ">5. Bước 3 – Tra cứu quy hoạch và hành lang bảo vệ</h2>
<p>Bước này cần kết hợp tra cứu trực tuyến tại cổng thông tin quy hoạch Hà Nội, dữ liệu GIS của Ban Quản lý Khu Công nghệ cao, và xác nhận trực tiếp tại UBND xã. Những điểm bắt buộc kiểm tra:</p>
<ul>
<li><strong>Loại đất hiện tại và định hướng</strong>: đất trồng cây lâu năm nằm trong quy hoạch đất ở nông thôn sẽ dễ chuyển mục đích hơn đất nằm trong vùng hỗn hợp công nghệ cao.</li>
<li><strong>Hành lang an toàn giao thông, thủy lợi, quốc phòng</strong>: một số thửa ở Phú Cát, Thạch Hòa nằm gần đường điện 220 kV hoặc suối Tân Xã; dù sổ đỏ không ghi chú, nhưng quy hoạch mới có thể bổ sung corridor hạn chế xây dựng.</li>
<li><strong>Chỉ giới đường đỏ tương lai</strong>: nếu thửa đất bị cắt bởi đường gom dự kiến, cần làm rõ phần diện tích bị thu hồi và phương án bồi thường.</li>
</ul>
<p>Sau khi có thông tin, hãy lưu lại ảnh chụp màn hình bản đồ, đóng dấu treo của UBND xã hoặc xin phiếu cung cấp thông tin quy hoạch. Đây là bằng chứng quan trọng khi đàm phán giá.</p>
<h2 id="6-bước-4--kiểm-tra-lịch-sử-giao-dịch-và-nghĩa-vụ-tài-chính">6. Bước 4 – Kiểm tra lịch sử giao dịch và nghĩa vụ tài chính</h2>
<p>Tại bước này, người mua nên làm việc với văn phòng công chứng đã từng xử lý hồ sơ khu vực Hòa Lạc để tra cứu:</p>
<ul>
<li><strong>Các lần chuyển nhượng trước</strong>: nếu sổ đỏ vừa sang tên dưới 12 tháng, cần xem hợp đồng cũ và biên lai nộp thuế để đánh giá rủi ro “lướt sóng”.</li>
<li><strong>Nghĩa vụ tài chính tồn đọng</strong>: thuế đất phi nông nghiệp, tiền chuyển mục đích, phí đo vẽ còn thiếu sẽ trở thành trách nhiệm của chủ mới nếu không thỏa thuận rõ.</li>
<li><strong>Giấy phép xây dựng tạm</strong>: nhiều thửa ở khu kỹ thuật hỗ trợ chỉ được xây công trình tạm 1–2 tầng; kiểm tra xem chủ cũ có vi phạm hay không để tránh bị cưỡng chế sau khi nhận đất.</li>
</ul>
<p>Một bản sao giấy xác nhận hoàn thành nghĩa vụ tài chính do Chi cục Thuế Quốc Oai cấp sẽ giúp giai đoạn công chứng diễn ra suôn sẻ.</p>
<h2 id="7-bước-5--soát-tranh-chấp-và-tình-trạng-thế-chấp">7. Bước 5 – Soát tranh chấp và tình trạng thế chấp</h2>
<p>Hỏi trực tiếp tại Tòa án nhân dân cấp huyện và Phòng Tài nguyên &#x26; Môi trường về các vụ việc đang thụ lý liên quan tới thửa đất. Nếu địa phương chưa số hóa, cần gửi công văn và chờ phản hồi. Đồng thời, liên hệ các ngân hàng lớn trong khu vực (Agribank Thạch Thất, BIDV Sơn Tây) để xác nhận sổ đỏ có đang được thế chấp hay không. Một số lưu ý:</p>
<ul>
<li>Yêu cầu chủ đất cung cấp văn bản giải chấp hoặc cam kết giải chấp trước ngày công chứng.</li>
<li>Nếu chủ đất đang dùng hạn mức tín chấp dựa trên giá trị bất động sản, cần kiểm tra hợp đồng tín dụng để biết khả năng ngân hàng phong tỏa sổ đỏ.</li>
<li>Với thửa đất thuộc sở hữu hộ gia đình đông thành viên, mọi đồng sở hữu phải ký văn bản đồng ý chuyển nhượng.</li>
</ul>
<h2 id="8-bước-6--chuẩn-bị-hồ-sơ-đặt-cọc-và-phụ-lục-cam-kết">8. Bước 6 – Chuẩn bị hồ sơ đặt cọc và phụ lục cam kết</h2>
<p>Khi năm bước trên đã rõ ràng, người mua mới tiến hành đặt cọc. Bộ hồ sơ nên gồm:</p>
<ul>
<li>Biên bản điều kiện đặt cọc (ghi rõ tiến độ cấp sổ, nghĩa vụ tài chính chưa hoàn thành, phương án xử lý nếu phát hiện sai phạm).</li>
<li>Phụ lục cam kết của người bán về việc hỗ trợ thủ tục chuyển mục đích, hoàn công hoặc giải chấp.</li>
<li>Checklist tài liệu đã kiểm tra, kèm ngày tháng và người xác nhận để tránh nhầm lẫn trong giai đoạn sang tên.</li>
</ul>
<p>Việc chuẩn bị kỹ giúp người mua thương lượng mức đặt cọc hợp lý, tránh bị ép tiến độ khi vẫn còn điểm chưa rõ.</p>
<p>Ngay sau bước này, hãy tham khảo bài <a href="/hoalac_marketing/blog/chien-luoc-giu-room-dau-tu-hoa-lac"><code>Chiến lược giữ room đầu tư Hòa Lạc 2026</code></a> để duy trì hạn mức tín dụng và pháp lý trong suốt giai đoạn BOFU.</p>
<h2 id="9-ví-dụ-thực-tế-thửa-đất-250-m-tại-tiến-xuân-giáp-hòa-lạc">9. Ví dụ thực tế: Thửa đất 250 m² tại Tiến Xuân giáp Hòa Lạc</h2>
<p>Một nhà đầu tư cá nhân tìm mua đất xây homestay ở Tiến Xuân cuối 2025. Thửa đất 250 m² có sổ đỏ đất trồng cây lâu năm, nằm trong khu vực sẽ chuyển thành đất ở nông thôn sau 2026. Áp dụng quy trình trên, nhóm tư vấn phát hiện:</p>
<ol>
<li>Diện tích thực tế 247 m² do bị xén 3 m² vào hành lang suối, nhưng sổ đỏ chưa cập nhật.</li>
<li>Chủ cũ thế chấp ở ngân hàng để vay vốn mở xưởng gỗ; ngân hàng yêu cầu tối thiểu 10 ngày để giải chấp.</li>
<li>UBND xã xác nhận tuyến đường bê tông trước nhà sẽ mở rộng lên 10 m, ảnh hưởng 18 m² mặt tiền.</li>
</ol>
<p>Kết quả, giá mua được thương lượng giảm 8%, và điều khoản đặt cọc chỉ có hiệu lực sau khi ngân hàng giải chấp. Trường hợp này cho thấy quy trình giúp người mua chủ động hơn, tránh bị cuốn theo kỳ vọng giá.</p>
<h2 id="10-bộ-hồ-sơ-nên-chuẩn-bị-sẵn">10. Bộ hồ sơ nên chuẩn bị sẵn</h2>
<ul>
<li>02 bản sao công chứng sổ đỏ và CMND/CCCD của bên bán.</li>
<li>Phiếu cung cấp thông tin quy hoạch có dấu của UBND xã hoặc Sở Quy hoạch – Kiến trúc.</li>
<li>Biên bản đo đạc, tọa độ VN-2000.</li>
<li>Giấy xác nhận hoàn thành nghĩa vụ tài chính và biên lai thuế đất phi nông nghiệp gần nhất.</li>
<li>Văn bản xác nhận tình trạng thế chấp từ ngân hàng.</li>
<li>Các quyết định hành chính liên quan (thu hồi, giao đất, phê duyệt dự án lân cận).</li>
</ul>
<p>Sắp xếp các tài liệu này trong một thư mục số hóa giúp quá trình làm việc với luật sư, ngân hàng hoặc bên mua lại lần sau dễ dàng hơn.</p>
<h2 id="11-những-rủi-ro-và-dấu-hiệu-cần-cảnh-giác">11. Những rủi ro và dấu hiệu cần cảnh giác</h2>
<ol>
<li><strong>Sổ đỏ photo hoặc hình ảnh không đủ dấu giáp lai</strong>: dễ xuất hiện trong các giao dịch môi giới thứ cấp; tuyệt đối không đặt cọc khi chưa xem bản gốc.</li>
<li><strong>Thông tin thửa đất bị bôi xóa, sửa tay</strong>: tại Hòa Lạc, nhiều hộ đã điều chỉnh diện tích nhưng không in lại sổ; người mua cần yêu cầu cấp đổi trước khi chốt.</li>
<li><strong>Lời hứa “chuyển mục đích chắc chắn”</strong>: việc chuyển đổi còn phụ thuộc chỉ tiêu sử dụng đất hàng năm của huyện; nên yêu cầu văn bản xác nhận chỉ tiêu chứ không tin vào cam kết miệng.</li>
<li><strong>Tài sản chung của hộ gia đình</strong>: nếu có thành viên đang ở nước ngoài hoặc mất liên lạc, giao dịch có thể bị tuyên vô hiệu sau này.</li>
</ol>
<p>Phần “Bài học &#x26; rủi ro” nên được hoàn thiện cùng cố vấn pháp lý để đảm bảo mọi bên thống nhất phương án xử lý, đặc biệt khi giao dịch đã bước vào giai đoạn ra quyết định cuối (Bottom of Funnel) và sai sót nhỏ có thể khiến thương vụ đổ vỡ hoặc phát sinh tranh chấp kéo dài.</p>
<h2 id="12-gợi-ý-phối-hợp-và-theo-dõi-tiến-độ">12. Gợi ý phối hợp và theo dõi tiến độ</h2>
<ul>
<li><strong>Thiết lập bảng tiến độ</strong>: ghi rõ thời gian hoàn tất từng bước, người phụ trách, tài liệu cần bàn giao.</li>
<li><strong>Gặp cán bộ địa chính theo lịch hẹn</strong>: chuẩn bị câu hỏi cụ thể, mang theo bản đồ và tọa độ để giảm thời gian chờ đợi.</li>
<li><strong>Sử dụng dịch vụ pháp lý theo nhu cầu</strong>: với giao dịch lớn hơn 5 tỷ đồng, nên ký hợp đồng dịch vụ với một văn phòng luật để đại diện kiểm tra tại tòa án, ngân hàng.</li>
<li><strong>Liên tục cập nhật dữ liệu</strong>: mỗi thay đổi liên quan quy hoạch, thuế hoặc hành lang an toàn phải được ghi lại và thông báo cho bên bán.</li>
</ul>
<h2 id="13-kết-luận-mở">13. Kết luận mở</h2>
<p>Kiểm tra sổ đỏ ở Hòa Lạc không chỉ là xem giấy tờ mà là một quy trình đánh giá tổng hợp giữa pháp lý, quy hoạch và nghĩa vụ tài chính. Khi tuân thủ 6 bước trên, người mua có thể tự tin chuyển từ giai đoạn khảo sát sang giai đoạn thương lượng hợp đồng. Để đào sâu hơn về các tình huống pháp lý đặc thù, bạn có thể tham khảo hub <a href="/hoalac_marketing/pillars/phap-ly-va-rui-ro"><code>Pháp lý &#x26; rủi ro</code></a> và đối chiếu với bài <a href="/hoalac_marketing/blog/checklist-phap-ly-dat-vuon-tho-cu"><code>Checklist pháp lý đất vườn thổ cư</code></a> trước khi hoàn thiện bộ hồ sơ riêng.</p>
<p>Việc ghi chép chi tiết từng lần làm việc với cơ quan nhà nước, cũng như lưu trữ đầy đủ tài liệu số hóa, sẽ giúp bạn bảo vệ quyết định đầu tư ngay cả khi thị trường biến động hoặc kế hoạch quy hoạch thay đổi đột ngột.</p>
<script type="application/ld+json">
{
	"@context": "https://schema.org",
	"@type": "BlogPosting",
	"headline": "Quy trình kiểm tra sổ đỏ Hòa Lạc: 6 bước xác nhận pháp lý trước khi đặt cọc",
	"description": "Quy trình 6 bước để kiểm tra sổ đỏ, nguồn gốc và rủi ro quy hoạch tại Hòa Lạc trước khi xuống tiền trong giai đoạn 2026.",
	"datePublished": "2026-01-17",
	"dateModified": "2026-01-19",
	"author": {
		"@type": "Organization",
		"name": "Hòa Lạc Marketing"
	},
	"publisher": {
		"@type": "Organization",
		"name": "Hòa Lạc Marketing"
	}
}
</script> </div>  </article>  </main> <footer class="site-footer"> <div class="site-footer__inner"> <div> <p class="site-footer__brand">Insight Hòa Lạc © 2026</p> <p class="site-footer__copy">Landing page thử nghiệm GitHub Pages + funnel marketing.</p> </div> <div class="site-footer__links"> <a href="/hoalac_marketing/blog">Truy cập blog</a> <a href="#lead-form" class="site-footer__cta">Đăng ký tư vấn</a> </div> <div class="site-footer__contact"> <a href="mailto:contact@example.com">contact@example.com</a> <a href="https://t.me/" target="_blank" rel="noreferrer">Telegram</a> </div> </div> </footer> <section id="lead-form-global" class="section-shell section-shell--lead lead-shell--portal" data-lead-shell data-defer="true" data-endpoint="https://script.google.com/macros/s/AKfycbwM3REFLKfi9x765dPhBp2Hyd5hpEcx_DEL36kxudIMhnjCE5nIV7--HTeERxdpA-erLg/exec" data-global="true" data-force-modal="true" data-floating-enabled="false" data-astro-cid-xyq5hly5> <div class="lead-modal-overlay" data-lead-overlay aria-hidden="true" data-astro-cid-xyq5hly5></div> <div class="shell-inner lead-shell" data-astro-cid-xyq5hly5> <div class="lead-card" data-astro-cid-xyq5hly5> <div class="lead-copy" data-astro-cid-xyq5hly5> <p class="tag" data-astro-cid-xyq5hly5>Lead Qualification</p> <h2 data-astro-cid-xyq5hly5>Đánh giá mức phù hợp Hòa Lạc</h2> <p data-astro-cid-xyq5hly5>Trả lời 5 câu để đội ngũ gợi ý khu vực, pháp lý và room tài chính khớp với nhu cầu trong 24 giờ.</p> </div> <form class="lead-form" data-lead-form novalidate data-astro-cid-xyq5hly5> <button class="lead-form__close" type="button" data-lead-close aria-label="Đóng form" data-astro-cid-xyq5hly5> <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" data-astro-cid-xyq5hly5> <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" data-astro-cid-xyq5hly5></path> </svg> </button> <fieldset class="field" data-field-group="intent" data-astro-cid-xyq5hly5> <legend data-astro-cid-xyq5hly5>Anh/chị quan tâm đất Hòa Lạc để:</legend> <div class="option-grid" data-astro-cid-xyq5hly5> <label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="intent" value="o_thuc" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Ở thật</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="intent" value="dau_tu_trung_han" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Đầu tư trung hạn</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="intent" value="luot_song" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Lướt sóng</span> </div> </label> </div> </fieldset> <p class="field-error" data-error-for="intent" role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> <fieldset class="field" data-field-group="budgetRange" data-astro-cid-xyq5hly5> <legend data-astro-cid-xyq5hly5>Tầm tài chính:</legend> <div class="option-grid" data-astro-cid-xyq5hly5> <label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="budgetRange" value="<1.5" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>&lt; 1,5 tỷ</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="budgetRange" value="1.5-2.5" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>1,5 – 2,5 tỷ</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="budgetRange" value="2.5-3.5" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>2,5 – 3,5 tỷ</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="budgetRange" value=">3.5" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>&gt; 3,5 tỷ</span> </div> </label> </div> </fieldset> <p class="field-error" data-error-for="budgetRange" role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> <fieldset class="field" data-field-group="areas" data-astro-cid-xyq5hly5> <legend data-astro-cid-xyq5hly5>Khu vực ưu tiên:</legend> <p class="hint" data-astro-cid-xyq5hly5>Chọn tối đa 2 khu vực (nếu cần).</p> <div class="option-grid" data-astro-cid-xyq5hly5> <label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="gan_dhqg" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Gần ĐHQG</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="gan_cnc" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Gần khu CNC</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="binh_yen_thach_hoa" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Bình Yên – Thạch Hòa</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="tien_xuan_yen_binh" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Tiến Xuân – Yên Bình</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="hoa_lac_trung_tam" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Trung tâm Hòa Lạc</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="khu_tay_bac" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Cụm Tây Bắc</span> </div> </label> </div> </fieldset> <p class="field-error" data-error-for="areas" role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> <fieldset class="field" data-field-group="legalRisk" data-astro-cid-xyq5hly5> <legend data-astro-cid-xyq5hly5>Mức chấp nhận pháp lý:</legend> <div class="option-grid option-grid--legal" data-astro-cid-xyq5hly5> <label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="legalRisk" value="so_do_san" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Chỉ sổ đỏ</span> <small data-astro-cid-xyq5hly5>Nhận đất ở ngay, pháp lý chuẩn</small> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="legalRisk" value="cho_len_tho_cu" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Chờ lên thổ cư</span> <small data-astro-cid-xyq5hly5>Chấp nhận 6–12 tháng làm thủ tục</small> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="legalRisk" value="co_the_rui_ro" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Có thể rủi ro</span> <small data-astro-cid-xyq5hly5>Chấp nhận đất vườn, quy hoạch chờ</small> </div> </label> </div> </fieldset> <p class="field-error" data-error-for="legalRisk" role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> <div class="field" data-field-group="contact" data-astro-cid-xyq5hly5> <label data-astro-cid-xyq5hly5>Để lại Zalo / SĐT</label> <input type="tel" name="contact" required inputmode="tel" pattern="^(03|05|07|08|09|01[2689])[0-9]{8}$" placeholder="Zalo hoặc số điện thoại" data-astro-cid-xyq5hly5> <p class="field-error" data-error-for="contact" role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> </div> <input type="hidden" name="source" value="lead-portal" data-astro-cid-xyq5hly5> <input type="hidden" name="leadTag" value="pending_classification" data-lead-tag data-astro-cid-xyq5hly5> <input type="text" name="company" class="hp" tabindex="-1" autocomplete="off" data-astro-cid-xyq5hly5> <button class="button" type="submit" data-astro-cid-xyq5hly5>Gửi yêu cầu</button> <p class="status" data-status role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> </form> </div> </div>  </section>  <script type="module">
  (() => {
    const AREA_LIMIT = 2;
    const SCROLL_THRESHOLD = 0.65;
    const intentWeights = {
      o_thuc: 3,
      dau_tu_trung_han: 2,
      luot_song: 0
    };
    const budgetWeights = {
      '<1.5': 0,
      '1.5-2.5': 1,
      '2.5-3.5': 2,
      '>3.5': 3
    };
    const legalWeights = {
      so_do_san: 3,
      cho_len_tho_cu: 1,
      co_the_rui_ro: 0
    };
    const priorityAreas = ['gan_dhqg', 'gan_cnc'];
    const SECTION_FLOW = ['intent', 'budgetRange', 'areas', 'legalRisk', 'contact'];
    const SECTION_MESSAGES = {
      intent: 'Vui lòng chọn mục đích sử dụng.',
      budgetRange: 'Vui lòng chọn tầm tài chính.',
      areas: 'Vui lòng chọn ít nhất 1 khu vực ưu tiên.',
      legalRisk: 'Vui lòng chọn mức chấp nhận pháp lý.',
      contact: 'Vui lòng nhập số liên hệ hợp lệ.'
    };
    const PHONE_PATTERN = /^(03|05|07|08|09|01[2689])[0-9]{8}$/;

    const initKey = '__hoaLacLeadFormInit__';
    if (window[initKey]) {
      return;
    }

    window[initKey] = true;

    const boot = () => {
      const shells = Array.from(document.querySelectorAll('[data-lead-shell]'));
      shells.forEach((shell) => initLeadShell(shell));
    };

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', boot, { once: true });
    } else {
      boot();
    }

    function initLeadShell(shell) {
      const form = shell.querySelector('[data-lead-form]');
      if (!form) return;

      const status = shell.querySelector('[data-status]');
      const setStatus = createStatusSetter(status);
      const fieldErrors = createFieldErrorRegistry(form);
      const floatingCta = shell.querySelector('button[data-floating-cta]');
      const overlay = shell.querySelector('[data-lead-overlay]');
      const closeControls = Array.from(shell.querySelectorAll('[data-lead-close]'));
      const endpoint = shell.dataset.endpoint ?? '';
      const deferDisplay = shell.dataset.defer === 'true';
      const showFloatingCta = shell.dataset.floatingEnabled !== 'false';
      const isGlobalFallback = shell.dataset.global === 'true';
      const forceModal = shell.dataset.forceModal === 'true';
      const leadTagInput = form.querySelector('[data-lead-tag]');
      const fallbackLeadTag = leadTagInput?.value ?? 'pending_classification';
      let modalQuery;
      let preferModal = forceModal;
      let previousOverflow = '';

      setupValidationListeners(form, fieldErrors, setStatus);
      applySequentialTabIndex(form);
      const sectionFlow = setupSectionFlow(form, fieldErrors);
      form.addEventListener('reset', () => sectionFlow?.reset?.());

      const areaCheckboxes = form.querySelectorAll('input[name="areas"]');
      areaCheckboxes.forEach((checkbox) => {
        checkbox.addEventListener('change', (event) => handleAreaLimit(event, form, setStatus, fieldErrors));
      });

      const intentInputs = form.querySelectorAll('input[name="intent"]');
      intentInputs.forEach((input) => {
        input.addEventListener('change', () => broadcastIntentChange(input.value));
        if (input.checked) {
          broadcastIntentChange(input.value);
        }
      });

      const areaInputs = form.querySelectorAll('input[name="areas"]');
      areaInputs.forEach((input) => {
        input.addEventListener('change', () => broadcastAreasChange(getSelectedAreaLabels(form)));
      });

      const setBodyScrollLock = (locked) => {
        if (typeof document === 'undefined') return;
        if (locked) {
          previousOverflow = document.body.style.overflow;
          document.body.style.overflow = 'hidden';
        } else {
          document.body.style.overflow = previousOverflow;
        }
      };

      const closeModal = () => {
        if (!shell.classList.contains('is-modal-open')) return;
        shell.classList.remove('is-modal-open');
        overlay?.setAttribute('aria-hidden', 'true');
        setBodyScrollLock(false);
        form.reset();
        sectionFlow?.reset();
        if (leadTagInput) {
          leadTagInput.value = fallbackLeadTag;
        }
        setStatus('');
        fieldErrors.clearAll();
        shell.classList.remove('is-expanded');
        if (deferDisplay && showFloatingCta) {
          shell.classList.add('is-collapsed');
          shell.classList.add('cta-visible');
          floatingCta?.removeAttribute('aria-hidden');
        }
      };

      const openModal = () => {
        shell.classList.add('is-modal-open');
        shell.classList.add('is-expanded');
        shell.classList.remove('is-collapsed');
        shell.classList.remove('cta-visible');
        floatingCta?.setAttribute('aria-hidden', 'true');
        overlay?.removeAttribute('aria-hidden');
        setBodyScrollLock(true);
        const firstField = form.querySelector('input, select, textarea');
        firstField?.focus({ preventScroll: true });
      };

      const shouldUseModal = () => forceModal || preferModal;

      const updateModalPreference = () => {
        if (typeof window === 'undefined' || !deferDisplay || !showFloatingCta || forceModal) {
          return;
        }
        if (!modalQuery) {
          modalQuery = window.matchMedia('(max-width: 768px)');
          modalQuery.addEventListener('change', (event) => {
            preferModal = event.matches;
            if (!preferModal) {
              closeModal();
            }
          });
        }
        preferModal = modalQuery.matches;
      };

      updateModalPreference();

      const revealLeadCapture = () => {
        if (shouldUseModal()) {
          openModal();
          return;
        }
        shell.classList.add('is-expanded');
        shell.classList.remove('is-collapsed');
        shell.classList.remove('cta-visible');
        floatingCta?.setAttribute('aria-hidden', 'true');
        const firstField = form.querySelector('input, select, textarea');
        firstField?.focus();
        form.scrollIntoView({ behavior: 'smooth', block: 'center' });
      };

      closeControls.forEach((control) => {
        control.addEventListener('click', closeModal);
      });
      overlay?.addEventListener('click', closeModal);

      window.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') {
          closeModal();
        }
      });
      window.addEventListener('resize', updateModalPreference);

      function handleScrollReveal() {
        if (!deferDisplay || !floatingCta || !showFloatingCta) return;
        shell.classList.add('is-collapsed');

        const showCta = () => {
          const maxScroll = document.documentElement.scrollHeight - window.innerHeight;
          const progress = maxScroll <= 0 ? 1 : window.scrollY / maxScroll;
          if (progress >= SCROLL_THRESHOLD) {
            shell.classList.add('cta-visible');
            floatingCta.removeAttribute('aria-hidden');
            window.removeEventListener('scroll', onScroll);
          }
        };

        let ticking = false;
        const onScroll = () => {
          if (ticking) return;
          ticking = true;
          requestAnimationFrame(() => {
            showCta();
            ticking = false;
          });
        };

        window.addEventListener('scroll', onScroll, { passive: true });
        setTimeout(showCta, 8000);

        floatingCta.addEventListener('click', revealLeadCapture);
      }

      handleScrollReveal();

      function attachAnchorReveal() {
        if (!shell.id) return;
        const inlineAnchors = Array.from(document.querySelectorAll(`a[href="#${shell.id}"]`));
        if (inlineAnchors.length === 0) return;

        inlineAnchors.forEach((anchor) => {
          anchor.addEventListener('click', (event) => {
            if (!shell.classList.contains('is-collapsed')) return;
            if (!deferDisplay || !showFloatingCta) return;
            if (shouldUseModal()) return;
            event.preventDefault();
            revealLeadCapture();
          });
        });
      }

      attachAnchorReveal();

      if (isGlobalFallback) {
        const portalQueueKey = '__hoaLacLeadPortalQueue__';
        window.addEventListener('lead-form:request-open', openModal);
        window.addEventListener('lead-form:request-close', closeModal);

        window.__hoaLacLeadPortal = {
          open: () => openModal(),
          close: () => closeModal()
        };

        const queue = window[portalQueueKey];
        if (Array.isArray(queue) && queue.length > 0) {
          while (queue.length > 0) {
            const action = queue.shift();
            if (action === 'open') {
              openModal();
            } else if (action === 'close') {
              closeModal();
            }
          }
        }
        window[portalQueueKey] = [];
      }

      form.addEventListener('submit', (event) => {
        submitLead({
          event,
          form,
          setStatus,
          fieldErrors,
          sectionFlow,
          endpoint,
          leadTagInput,
          fallbackLeadTag,
          onSuccess: () => {
            if (shell.classList.contains('is-modal-open')) {
              setTimeout(() => closeModal(), 2000);
            }
          }
        });
      });
    }

    function createStatusSetter(statusEl) {
      const setter = (message = '', state = 'info') => {
        if (!statusEl) return;
        const text = message ?? '';
        statusEl.textContent = text;
        if (text) {
          statusEl.dataset.state = state;
        } else {
          statusEl.removeAttribute('data-state');
        }
        setter.currentMessage = text;
        setter.currentState = text ? state : undefined;
      };
      setter.currentMessage = statusEl?.textContent ?? '';
      setter.currentState = statusEl?.dataset?.state;
      return setter;
    }

    function handleAreaLimit(event, form, setStatus, fieldErrors) {
      const checkedAreas = form.querySelectorAll('input[name="areas"]:checked');
      if (checkedAreas.length > AREA_LIMIT) {
        event.target.checked = false;
        setStatus(`Chỉ chọn tối đa ${AREA_LIMIT} khu vực.`, 'error');
        fieldErrors?.set('areas', `Chỉ chọn tối đa ${AREA_LIMIT} khu vực.`);
        focusField(event.target);
        return;
      }
      if (typeof setStatus === 'function' && setStatus.currentMessage?.includes('Chỉ chọn tối đa')) {
        setStatus('');
      }
      fieldErrors?.clear('areas');
    }

    function getSelectedAreaLabels(form) {
      return Array.from(form.querySelectorAll('input[name="areas"]:checked'))
        .map((input) => input.nextElementSibling?.textContent?.trim())
        .filter((label) => Boolean(label));
    }

    function broadcastIntentChange(intentValue) {
      if (typeof window === 'undefined' || !intentValue) return;
      window.dispatchEvent(new CustomEvent('lead-intent-change', {
        detail: { intent: intentValue }
      }));
    }

    function broadcastAreasChange(labels) {
      if (typeof window === 'undefined') return;
      window.dispatchEvent(new CustomEvent('lead-areas-change', {
        detail: { areas: labels }
      }));
    }

    function setupValidationListeners(form, fieldErrors, setStatus) {
      if (!form) return;
      SECTION_FLOW.forEach((key) => {
        const group = form.querySelector(`[data-field-group="${key}"]`);
        if (!group) return;
        const inputs = group.querySelectorAll('input, select, textarea');
        inputs.forEach((input) => {
          const eventName = input.type === 'radio' || input.type === 'checkbox' ? 'change' : 'input';
          input.addEventListener(eventName, () => {
            const result = validateSection(key, form);
            if (result.valid) {
              fieldErrors?.clear(key);
              if (allSectionsValid(form) && setStatus?.currentState !== 'success') {
                setStatus?.('');
              }
            } else if (result.message) {
              fieldErrors?.set(key, result.message);
            }
          });
        });
      });

      form.addEventListener('reset', () => {
        fieldErrors?.clearAll();
      });
    }

    function serializeForm(formElement) {
      const formData = new FormData(formElement);
      const data = Object.fromEntries(formData);
      const selectedAreas = formData.getAll('areas');
      if (selectedAreas.length > 0) {
        data.areas = selectedAreas.join(', ');
      }
      return data;
    }

    function computeLeadTag({ intent, budgetRange, legalRisk, areas }) {
      let score = 0;
      score += intentWeights[intent] ?? 0;
      score += budgetWeights[budgetRange] ?? 0;
      score += legalWeights[legalRisk] ?? 0;
      if (areas?.some((area) => priorityAreas.includes(area))) {
        score += 1;
      }

      if (intent === 'luot_song' && legalRisk === 'co_the_rui_ro') {
        return 'lead_cold';
      }
      if (score >= 6) {
        return 'lead_hot';
      }
      if (score >= 3) {
        return 'lead_warm';
      }
      return 'lead_cold';
    }

    async function submitLead({ event, form, setStatus, fieldErrors, sectionFlow, endpoint, leadTagInput, fallbackLeadTag, onSuccess }) {
      event.preventDefault();
      if (!form) return;

      const validation = runSequentialValidation({ form, fieldErrors, setStatus });
      if (!validation.ok) {
        focusSection(validation.section, form);
        return;
      }

      const selectedAreaValues = Array.from(form.querySelectorAll('input[name="areas"]:checked')).map((input) => input.value);

      const now = new Date();
      const vnDateTime = now.toLocaleString('vi-VN', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        hour12: false
      });

      const data = serializeForm(form);
      data.areas = selectedAreaValues.join(', ');
      const computedTag = computeLeadTag({
        intent: data.intent,
        budgetRange: data.budgetRange,
        legalRisk: data.legalRisk,
        areas: selectedAreaValues
      }) ?? fallbackLeadTag;
      data.leadTag = computedTag;
      if (typeof data.contact === 'string') {
        data.contact = data.contact.replace(/\s+/g, '').replace(/^0*/, (match) => (match ? '0' : ''));
      }
      if (leadTagInput) {
        leadTagInput.value = computedTag;
      }
      data.submittedAt = now.toISOString();
      data.submittedAtLocal = vnDateTime;

      if (data.company) {
        setStatus?.('Đã chặn spam.', 'warning');
        return;
      }

      if (!endpoint) {
        setStatus?.('Chưa cấu hình PUBLIC_LEAD_ENDPOINT.', 'error');
        return;
      }

      setStatus?.('Đang gửi...', 'info');
      try {
        const body = new URLSearchParams();
        Object.entries(data).forEach(([key, value]) => {
          body.append(key, typeof value === 'string' ? value : String(value ?? ''));
        });

        const response = await fetch(endpoint, {
          method: 'POST',
          body
        });

        if (response.ok) {
          let payloadMessage = 'Đã nhận thông tin!';
          try {
            const payload = await response.json();
            if (payload?.message) payloadMessage = payload.message;
          } catch (parseErr) {
            console.warn('Không parse được payload, dùng message mặc định.', parseErr);
          }
          setStatus?.(payloadMessage, 'success');
          form.reset();
          sectionFlow?.reset?.();
          fieldErrors?.clearAll();
          if (typeof onSuccess === 'function') {
            onSuccess();
          }
          return;
        }

        throw new Error(`Request failed with status ${response.status}`);
      } catch (error) {
        console.error(error);
        if (error instanceof TypeError) {
          setStatus?.('Đã nhận thông tin!', 'success');
          if (typeof onSuccess === 'function') {
            onSuccess();
          }
          form.reset();
          sectionFlow?.reset?.();
          fieldErrors?.clearAll();
        } else {
          setStatus?.('Không gửi được, vui lòng thử lại.', 'error');
        }
      }
    }

    function runSequentialValidation({ form, fieldErrors, setStatus }) {
      if (!form) {
        return { ok: false, section: undefined };
      }
      for (const key of SECTION_FLOW) {
        const result = validateSection(key, form);
        if (!result.valid) {
          if (result.message) {
            fieldErrors?.set(key, result.message);
            setStatus?.(result.message, 'error');
          }
          return { ok: false, section: key };
        }
        fieldErrors?.clear(key);
      }
      if (setStatus?.currentState !== 'success') {
        setStatus?.('');
      }
      return { ok: true };
    }

    function createFieldErrorRegistry(form) {
      const errorNodes = new Map();
      form.querySelectorAll('[data-error-for]').forEach((node) => {
        if (!(node instanceof HTMLElement)) return;
        const key = node.dataset.errorFor;
        if (!key) return;
        errorNodes.set(key, node);
        node.setAttribute('hidden', 'hidden');
      });

      const getGroup = (key) => form.querySelector(`[data-field-group="${key}"]`);

      const set = (key, message = '') => {
        if (!key) return;
        const node = errorNodes.get(key);
        const text = message?.trim() ?? '';
        if (node) {
          if (text) {
            node.textContent = text;
            node.removeAttribute('hidden');
          } else {
            node.textContent = '';
            node.setAttribute('hidden', 'hidden');
          }
        }
        const group = getGroup(key);
        if (group) {
          if (text) {
            group.classList.add('is-invalid');
          } else {
            group.classList.remove('is-invalid');
          }
        }
      };

      const clear = (key) => set(key, '');
      const clearAll = () => {
        errorNodes.forEach((_node, key) => {
          clear(key);
        });
      };

      return { set, clear, clearAll };
    }

    function focusField(field) {
      if (!field) return;
      requestAnimationFrame(() => {
        if (typeof field.scrollIntoView === 'function') {
          field.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'nearest' });
        }
        if (typeof field.focus === 'function') {
          field.focus({ preventScroll: true });
        }
      });
    }

    function getFieldErrorKey(field) {
      if (!field) return '';
      if (field.name) return field.name;
      if (field.dataset?.errorKey) return field.dataset.errorKey;
      const group = field.closest('[data-field-group]');
      return group instanceof HTMLElement ? group.dataset.fieldGroup ?? '' : '';
    }

    function setupSectionFlow(form, fieldErrors) {
      if (!form) return null;
      const completedSections = new Set();

      const handleProgress = (key) => {
        if (!isSectionComplete(key, form)) {
          completedSections.delete(key);
          return;
        }
        if (completedSections.has(key)) {
          return;
        }
        completedSections.add(key);
        fieldErrors?.clear(key);
        const nextKey = getNextSectionKey(key);
        if (nextKey) {
          focusSection(nextKey, form);
        } else {
          const submitButton = form.querySelector('button[type="submit"]');
          focusField(submitButton);
        }
      };

      SECTION_FLOW.forEach((key) => {
        const group = form.querySelector(`[data-field-group="${key}"]`);
        if (!group) return;
        const inputs = group.querySelectorAll('input, select, textarea');
        inputs.forEach((input) => {
          const eventName = input.type === 'radio' || input.type === 'checkbox' ? 'change' : 'input';
          input.addEventListener(eventName, () => handleProgress(key));
        });
      });

      return {
        reset: () => completedSections.clear()
      };
    }

    function isSectionComplete(key, form) {
      switch (key) {
        case 'intent':
        case 'budgetRange':
        case 'legalRisk':
          return Boolean(form.querySelector(`input[name="${key}"]:checked`));
        case 'areas':
          return form.querySelectorAll('input[name="areas"]:checked').length > 0;
        case 'contact': {
          const input = form.querySelector('input[name="contact"]');
          const value = input?.value?.trim() ?? '';
          return PHONE_PATTERN.test(value);
        }
        default:
          return true;
      }
    }

    function validateSection(key, form) {
      switch (key) {
        case 'intent': {
          const checked = form.querySelector('input[name="intent"]:checked');
          return checked ? { valid: true } : { valid: false, message: SECTION_MESSAGES.intent };
        }
        case 'budgetRange': {
          const checked = form.querySelector('input[name="budgetRange"]:checked');
          return checked ? { valid: true } : { valid: false, message: SECTION_MESSAGES.budgetRange };
        }
        case 'areas': {
          const checkedCount = form.querySelectorAll('input[name="areas"]:checked').length;
          if (checkedCount === 0) {
            return { valid: false, message: SECTION_MESSAGES.areas };
          }
          if (checkedCount > AREA_LIMIT) {
            return { valid: false, message: `Chỉ chọn tối đa ${AREA_LIMIT} khu vực.` };
          }
          return { valid: true };
        }
        case 'legalRisk': {
          const checked = form.querySelector('input[name="legalRisk"]:checked');
          return checked ? { valid: true } : { valid: false, message: SECTION_MESSAGES.legalRisk };
        }
        case 'contact': {
          const input = form.querySelector('input[name="contact"]');
          const value = input?.value?.trim() ?? '';
          if (!value) {
            return { valid: false, message: 'Vui lòng nhập số liên hệ.' };
          }
          if (!PHONE_PATTERN.test(value)) {
            return { valid: false, message: 'Số liên hệ phải đủ 10 số và bắt đầu bằng 03, 05, 07, 08, 09 hoặc 01[2|6|8|9].' };
          }
          return { valid: true };
        }
        default:
          return { valid: true };
      }
    }

    function focusSection(key, form) {
      if (!key || !form) return;
      const group = form.querySelector(`[data-field-group="${key}"]`);
      if (!group) return;
      const focusable = group.querySelector('input:not([type="hidden"]), select, textarea, button');
      if (focusable) {
        focusField(focusable);
      }
    }

    function getNextSectionKey(key) {
      const index = SECTION_FLOW.indexOf(key);
      if (index === -1) return undefined;
      return SECTION_FLOW[index + 1];
    }

    function allSectionsValid(form) {
      return SECTION_FLOW.every((key) => validateSection(key, form).valid);
    }

    function applySequentialTabIndex(form) {
      if (!form) return;
      const focusableSelectors = [
        'input:not([type="hidden"]):not(.hp)',
        'select',
        'textarea',
        'button'
      ].join(',');
      const focusables = Array.from(form.querySelectorAll(focusableSelectors));
      let order = 1;
      focusables.forEach((node) => {
        if (node instanceof HTMLInputElement || node instanceof HTMLSelectElement || node instanceof HTMLTextAreaElement || node instanceof HTMLButtonElement) {
          if (node.disabled || node.tabIndex < 0) {
            return;
          }
          node.tabIndex = order;
          order += 1;
        }
      });
    }
  })();
</script> <script type="module">
      const anchors = Array.from(document.querySelectorAll('a[href="#lead-form"]'));
      const portalQueueKey = '__hoaLacLeadPortalQueue__';
      window[portalQueueKey] = window[portalQueueKey] || [];

      const requestPortalOpen = () => {
        window.dispatchEvent(new CustomEvent('lead-form:request-open', {
          detail: { source: 'global-nav' }
        }));

        if (window.__hoaLacLeadPortal?.open) {
          window.__hoaLacLeadPortal.open();
          return;
        }

        window[portalQueueKey].push('open');
      };

      anchors.forEach((anchor) => {
        anchor.addEventListener('click', (event) => {
          const inlineForm = document.getElementById('lead-form');
          if (inlineForm) {
            return;
          }
          event.preventDefault();
          requestPortalOpen();
        });
      });
    </script> <script type="module" src="data:video/mp2t;base64,aW1wb3J0IGluaXRUYWJsZUVuaGFuY2VyIGZyb20gJy4vdGFibGVFbmhhbmNlcic7DQoNCmluaXRUYWJsZUVuaGFuY2VyKHsgc2VsZWN0b3I6ICcucmVhZGluZy1jb250ZW50IHRhYmxlJyB9KTsNCmluaXRUYWJsZUVuaGFuY2VyKHsgc2VsZWN0b3I6ICcucGlsbGFyLWNvbnRlbnQgdGFibGUnIH0pOw0K"></script> </body> </html> 