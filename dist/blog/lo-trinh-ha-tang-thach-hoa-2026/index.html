<!DOCTYPE html><html lang="vi"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Lộ trình hạ tầng Thạch Hòa 2026: mốc tiến độ cần nắm trước khi xuống tiền</title><meta name="description" content="Tổng hợp tiến độ đường, hầm chui, cấp nước và chính sách pháp lý ở Thạch Hòa 2026 để người mua đánh giá cơ hội một cách thực tế."><meta property="og:title" content="Lộ trình hạ tầng Thạch Hòa 2026: mốc tiến độ cần nắm trước khi xuống tiền"><meta property="og:description" content="Tổng hợp tiến độ đường, hầm chui, cấp nước và chính sách pháp lý ở Thạch Hòa 2026 để người mua đánh giá cơ hội một cách thực tế."><meta property="og:type" content="website"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&family=Playfair+Display:wght@500;600;700&display=swap" rel="stylesheet"><link rel="stylesheet" href="/hoalac_marketing/_astro/_slug_.Db8Iv-6v.css">
<style>.reading-cta[data-astro-cid-4sn4zg3r]{margin-top:4rem}
</style></head> <body> <header class="site-header"> <div class="site-header__inner"> <a href="/hoalac_marketing" class="site-brand"> <span class="site-brand__title">Insight Hòa Lạc</span> <span class="site-brand__subtitle">Bản tin dữ liệu &amp; funnel 2026</span> </a> <nav class="site-nav" aria-label="Điều hướng chính"> <a href="#lead-form" class="site-nav__pill"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"> <path d="M8 6h8"></path> <path d="M8 12h8"></path> <path d="M8 18h5"></path> <rect x="4" y="3" width="16" height="18" rx="2" ry="2"></rect> </svg> <span>Form tư vấn</span> </a> <a href="/hoalac_marketing/blog" class="site-nav__pill site-nav__pill--accent"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"> <path d="M4 19.5C4 18.12 5.12 17 6.5 17h13"></path> <path d="M4 4.5C4 5.88 5.12 7 6.5 7h13"></path> <path d="M6.5 7C5.12 7 4 5.88 4 4.5V19.5C4 18.12 5.12 17 6.5 17"></path> <path d="M19.5 7C20.88 7 22 5.88 22 4.5V19.5C22 18.12 20.88 17 19.5 17"></path> </svg> <span>Bài viết</span> </a> <a href="/hoalac_marketing/pillars" class="site-nav__pill"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"> <circle cx="12" cy="12" r="3.5"></circle> <path d="M12 2v3"></path> <path d="M12 19v3"></path> <path d="M4 12h3"></path> <path d="M17 12h3"></path> </svg> <span>Trung tâm trụ cột</span> </a> </nav> </div> <div class="site-header__meta"> <a href="mailto:contact@example.com" class="site-meta__item">contact@example.com</a> <span class="site-meta__divider" aria-hidden="true">•</span> <a href="https://t.me/" class="site-meta__item" target="_blank" rel="noreferrer">Telegram cập nhật</a> </div> </header> <main class="site-main">  <article class="reading-shell" data-astro-cid-4sn4zg3r> <div class="reading-meta" data-astro-cid-4sn4zg3r>  <p data-astro-cid-4sn4zg3r>16/1/2026</p> </div> <h1 class="reading-title" data-astro-cid-4sn4zg3r>Lộ trình hạ tầng Thạch Hòa 2026: mốc tiến độ cần nắm trước khi xuống tiền</h1> <div class="reading-content" data-astro-cid-4sn4zg3r> <p>Thạch Hòa đang trở thành cửa ngõ quan trọng của Hòa Lạc nhờ vị trí kề cận Khu Công nghệ cao, Đại học Quốc gia và trục Láng – Hòa Lạc. Trong kế hoạch 2025–2030, huyện Quốc Oai và thành phố Hà Nội đã phê duyệt nhiều dự án hạ tầng mới để hoàn thiện kết nối, tạo điều kiện cho khu vực này chuyển mình từ quỹ đất nông nghiệp sang các loại hình ở thật, dịch vụ và nghiên cứu. Bài viết tổng hợp các mốc hạ tầng nổi bật trong năm 2026, đồng thời phân tích tác động thực tế đến người mua đất cũng như nhà đầu tư trung hạn.</p>
<h2 id="1-vì-sao-thạch-hòa-được-ưu-tiên-trong-giai-đoạn-20252026">1. Vì sao Thạch Hòa được ưu tiên trong giai đoạn 2025–2026?</h2>
<p>Theo Nghị quyết 202/2025/QH15 về sắp xếp các đơn vị hành chính, Thạch Hòa trở thành một phần của xã Hòa Lạc mới, đóng vai trò “trục xương sống” nối Khu CNC với vùng dân cư truyền thống. Một số điểm khiến khu vực được ưu tiên nguồn lực:</p>
<ul>
<li><strong>Tập trung cơ sở nghiên cứu và đào tạo</strong>: Trường Đại học Quốc gia Hà Nội, Học viện Viettel, Viện Công nghệ Sinh học… đều nằm trong bán kính 5 km. Việc đảm bảo giao thông thông suốt giúp thu hút chuyên gia, sinh viên về sinh sống dài hạn.</li>
<li><strong>Quỹ đất sạch đã giải phóng</strong>: Nhiều khu chức năng quanh thôn 1, thôn 3 đã hoàn tất bồi thường, tạo điều kiện triển khai nhanh dự án đường, bãi đỗ xe, trung tâm logistics nhẹ.</li>
<li><strong>Vai trò trung chuyển</strong>: Thạch Hòa kết nối trực tiếp với tuyến vành đai 4 tương lai, Quốc lộ 21, đường liên xã đi Tiến Xuân – Bình Yên. Vì vậy, mọi cải thiện hạ tầng đều tác động lan tỏa đến các cụm dân cư lân cận.</li>
</ul>
<h2 id="2-danh-mục-dự-án-hạ-tầng-chính-trong-năm-2026">2. Danh mục dự án hạ tầng chính trong năm 2026</h2>









































<table><thead><tr><th>Hạng mục</th><th>Tình trạng 2026</th><th>Phạm vi &#x26; thông số</th><th>Tác động chính</th></tr></thead><tbody><tr><td><strong>Mở rộng đường Liên xã Thạch Hòa – Bình Yên</strong></td><td>Thi công 70% (bàn giao quý IV/2026)</td><td>Chiều dài 4,2 km, mặt cắt 24 m, hai làn xe cơ giới + hai làn hỗn hợp</td><td>Giảm ùn tắc vào giờ cao điểm, cho phép xe tải nhẹ ra vào khu CNC mà không đi xuyên làng</td></tr><tr><td><strong>Hầm chui dân sinh Đại lộ Thăng Long (km31)</strong></td><td>Khởi công quý II/2026</td><td>Hầm rộng 12 m, cao 4,5 m, kèm đường gom song song</td><td>Tăng an toàn khi cắt qua đại lộ, rút thời gian di chuyển từ các thôn xuống trung tâm xã còn &#x3C;10 phút</td></tr><tr><td><strong>Tuyến gom ĐHQG – Thạch Hòa – Quốc lộ 21</strong></td><td>Đang giải phóng mặt bằng, dự kiến khởi công cuối 2026</td><td>Đường 6 làn, kết hợp làn xe buýt nhanh, tổng vốn ~2.500 tỷ đồng</td><td>Tạo trục kết nối trực tiếp ký túc xá ĐHQG với chợ trung tâm, phù hợp phát triển dịch vụ lưu trú, bán lẻ</td></tr><tr><td><strong>Mạng lưới cấp nước thông minh</strong></td><td>Hoàn thiện thiết kế, đấu thầu quý III/2026</td><td>Nâng công suất Nhà máy nước Hòa Lạc, lắp đồng hồ thông minh tại 8 thôn</td><td>Đảm bảo nguồn nước ổn định, đáp ứng yêu cầu cấp phép xây dựng nhà ở cao tầng thấp</td></tr><tr><td><strong>Bãi đỗ xe tập trung và trạm bus trung chuyển</strong></td><td>Đang xin chủ trương (PPP)</td><td>Quy mô 2 ha tại đầu mối Thạch Hòa – ĐHQG, tích hợp dịch vụ xe điện nội khu</td><td>Giảm tình trạng đậu xe tự phát, tạo điểm trung chuyển cho chuyên gia làm việc tại Khu CNC</td></tr></tbody></table>
<p>Nhìn tổng thể, 2026 là năm bản lề để các dự án thoát khỏi giai đoạn thiết kế. Những công trình hạ tầng mềm như cấp nước, thoát nước và bãi đỗ xe được thúc đẩy nhằm đáp ứng nhu cầu ở thật. Người mua cần theo dõi tiến độ trực tiếp qua thông báo của UBND xã và Ban quản lý Khu CNC để tránh dựa vào tin đồn.</p>
<h2 id="3-khu-vực-nóng-trong-bán-kính-3-km-quanh-thạch-hòa">3. Khu vực nóng trong bán kính 3 km quanh Thạch Hòa</h2>
<h3 id="31-trục-thôn-1--thôn-3">3.1 Trục Thôn 1 – Thôn 3</h3>
<ul>
<li><strong>Hiện trạng</strong>: quỹ đất thổ cư 150–300 m², mặt tiền 6–8 m, đã có điện 3 pha.</li>
<li><strong>Lợi thế</strong>: gần trung tâm hành chính mới, dễ tiếp cận các tuyến liên xã vừa mở rộng.</li>
<li><strong>Rủi ro</strong>: một số thửa còn tranh chấp ranh giới do dồn điền đổi thửa trước đây; cần đo đạc lại trước khi cọc.</li>
</ul>
<h3 id="32-dải-đất-phía-nam-khu-cnc">3.2 Dải đất phía nam Khu CNC</h3>
<ul>
<li><strong>Hiện trạng</strong>: đất vườn, đất trồng cây lâu năm, được định hướng thành khu hỗ trợ R&#x26;D.</li>
<li><strong>Lợi thế</strong>: khi tuyến gom ĐHQG – Quốc lộ 21 hoàn thành, khu vực này trở thành hành lang dịch vụ cho chuyên gia.</li>
<li><strong>Rủi ro</strong>: nhiều ô đất nằm trong quỹ đất dự phòng của dự án công nghệ cao mở rộng; cần kiểm tra kỹ bản đồ quy hoạch chi tiết 1/500.</li>
</ul>
<h3 id="33-rìa-tiến-xuân-giáp-thạch-hòa">3.3 Rìa Tiến Xuân giáp Thạch Hòa</h3>
<ul>
<li><strong>Hiện trạng</strong>: đất nông nghiệp chuyển đổi, phù hợp farmstay hoặc kho nhẹ.</li>
<li><strong>Lợi thế</strong>: giá còn mềm, được hưởng lợi từ đường Liên xã đang thi công.</li>
<li><strong>Rủi ro</strong>: hạ tầng cấp nước, thoát nước chưa đồng bộ; cần dự phòng ngân sách làm hạ tầng kỹ thuật.</li>
</ul>
<h2 id="4-những-mốc-pháp-lý-người-mua-cần-theo-sát">4. Những mốc pháp lý người mua cần theo sát</h2>
<ol>
<li><strong>Thông báo cắm mốc GPMB tuyến gom ĐHQG – Quốc lộ 21</strong>: dự kiến phát hành rộng rãi vào quý III/2026. Các thửa dính mốc phải điều chỉnh diện tích, cần xác nhận lại sổ đỏ trước khi chuyển nhượng.</li>
<li><strong>Quyết định phê duyệt dự án bãi đỗ xe tập trung</strong>: khi có văn bản chính thức, khu đất xung quanh sẽ bị hạn chế xây dựng tạm; người mua nên kiểm tra giấy phép trước khi cải tạo nhà xưởng.</li>
<li><strong>Bản đồ hạ tầng kỹ thuật cấp nước</strong>: UBND xã sẽ công bố danh sách tuyến ống mới. Nếu thửa đất chưa nằm trong vùng cấp nước, cần chuẩn bị phương án giếng khoan hoặc chờ lộ trình kết nối.</li>
<li><strong>Lộ trình điều chỉnh thuế sử dụng đất phi nông nghiệp</strong>: thành phố có kế hoạch rà soát toàn bộ thửa đất trong vùng phát triển đô thị; mức thuế mới có thể áp dụng từ 2027, ảnh hưởng đến dòng tiền giữ đất lâu dài.</li>
</ol>
<h2 id="5-tác-động-thực-tế-đến-điều-kiện-ở-thật-và-đầu-tư">5. Tác động thực tế đến điều kiện ở thật và đầu tư</h2>
<ul>
<li><strong>Ở thật</strong>: các hộ dân làm việc tại Khu CNC hoặc ĐHQG sẽ hưởng lợi lớn nhất. Khi đường Liên xã và hầm chui hoàn thiện, thời gian di chuyển buổi sáng giảm đáng kể; nguồn nước sạch ổn định giúp xin phép xây dựng dễ hơn.</li>
<li><strong>Đầu tư cho thuê</strong>: dịch vụ phòng trọ tiêu chuẩn, homestay cuối tuần và kho mini phục vụ doanh nghiệp hỗ trợ công nghệ cao là ba mô hình có triển vọng. Tuy nhiên, cần theo dõi quy hoạch để tránh xây dựng trong vùng sinh thái đệm hoặc đất dự phòng tái định cư.</li>
<li><strong>Đất vườn chuyển đổi</strong>: cơ hội tồn tại nhưng chi phí làm hạ tầng, nghĩa vụ tài chính sẽ tăng khi khu vực bước vào giai đoạn đô thị hóa. Nhà đầu tư phải tính đủ phí chuyển mục đích, tiền sử dụng đất và thời gian chờ xét duyệt.</li>
</ul>
<h2 id="6-gợi-ý-bước-hành-động-cho-người-mua-mới">6. Gợi ý bước hành động cho người mua mới</h2>
<ol>
<li><strong>Tra cứu cổng dữ liệu quy hoạch chính thức</strong> của Hà Nội và so sánh với bản đồ đã được phân tích trong bài <a href="/hoalac_marketing/blog/ban-do-quy-hoach-moi-hoa-lac"><code>Bản đồ quy hoạch mới Hòa Lạc 2025</code></a>.</li>
<li><strong>Gặp trực tiếp cán bộ địa chính xã Hòa Lạc</strong> để xin trích lục số tờ, số thửa, kèm thông tin về hành lang bảo vệ công trình.</li>
<li><strong>Lập checklist hạ tầng</strong>: ghi lại tiến độ từng dự án liên quan tới thửa đất (đường, cấp nước, hầm chui, bãi đỗ xe). Cập nhật hàng quý để biết lúc nào nên xuống tiền hoặc chờ thêm.</li>
<li><strong>So sánh với các khu vực khác cùng giai đoạn phát triển</strong>, ví dụ Bình Yên hay Thạch Thất, nhằm đánh giá mức giá hiện tại của Thạch Hòa có đang vượt quá lợi thế hạ tầng hay không.</li>
</ol>
<p>Nếu cần xem một ví dụ MOFU về cách lựa chọn cụm đầu tư giữa các xã phía tây, hãy tham khảo bài <a href="/hoalac_marketing/blog/diem-nong-dau-tu-tien-xuan"><code>Điểm nóng đầu tư Tiến Xuân 2026</code></a> để đối chiếu kịch bản ngân sách và độ rủi ro trước khi chuyển pha.</p>
<h2 id="7-kết-luận-mở">7. Kết luận mở</h2>
<p>Lộ trình hạ tầng Thạch Hòa 2026 là cơ hội cho những ai ưu tiên ở thật hoặc đầu tư trung hạn. Tuy nhiên, kỳ vọng cần bám vào tiến độ thực tế chứ không nên chạy theo tin đồn “mở đường là giá tăng gấp đôi”. Việc chuẩn bị hồ sơ pháp lý kỹ lưỡng, cập nhật thông tin trực tiếp từ chính quyền và giữ kỷ luật tài chính sẽ giúp anh/chị đi trước nhưng không phải gánh rủi ro quá lớn.</p>
<p>Để hiểu sâu hơn toàn cảnh quy hoạch, hãy xem lại <a href="/hoalac_marketing/pillars/tong-quan-quy-hoach"><code>Tổng quan &#x26; Quy hoạch</code></a>. Khi cần lọc khu vực hoặc sản phẩm cụ thể, anh/chị có thể ghi chú nhu cầu và làm việc với đội ngũ tư vấn theo đúng quy trình của website.</p>
<script type="application/ld+json">
{
	"@context": "https://schema.org",
	"@type": "BlogPosting",
	"headline": "Lộ trình hạ tầng Thạch Hòa 2026: mốc tiến độ cần nắm trước khi xuống tiền",
	"description": "Tổng hợp tiến độ đường, hầm chui, cấp nước và chính sách pháp lý ở Thạch Hòa 2026 để người mua đánh giá cơ hội một cách thực tế.",
	"datePublished": "2026-01-16",
	"dateModified": "2026-01-16",
	"author": {
		"@type": "Organization",
		"name": "Hòa Lạc Marketing"
	},
	"publisher": {
		"@type": "Organization",
		"name": "Hòa Lạc Marketing"
	}
}
</script> </div> <section class="cta-module reading-cta" data-cta-key="tofu"> <section id="lead-form" class="section-shell section-shell--lead" data-lead-shell data-defer="true" data-endpoint="https://script.google.com/macros/s/AKfycbwM3REFLKfi9x765dPhBp2Hyd5hpEcx_DEL36kxudIMhnjCE5nIV7--HTeERxdpA-erLg/exec" data-global="false" data-force-modal="false" data-floating-enabled="true" data-astro-cid-xyq5hly5> <div class="lead-modal-overlay" data-lead-overlay aria-hidden="true" data-astro-cid-xyq5hly5></div> <div class="shell-inner lead-shell" data-astro-cid-xyq5hly5> <div class="lead-card" data-astro-cid-xyq5hly5> <div class="lead-copy" data-astro-cid-xyq5hly5> <p class="tag" data-astro-cid-xyq5hly5>Checklist nhanh</p> <h2 data-astro-cid-xyq5hly5>Kiểm tra mức phù hợp Hòa Lạc</h2> <p data-astro-cid-xyq5hly5>Trả lời 5 câu để đội ngũ gợi ý khu vực, pháp lý và room tài chính khớp với nhu cầu trong 24 giờ.</p> </div> <form class="lead-form" data-lead-form novalidate data-astro-cid-xyq5hly5> <button class="lead-form__close" type="button" data-lead-close aria-label="Đóng form" data-astro-cid-xyq5hly5> <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" data-astro-cid-xyq5hly5> <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" data-astro-cid-xyq5hly5></path> </svg> </button> <fieldset class="field" data-field-group="intent" data-astro-cid-xyq5hly5> <legend data-astro-cid-xyq5hly5>Anh/chị quan tâm đất Hòa Lạc để:</legend> <div class="option-grid" data-astro-cid-xyq5hly5> <label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="intent" value="o_thuc" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Ở thật</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="intent" value="dau_tu_trung_han" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Đầu tư trung hạn</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="intent" value="luot_song" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Lướt sóng</span> </div> </label> </div> </fieldset> <p class="field-error" data-error-for="intent" role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> <fieldset class="field" data-field-group="budgetRange" data-astro-cid-xyq5hly5> <legend data-astro-cid-xyq5hly5>Tầm tài chính:</legend> <div class="option-grid" data-astro-cid-xyq5hly5> <label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="budgetRange" value="<1.5" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>&lt; 1,5 tỷ</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="budgetRange" value="1.5-2.5" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>1,5 – 2,5 tỷ</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="budgetRange" value="2.5-3.5" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>2,5 – 3,5 tỷ</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="budgetRange" value=">3.5" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>&gt; 3,5 tỷ</span> </div> </label> </div> </fieldset> <p class="field-error" data-error-for="budgetRange" role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> <fieldset class="field" data-field-group="areas" data-astro-cid-xyq5hly5> <legend data-astro-cid-xyq5hly5>Khu vực ưu tiên:</legend> <p class="hint" data-astro-cid-xyq5hly5>Chọn tối đa 2 khu vực (nếu cần).</p> <div class="option-grid" data-astro-cid-xyq5hly5> <label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="gan_dhqg" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Gần ĐHQG</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="gan_cnc" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Gần khu CNC</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="binh_yen_thach_hoa" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Bình Yên – Thạch Hòa</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="tien_xuan_yen_binh" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Tiến Xuân – Yên Bình</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="hoa_lac_trung_tam" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Trung tâm Hòa Lạc</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="khu_tay_bac" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Cụm Tây Bắc</span> </div> </label> </div> </fieldset> <p class="field-error" data-error-for="areas" role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> <fieldset class="field" data-field-group="legalRisk" data-astro-cid-xyq5hly5> <legend data-astro-cid-xyq5hly5>Mức chấp nhận pháp lý:</legend> <div class="option-grid option-grid--legal" data-astro-cid-xyq5hly5> <label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="legalRisk" value="so_do_san" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Chỉ sổ đỏ</span> <small data-astro-cid-xyq5hly5>Nhận đất ở ngay, pháp lý chuẩn</small> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="legalRisk" value="cho_len_tho_cu" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Chờ lên thổ cư</span> <small data-astro-cid-xyq5hly5>Chấp nhận 6–12 tháng làm thủ tục</small> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="legalRisk" value="co_the_rui_ro" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Có thể rủi ro</span> <small data-astro-cid-xyq5hly5>Chấp nhận đất vườn, quy hoạch chờ</small> </div> </label> </div> </fieldset> <p class="field-error" data-error-for="legalRisk" role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> <div class="field" data-field-group="contact" data-astro-cid-xyq5hly5> <label data-astro-cid-xyq5hly5>Để lại Zalo / SĐT</label> <input type="tel" name="contact" required inputmode="tel" pattern="^(03|05|07|08|09|01[2689])[0-9]{8}$" placeholder="Zalo hoặc số điện thoại" data-astro-cid-xyq5hly5> <p class="field-error" data-error-for="contact" role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> </div> <input type="hidden" name="source" value="lead-inline" data-astro-cid-xyq5hly5> <input type="hidden" name="leadTag" value="pending_classification" data-lead-tag data-astro-cid-xyq5hly5> <input type="text" name="company" class="hp" tabindex="-1" autocomplete="off" data-astro-cid-xyq5hly5> <button class="button" type="submit" data-astro-cid-xyq5hly5>Gửi yêu cầu</button> <p class="status" data-status role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> </form> </div> </div> <button class="floating-cta" type="button" data-floating-cta aria-hidden="true" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Đánh giá mức phù hợp</span> <small data-astro-cid-xyq5hly5>Trả lời 5 câu, nhận shortlist trong 24h</small> </button> </section>  <script type="module">
  (() => {
    const AREA_LIMIT = 2;
    const SCROLL_THRESHOLD = 0.65;
    const intentWeights = {
      o_thuc: 3,
      dau_tu_trung_han: 2,
      luot_song: 0
    };
    const budgetWeights = {
      '<1.5': 0,
      '1.5-2.5': 1,
      '2.5-3.5': 2,
      '>3.5': 3
    };
    const legalWeights = {
      so_do_san: 3,
      cho_len_tho_cu: 1,
      co_the_rui_ro: 0
    };
    const priorityAreas = ['gan_dhqg', 'gan_cnc'];
    const SECTION_FLOW = ['intent', 'budgetRange', 'areas', 'legalRisk', 'contact'];
    const SECTION_MESSAGES = {
      intent: 'Vui lòng chọn mục đích sử dụng.',
      budgetRange: 'Vui lòng chọn tầm tài chính.',
      areas: 'Vui lòng chọn ít nhất 1 khu vực ưu tiên.',
      legalRisk: 'Vui lòng chọn mức chấp nhận pháp lý.',
      contact: 'Vui lòng nhập số liên hệ hợp lệ.'
    };
    const PHONE_PATTERN = /^(03|05|07|08|09|01[2689])[0-9]{8}$/;

    const initKey = '__hoaLacLeadFormInit__';
    if (window[initKey]) {
      return;
    }

    window[initKey] = true;

    const boot = () => {
      const shells = Array.from(document.querySelectorAll('[data-lead-shell]'));
      shells.forEach((shell) => initLeadShell(shell));
    };

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', boot, { once: true });
    } else {
      boot();
    }

    function initLeadShell(shell) {
      const form = shell.querySelector('[data-lead-form]');
      if (!form) return;

      const status = shell.querySelector('[data-status]');
      const setStatus = createStatusSetter(status);
      const fieldErrors = createFieldErrorRegistry(form);
      const floatingCta = shell.querySelector('button[data-floating-cta]');
      const overlay = shell.querySelector('[data-lead-overlay]');
      const closeControls = Array.from(shell.querySelectorAll('[data-lead-close]'));
      const endpoint = shell.dataset.endpoint ?? '';
      const deferDisplay = shell.dataset.defer === 'true';
      const showFloatingCta = shell.dataset.floatingEnabled !== 'false';
      const isGlobalFallback = shell.dataset.global === 'true';
      const forceModal = shell.dataset.forceModal === 'true';
      const leadTagInput = form.querySelector('[data-lead-tag]');
      const fallbackLeadTag = leadTagInput?.value ?? 'pending_classification';
      let modalQuery;
      let preferModal = forceModal;
      let previousOverflow = '';

      setupValidationListeners(form, fieldErrors, setStatus);
      applySequentialTabIndex(form);
      const sectionFlow = setupSectionFlow(form, fieldErrors);
      form.addEventListener('reset', () => sectionFlow?.reset?.());

      const areaCheckboxes = form.querySelectorAll('input[name="areas"]');
      areaCheckboxes.forEach((checkbox) => {
        checkbox.addEventListener('change', (event) => handleAreaLimit(event, form, setStatus, fieldErrors));
      });

      const intentInputs = form.querySelectorAll('input[name="intent"]');
      intentInputs.forEach((input) => {
        input.addEventListener('change', () => broadcastIntentChange(input.value));
        if (input.checked) {
          broadcastIntentChange(input.value);
        }
      });

      const areaInputs = form.querySelectorAll('input[name="areas"]');
      areaInputs.forEach((input) => {
        input.addEventListener('change', () => broadcastAreasChange(getSelectedAreaLabels(form)));
      });

      const setBodyScrollLock = (locked) => {
        if (typeof document === 'undefined') return;
        if (locked) {
          previousOverflow = document.body.style.overflow;
          document.body.style.overflow = 'hidden';
        } else {
          document.body.style.overflow = previousOverflow;
        }
      };

      const closeModal = () => {
        if (!shell.classList.contains('is-modal-open')) return;
        shell.classList.remove('is-modal-open');
        overlay?.setAttribute('aria-hidden', 'true');
        setBodyScrollLock(false);
        form.reset();
        sectionFlow?.reset();
        if (leadTagInput) {
          leadTagInput.value = fallbackLeadTag;
        }
        setStatus('');
        fieldErrors.clearAll();
        shell.classList.remove('is-expanded');
        if (deferDisplay && showFloatingCta) {
          shell.classList.add('is-collapsed');
          shell.classList.add('cta-visible');
          floatingCta?.removeAttribute('aria-hidden');
        }
      };

      const openModal = () => {
        shell.classList.add('is-modal-open');
        shell.classList.add('is-expanded');
        shell.classList.remove('is-collapsed');
        shell.classList.remove('cta-visible');
        floatingCta?.setAttribute('aria-hidden', 'true');
        overlay?.removeAttribute('aria-hidden');
        setBodyScrollLock(true);
        const firstField = form.querySelector('input, select, textarea');
        firstField?.focus({ preventScroll: true });
      };

      const shouldUseModal = () => forceModal || preferModal;

      const updateModalPreference = () => {
        if (typeof window === 'undefined' || !deferDisplay || !showFloatingCta || forceModal) {
          return;
        }
        if (!modalQuery) {
          modalQuery = window.matchMedia('(max-width: 768px)');
          modalQuery.addEventListener('change', (event) => {
            preferModal = event.matches;
            if (!preferModal) {
              closeModal();
            }
          });
        }
        preferModal = modalQuery.matches;
      };

      updateModalPreference();

      const revealLeadCapture = () => {
        if (shouldUseModal()) {
          openModal();
          return;
        }
        shell.classList.add('is-expanded');
        shell.classList.remove('is-collapsed');
        shell.classList.remove('cta-visible');
        floatingCta?.setAttribute('aria-hidden', 'true');
        const firstField = form.querySelector('input, select, textarea');
        firstField?.focus();
        form.scrollIntoView({ behavior: 'smooth', block: 'center' });
      };

      closeControls.forEach((control) => {
        control.addEventListener('click', closeModal);
      });
      overlay?.addEventListener('click', closeModal);

      window.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') {
          closeModal();
        }
      });
      window.addEventListener('resize', updateModalPreference);

      function handleScrollReveal() {
        if (!deferDisplay || !floatingCta || !showFloatingCta) return;
        shell.classList.add('is-collapsed');

        const showCta = () => {
          const maxScroll = document.documentElement.scrollHeight - window.innerHeight;
          const progress = maxScroll <= 0 ? 1 : window.scrollY / maxScroll;
          if (progress >= SCROLL_THRESHOLD) {
            shell.classList.add('cta-visible');
            floatingCta.removeAttribute('aria-hidden');
            window.removeEventListener('scroll', onScroll);
          }
        };

        let ticking = false;
        const onScroll = () => {
          if (ticking) return;
          ticking = true;
          requestAnimationFrame(() => {
            showCta();
            ticking = false;
          });
        };

        window.addEventListener('scroll', onScroll, { passive: true });
        setTimeout(showCta, 8000);

        floatingCta.addEventListener('click', revealLeadCapture);
      }

      handleScrollReveal();

      function attachAnchorReveal() {
        if (!shell.id) return;
        const inlineAnchors = Array.from(document.querySelectorAll(`a[href="#${shell.id}"]`));
        if (inlineAnchors.length === 0) return;

        inlineAnchors.forEach((anchor) => {
          anchor.addEventListener('click', (event) => {
            if (!shell.classList.contains('is-collapsed')) return;
            if (!deferDisplay || !showFloatingCta) return;
            if (shouldUseModal()) return;
            event.preventDefault();
            revealLeadCapture();
          });
        });
      }

      attachAnchorReveal();

      if (isGlobalFallback) {
        const portalQueueKey = '__hoaLacLeadPortalQueue__';
        window.addEventListener('lead-form:request-open', openModal);
        window.addEventListener('lead-form:request-close', closeModal);

        window.__hoaLacLeadPortal = {
          open: () => openModal(),
          close: () => closeModal()
        };

        const queue = window[portalQueueKey];
        if (Array.isArray(queue) && queue.length > 0) {
          while (queue.length > 0) {
            const action = queue.shift();
            if (action === 'open') {
              openModal();
            } else if (action === 'close') {
              closeModal();
            }
          }
        }
        window[portalQueueKey] = [];
      }

      form.addEventListener('submit', (event) => {
        submitLead({
          event,
          form,
          setStatus,
          fieldErrors,
          sectionFlow,
          endpoint,
          leadTagInput,
          fallbackLeadTag,
          onSuccess: () => {
            if (shell.classList.contains('is-modal-open')) {
              setTimeout(() => closeModal(), 2000);
            }
          }
        });
      });
    }

    function createStatusSetter(statusEl) {
      const setter = (message = '', state = 'info') => {
        if (!statusEl) return;
        const text = message ?? '';
        statusEl.textContent = text;
        if (text) {
          statusEl.dataset.state = state;
        } else {
          statusEl.removeAttribute('data-state');
        }
        setter.currentMessage = text;
        setter.currentState = text ? state : undefined;
      };
      setter.currentMessage = statusEl?.textContent ?? '';
      setter.currentState = statusEl?.dataset?.state;
      return setter;
    }

    function handleAreaLimit(event, form, setStatus, fieldErrors) {
      const checkedAreas = form.querySelectorAll('input[name="areas"]:checked');
      if (checkedAreas.length > AREA_LIMIT) {
        event.target.checked = false;
        setStatus(`Chỉ chọn tối đa ${AREA_LIMIT} khu vực.`, 'error');
        fieldErrors?.set('areas', `Chỉ chọn tối đa ${AREA_LIMIT} khu vực.`);
        focusField(event.target);
        return;
      }
      if (typeof setStatus === 'function' && setStatus.currentMessage?.includes('Chỉ chọn tối đa')) {
        setStatus('');
      }
      fieldErrors?.clear('areas');
    }

    function getSelectedAreaLabels(form) {
      return Array.from(form.querySelectorAll('input[name="areas"]:checked'))
        .map((input) => input.nextElementSibling?.textContent?.trim())
        .filter((label) => Boolean(label));
    }

    function broadcastIntentChange(intentValue) {
      if (typeof window === 'undefined' || !intentValue) return;
      window.dispatchEvent(new CustomEvent('lead-intent-change', {
        detail: { intent: intentValue }
      }));
    }

    function broadcastAreasChange(labels) {
      if (typeof window === 'undefined') return;
      window.dispatchEvent(new CustomEvent('lead-areas-change', {
        detail: { areas: labels }
      }));
    }

    function setupValidationListeners(form, fieldErrors, setStatus) {
      if (!form) return;
      SECTION_FLOW.forEach((key) => {
        const group = form.querySelector(`[data-field-group="${key}"]`);
        if (!group) return;
        const inputs = group.querySelectorAll('input, select, textarea');
        inputs.forEach((input) => {
          const eventName = input.type === 'radio' || input.type === 'checkbox' ? 'change' : 'input';
          input.addEventListener(eventName, () => {
            const result = validateSection(key, form);
            if (result.valid) {
              fieldErrors?.clear(key);
              if (allSectionsValid(form) && setStatus?.currentState !== 'success') {
                setStatus?.('');
              }
            } else if (result.message) {
              fieldErrors?.set(key, result.message);
            }
          });
        });
      });

      form.addEventListener('reset', () => {
        fieldErrors?.clearAll();
      });
    }

    function serializeForm(formElement) {
      const formData = new FormData(formElement);
      const data = Object.fromEntries(formData);
      const selectedAreas = formData.getAll('areas');
      if (selectedAreas.length > 0) {
        data.areas = selectedAreas.join(', ');
      }
      return data;
    }

    function computeLeadTag({ intent, budgetRange, legalRisk, areas }) {
      let score = 0;
      score += intentWeights[intent] ?? 0;
      score += budgetWeights[budgetRange] ?? 0;
      score += legalWeights[legalRisk] ?? 0;
      if (areas?.some((area) => priorityAreas.includes(area))) {
        score += 1;
      }

      if (intent === 'luot_song' && legalRisk === 'co_the_rui_ro') {
        return 'lead_cold';
      }
      if (score >= 6) {
        return 'lead_hot';
      }
      if (score >= 3) {
        return 'lead_warm';
      }
      return 'lead_cold';
    }

    async function submitLead({ event, form, setStatus, fieldErrors, sectionFlow, endpoint, leadTagInput, fallbackLeadTag, onSuccess }) {
      event.preventDefault();
      if (!form) return;

      const validation = runSequentialValidation({ form, fieldErrors, setStatus });
      if (!validation.ok) {
        focusSection(validation.section, form);
        return;
      }

      const selectedAreaValues = Array.from(form.querySelectorAll('input[name="areas"]:checked')).map((input) => input.value);

      const now = new Date();
      const vnDateTime = now.toLocaleString('vi-VN', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        hour12: false
      });

      const data = serializeForm(form);
      data.areas = selectedAreaValues.join(', ');
      const computedTag = computeLeadTag({
        intent: data.intent,
        budgetRange: data.budgetRange,
        legalRisk: data.legalRisk,
        areas: selectedAreaValues
      }) ?? fallbackLeadTag;
      data.leadTag = computedTag;
      if (typeof data.contact === 'string') {
        data.contact = data.contact.replace(/\s+/g, '').replace(/^0*/, (match) => (match ? '0' : ''));
      }
      if (leadTagInput) {
        leadTagInput.value = computedTag;
      }
      data.submittedAt = now.toISOString();
      data.submittedAtLocal = vnDateTime;

      if (data.company) {
        setStatus?.('Đã chặn spam.', 'warning');
        return;
      }

      if (!endpoint) {
        setStatus?.('Chưa cấu hình PUBLIC_LEAD_ENDPOINT.', 'error');
        return;
      }

      setStatus?.('Đang gửi...', 'info');
      try {
        const body = new URLSearchParams();
        Object.entries(data).forEach(([key, value]) => {
          body.append(key, typeof value === 'string' ? value : String(value ?? ''));
        });

        const response = await fetch(endpoint, {
          method: 'POST',
          body
        });

        if (response.ok) {
          let payloadMessage = 'Đã nhận thông tin!';
          try {
            const payload = await response.json();
            if (payload?.message) payloadMessage = payload.message;
          } catch (parseErr) {
            console.warn('Không parse được payload, dùng message mặc định.', parseErr);
          }
          setStatus?.(payloadMessage, 'success');
          form.reset();
          sectionFlow?.reset?.();
          fieldErrors?.clearAll();
          if (typeof onSuccess === 'function') {
            onSuccess();
          }
          return;
        }

        throw new Error(`Request failed with status ${response.status}`);
      } catch (error) {
        console.error(error);
        if (error instanceof TypeError) {
          setStatus?.('Đã nhận thông tin!', 'success');
          if (typeof onSuccess === 'function') {
            onSuccess();
          }
          form.reset();
          sectionFlow?.reset?.();
          fieldErrors?.clearAll();
        } else {
          setStatus?.('Không gửi được, vui lòng thử lại.', 'error');
        }
      }
    }

    function runSequentialValidation({ form, fieldErrors, setStatus }) {
      if (!form) {
        return { ok: false, section: undefined };
      }
      for (const key of SECTION_FLOW) {
        const result = validateSection(key, form);
        if (!result.valid) {
          if (result.message) {
            fieldErrors?.set(key, result.message);
            setStatus?.(result.message, 'error');
          }
          return { ok: false, section: key };
        }
        fieldErrors?.clear(key);
      }
      if (setStatus?.currentState !== 'success') {
        setStatus?.('');
      }
      return { ok: true };
    }

    function createFieldErrorRegistry(form) {
      const errorNodes = new Map();
      form.querySelectorAll('[data-error-for]').forEach((node) => {
        if (!(node instanceof HTMLElement)) return;
        const key = node.dataset.errorFor;
        if (!key) return;
        errorNodes.set(key, node);
        node.setAttribute('hidden', 'hidden');
      });

      const getGroup = (key) => form.querySelector(`[data-field-group="${key}"]`);

      const set = (key, message = '') => {
        if (!key) return;
        const node = errorNodes.get(key);
        const text = message?.trim() ?? '';
        if (node) {
          if (text) {
            node.textContent = text;
            node.removeAttribute('hidden');
          } else {
            node.textContent = '';
            node.setAttribute('hidden', 'hidden');
          }
        }
        const group = getGroup(key);
        if (group) {
          if (text) {
            group.classList.add('is-invalid');
          } else {
            group.classList.remove('is-invalid');
          }
        }
      };

      const clear = (key) => set(key, '');
      const clearAll = () => {
        errorNodes.forEach((_node, key) => {
          clear(key);
        });
      };

      return { set, clear, clearAll };
    }

    function focusField(field) {
      if (!field) return;
      requestAnimationFrame(() => {
        if (typeof field.scrollIntoView === 'function') {
          field.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'nearest' });
        }
        if (typeof field.focus === 'function') {
          field.focus({ preventScroll: true });
        }
      });
    }

    function getFieldErrorKey(field) {
      if (!field) return '';
      if (field.name) return field.name;
      if (field.dataset?.errorKey) return field.dataset.errorKey;
      const group = field.closest('[data-field-group]');
      return group instanceof HTMLElement ? group.dataset.fieldGroup ?? '' : '';
    }

    function setupSectionFlow(form, fieldErrors) {
      if (!form) return null;
      const completedSections = new Set();

      const handleProgress = (key) => {
        if (!isSectionComplete(key, form)) {
          completedSections.delete(key);
          return;
        }
        if (completedSections.has(key)) {
          return;
        }
        completedSections.add(key);
        fieldErrors?.clear(key);
        const nextKey = getNextSectionKey(key);
        if (nextKey) {
          focusSection(nextKey, form);
        } else {
          const submitButton = form.querySelector('button[type="submit"]');
          focusField(submitButton);
        }
      };

      SECTION_FLOW.forEach((key) => {
        const group = form.querySelector(`[data-field-group="${key}"]`);
        if (!group) return;
        const inputs = group.querySelectorAll('input, select, textarea');
        inputs.forEach((input) => {
          const eventName = input.type === 'radio' || input.type === 'checkbox' ? 'change' : 'input';
          input.addEventListener(eventName, () => handleProgress(key));
        });
      });

      return {
        reset: () => completedSections.clear()
      };
    }

    function isSectionComplete(key, form) {
      switch (key) {
        case 'intent':
        case 'budgetRange':
        case 'legalRisk':
          return Boolean(form.querySelector(`input[name="${key}"]:checked`));
        case 'areas':
          return form.querySelectorAll('input[name="areas"]:checked').length > 0;
        case 'contact': {
          const input = form.querySelector('input[name="contact"]');
          const value = input?.value?.trim() ?? '';
          return PHONE_PATTERN.test(value);
        }
        default:
          return true;
      }
    }

    function validateSection(key, form) {
      switch (key) {
        case 'intent': {
          const checked = form.querySelector('input[name="intent"]:checked');
          return checked ? { valid: true } : { valid: false, message: SECTION_MESSAGES.intent };
        }
        case 'budgetRange': {
          const checked = form.querySelector('input[name="budgetRange"]:checked');
          return checked ? { valid: true } : { valid: false, message: SECTION_MESSAGES.budgetRange };
        }
        case 'areas': {
          const checkedCount = form.querySelectorAll('input[name="areas"]:checked').length;
          if (checkedCount === 0) {
            return { valid: false, message: SECTION_MESSAGES.areas };
          }
          if (checkedCount > AREA_LIMIT) {
            return { valid: false, message: `Chỉ chọn tối đa ${AREA_LIMIT} khu vực.` };
          }
          return { valid: true };
        }
        case 'legalRisk': {
          const checked = form.querySelector('input[name="legalRisk"]:checked');
          return checked ? { valid: true } : { valid: false, message: SECTION_MESSAGES.legalRisk };
        }
        case 'contact': {
          const input = form.querySelector('input[name="contact"]');
          const value = input?.value?.trim() ?? '';
          if (!value) {
            return { valid: false, message: 'Vui lòng nhập số liên hệ.' };
          }
          if (!PHONE_PATTERN.test(value)) {
            return { valid: false, message: 'Số liên hệ phải đủ 10 số và bắt đầu bằng 03, 05, 07, 08, 09 hoặc 01[2|6|8|9].' };
          }
          return { valid: true };
        }
        default:
          return { valid: true };
      }
    }

    function focusSection(key, form) {
      if (!key || !form) return;
      const group = form.querySelector(`[data-field-group="${key}"]`);
      if (!group) return;
      const focusable = group.querySelector('input:not([type="hidden"]), select, textarea, button');
      if (focusable) {
        focusField(focusable);
      }
    }

    function getNextSectionKey(key) {
      const index = SECTION_FLOW.indexOf(key);
      if (index === -1) return undefined;
      return SECTION_FLOW[index + 1];
    }

    function allSectionsValid(form) {
      return SECTION_FLOW.every((key) => validateSection(key, form).valid);
    }

    function applySequentialTabIndex(form) {
      if (!form) return;
      const focusableSelectors = [
        'input:not([type="hidden"]):not(.hp)',
        'select',
        'textarea',
        'button'
      ].join(',');
      const focusables = Array.from(form.querySelectorAll(focusableSelectors));
      let order = 1;
      focusables.forEach((node) => {
        if (node instanceof HTMLInputElement || node instanceof HTMLSelectElement || node instanceof HTMLTextAreaElement || node instanceof HTMLButtonElement) {
          if (node.disabled || node.tabIndex < 0) {
            return;
          }
          node.tabIndex = order;
          order += 1;
        }
      });
    }
  })();
</script> </section> </article>  </main> <footer class="site-footer"> <div class="site-footer__inner"> <div> <p class="site-footer__brand">Insight Hòa Lạc © 2026</p> <p class="site-footer__copy">Landing page thử nghiệm GitHub Pages + funnel marketing.</p> </div> <div class="site-footer__links"> <a href="/hoalac_marketing/blog">Truy cập blog</a> <a href="#lead-form" class="site-footer__cta">Đăng ký tư vấn</a> </div> <div class="site-footer__contact"> <a href="mailto:contact@example.com">contact@example.com</a> <a href="https://t.me/" target="_blank" rel="noreferrer">Telegram</a> </div> </div> </footer> <section id="lead-form-global" class="section-shell section-shell--lead lead-shell--portal" data-lead-shell data-defer="true" data-endpoint="https://script.google.com/macros/s/AKfycbwM3REFLKfi9x765dPhBp2Hyd5hpEcx_DEL36kxudIMhnjCE5nIV7--HTeERxdpA-erLg/exec" data-global="true" data-force-modal="true" data-floating-enabled="false" data-astro-cid-xyq5hly5> <div class="lead-modal-overlay" data-lead-overlay aria-hidden="true" data-astro-cid-xyq5hly5></div> <div class="shell-inner lead-shell" data-astro-cid-xyq5hly5> <div class="lead-card" data-astro-cid-xyq5hly5> <div class="lead-copy" data-astro-cid-xyq5hly5> <p class="tag" data-astro-cid-xyq5hly5>Lead Qualification</p> <h2 data-astro-cid-xyq5hly5>Đánh giá mức phù hợp Hòa Lạc</h2> <p data-astro-cid-xyq5hly5>Trả lời 5 câu để đội ngũ gợi ý khu vực, pháp lý và room tài chính khớp với nhu cầu trong 24 giờ.</p> </div> <form class="lead-form" data-lead-form novalidate data-astro-cid-xyq5hly5> <button class="lead-form__close" type="button" data-lead-close aria-label="Đóng form" data-astro-cid-xyq5hly5> <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" data-astro-cid-xyq5hly5> <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" data-astro-cid-xyq5hly5></path> </svg> </button> <fieldset class="field" data-field-group="intent" data-astro-cid-xyq5hly5> <legend data-astro-cid-xyq5hly5>Anh/chị quan tâm đất Hòa Lạc để:</legend> <div class="option-grid" data-astro-cid-xyq5hly5> <label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="intent" value="o_thuc" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Ở thật</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="intent" value="dau_tu_trung_han" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Đầu tư trung hạn</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="intent" value="luot_song" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Lướt sóng</span> </div> </label> </div> </fieldset> <p class="field-error" data-error-for="intent" role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> <fieldset class="field" data-field-group="budgetRange" data-astro-cid-xyq5hly5> <legend data-astro-cid-xyq5hly5>Tầm tài chính:</legend> <div class="option-grid" data-astro-cid-xyq5hly5> <label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="budgetRange" value="<1.5" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>&lt; 1,5 tỷ</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="budgetRange" value="1.5-2.5" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>1,5 – 2,5 tỷ</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="budgetRange" value="2.5-3.5" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>2,5 – 3,5 tỷ</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="budgetRange" value=">3.5" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>&gt; 3,5 tỷ</span> </div> </label> </div> </fieldset> <p class="field-error" data-error-for="budgetRange" role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> <fieldset class="field" data-field-group="areas" data-astro-cid-xyq5hly5> <legend data-astro-cid-xyq5hly5>Khu vực ưu tiên:</legend> <p class="hint" data-astro-cid-xyq5hly5>Chọn tối đa 2 khu vực (nếu cần).</p> <div class="option-grid" data-astro-cid-xyq5hly5> <label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="gan_dhqg" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Gần ĐHQG</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="gan_cnc" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Gần khu CNC</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="binh_yen_thach_hoa" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Bình Yên – Thạch Hòa</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="tien_xuan_yen_binh" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Tiến Xuân – Yên Bình</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="hoa_lac_trung_tam" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Trung tâm Hòa Lạc</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="khu_tay_bac" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Cụm Tây Bắc</span> </div> </label> </div> </fieldset> <p class="field-error" data-error-for="areas" role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> <fieldset class="field" data-field-group="legalRisk" data-astro-cid-xyq5hly5> <legend data-astro-cid-xyq5hly5>Mức chấp nhận pháp lý:</legend> <div class="option-grid option-grid--legal" data-astro-cid-xyq5hly5> <label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="legalRisk" value="so_do_san" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Chỉ sổ đỏ</span> <small data-astro-cid-xyq5hly5>Nhận đất ở ngay, pháp lý chuẩn</small> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="legalRisk" value="cho_len_tho_cu" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Chờ lên thổ cư</span> <small data-astro-cid-xyq5hly5>Chấp nhận 6–12 tháng làm thủ tục</small> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="legalRisk" value="co_the_rui_ro" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Có thể rủi ro</span> <small data-astro-cid-xyq5hly5>Chấp nhận đất vườn, quy hoạch chờ</small> </div> </label> </div> </fieldset> <p class="field-error" data-error-for="legalRisk" role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> <div class="field" data-field-group="contact" data-astro-cid-xyq5hly5> <label data-astro-cid-xyq5hly5>Để lại Zalo / SĐT</label> <input type="tel" name="contact" required inputmode="tel" pattern="^(03|05|07|08|09|01[2689])[0-9]{8}$" placeholder="Zalo hoặc số điện thoại" data-astro-cid-xyq5hly5> <p class="field-error" data-error-for="contact" role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> </div> <input type="hidden" name="source" value="lead-portal" data-astro-cid-xyq5hly5> <input type="hidden" name="leadTag" value="pending_classification" data-lead-tag data-astro-cid-xyq5hly5> <input type="text" name="company" class="hp" tabindex="-1" autocomplete="off" data-astro-cid-xyq5hly5> <button class="button" type="submit" data-astro-cid-xyq5hly5>Gửi yêu cầu</button> <p class="status" data-status role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> </form> </div> </div>  </section>  <script type="module">
  (() => {
    const AREA_LIMIT = 2;
    const SCROLL_THRESHOLD = 0.65;
    const intentWeights = {
      o_thuc: 3,
      dau_tu_trung_han: 2,
      luot_song: 0
    };
    const budgetWeights = {
      '<1.5': 0,
      '1.5-2.5': 1,
      '2.5-3.5': 2,
      '>3.5': 3
    };
    const legalWeights = {
      so_do_san: 3,
      cho_len_tho_cu: 1,
      co_the_rui_ro: 0
    };
    const priorityAreas = ['gan_dhqg', 'gan_cnc'];
    const SECTION_FLOW = ['intent', 'budgetRange', 'areas', 'legalRisk', 'contact'];
    const SECTION_MESSAGES = {
      intent: 'Vui lòng chọn mục đích sử dụng.',
      budgetRange: 'Vui lòng chọn tầm tài chính.',
      areas: 'Vui lòng chọn ít nhất 1 khu vực ưu tiên.',
      legalRisk: 'Vui lòng chọn mức chấp nhận pháp lý.',
      contact: 'Vui lòng nhập số liên hệ hợp lệ.'
    };
    const PHONE_PATTERN = /^(03|05|07|08|09|01[2689])[0-9]{8}$/;

    const initKey = '__hoaLacLeadFormInit__';
    if (window[initKey]) {
      return;
    }

    window[initKey] = true;

    const boot = () => {
      const shells = Array.from(document.querySelectorAll('[data-lead-shell]'));
      shells.forEach((shell) => initLeadShell(shell));
    };

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', boot, { once: true });
    } else {
      boot();
    }

    function initLeadShell(shell) {
      const form = shell.querySelector('[data-lead-form]');
      if (!form) return;

      const status = shell.querySelector('[data-status]');
      const setStatus = createStatusSetter(status);
      const fieldErrors = createFieldErrorRegistry(form);
      const floatingCta = shell.querySelector('button[data-floating-cta]');
      const overlay = shell.querySelector('[data-lead-overlay]');
      const closeControls = Array.from(shell.querySelectorAll('[data-lead-close]'));
      const endpoint = shell.dataset.endpoint ?? '';
      const deferDisplay = shell.dataset.defer === 'true';
      const showFloatingCta = shell.dataset.floatingEnabled !== 'false';
      const isGlobalFallback = shell.dataset.global === 'true';
      const forceModal = shell.dataset.forceModal === 'true';
      const leadTagInput = form.querySelector('[data-lead-tag]');
      const fallbackLeadTag = leadTagInput?.value ?? 'pending_classification';
      let modalQuery;
      let preferModal = forceModal;
      let previousOverflow = '';

      setupValidationListeners(form, fieldErrors, setStatus);
      applySequentialTabIndex(form);
      const sectionFlow = setupSectionFlow(form, fieldErrors);
      form.addEventListener('reset', () => sectionFlow?.reset?.());

      const areaCheckboxes = form.querySelectorAll('input[name="areas"]');
      areaCheckboxes.forEach((checkbox) => {
        checkbox.addEventListener('change', (event) => handleAreaLimit(event, form, setStatus, fieldErrors));
      });

      const intentInputs = form.querySelectorAll('input[name="intent"]');
      intentInputs.forEach((input) => {
        input.addEventListener('change', () => broadcastIntentChange(input.value));
        if (input.checked) {
          broadcastIntentChange(input.value);
        }
      });

      const areaInputs = form.querySelectorAll('input[name="areas"]');
      areaInputs.forEach((input) => {
        input.addEventListener('change', () => broadcastAreasChange(getSelectedAreaLabels(form)));
      });

      const setBodyScrollLock = (locked) => {
        if (typeof document === 'undefined') return;
        if (locked) {
          previousOverflow = document.body.style.overflow;
          document.body.style.overflow = 'hidden';
        } else {
          document.body.style.overflow = previousOverflow;
        }
      };

      const closeModal = () => {
        if (!shell.classList.contains('is-modal-open')) return;
        shell.classList.remove('is-modal-open');
        overlay?.setAttribute('aria-hidden', 'true');
        setBodyScrollLock(false);
        form.reset();
        sectionFlow?.reset();
        if (leadTagInput) {
          leadTagInput.value = fallbackLeadTag;
        }
        setStatus('');
        fieldErrors.clearAll();
        shell.classList.remove('is-expanded');
        if (deferDisplay && showFloatingCta) {
          shell.classList.add('is-collapsed');
          shell.classList.add('cta-visible');
          floatingCta?.removeAttribute('aria-hidden');
        }
      };

      const openModal = () => {
        shell.classList.add('is-modal-open');
        shell.classList.add('is-expanded');
        shell.classList.remove('is-collapsed');
        shell.classList.remove('cta-visible');
        floatingCta?.setAttribute('aria-hidden', 'true');
        overlay?.removeAttribute('aria-hidden');
        setBodyScrollLock(true);
        const firstField = form.querySelector('input, select, textarea');
        firstField?.focus({ preventScroll: true });
      };

      const shouldUseModal = () => forceModal || preferModal;

      const updateModalPreference = () => {
        if (typeof window === 'undefined' || !deferDisplay || !showFloatingCta || forceModal) {
          return;
        }
        if (!modalQuery) {
          modalQuery = window.matchMedia('(max-width: 768px)');
          modalQuery.addEventListener('change', (event) => {
            preferModal = event.matches;
            if (!preferModal) {
              closeModal();
            }
          });
        }
        preferModal = modalQuery.matches;
      };

      updateModalPreference();

      const revealLeadCapture = () => {
        if (shouldUseModal()) {
          openModal();
          return;
        }
        shell.classList.add('is-expanded');
        shell.classList.remove('is-collapsed');
        shell.classList.remove('cta-visible');
        floatingCta?.setAttribute('aria-hidden', 'true');
        const firstField = form.querySelector('input, select, textarea');
        firstField?.focus();
        form.scrollIntoView({ behavior: 'smooth', block: 'center' });
      };

      closeControls.forEach((control) => {
        control.addEventListener('click', closeModal);
      });
      overlay?.addEventListener('click', closeModal);

      window.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') {
          closeModal();
        }
      });
      window.addEventListener('resize', updateModalPreference);

      function handleScrollReveal() {
        if (!deferDisplay || !floatingCta || !showFloatingCta) return;
        shell.classList.add('is-collapsed');

        const showCta = () => {
          const maxScroll = document.documentElement.scrollHeight - window.innerHeight;
          const progress = maxScroll <= 0 ? 1 : window.scrollY / maxScroll;
          if (progress >= SCROLL_THRESHOLD) {
            shell.classList.add('cta-visible');
            floatingCta.removeAttribute('aria-hidden');
            window.removeEventListener('scroll', onScroll);
          }
        };

        let ticking = false;
        const onScroll = () => {
          if (ticking) return;
          ticking = true;
          requestAnimationFrame(() => {
            showCta();
            ticking = false;
          });
        };

        window.addEventListener('scroll', onScroll, { passive: true });
        setTimeout(showCta, 8000);

        floatingCta.addEventListener('click', revealLeadCapture);
      }

      handleScrollReveal();

      function attachAnchorReveal() {
        if (!shell.id) return;
        const inlineAnchors = Array.from(document.querySelectorAll(`a[href="#${shell.id}"]`));
        if (inlineAnchors.length === 0) return;

        inlineAnchors.forEach((anchor) => {
          anchor.addEventListener('click', (event) => {
            if (!shell.classList.contains('is-collapsed')) return;
            if (!deferDisplay || !showFloatingCta) return;
            if (shouldUseModal()) return;
            event.preventDefault();
            revealLeadCapture();
          });
        });
      }

      attachAnchorReveal();

      if (isGlobalFallback) {
        const portalQueueKey = '__hoaLacLeadPortalQueue__';
        window.addEventListener('lead-form:request-open', openModal);
        window.addEventListener('lead-form:request-close', closeModal);

        window.__hoaLacLeadPortal = {
          open: () => openModal(),
          close: () => closeModal()
        };

        const queue = window[portalQueueKey];
        if (Array.isArray(queue) && queue.length > 0) {
          while (queue.length > 0) {
            const action = queue.shift();
            if (action === 'open') {
              openModal();
            } else if (action === 'close') {
              closeModal();
            }
          }
        }
        window[portalQueueKey] = [];
      }

      form.addEventListener('submit', (event) => {
        submitLead({
          event,
          form,
          setStatus,
          fieldErrors,
          sectionFlow,
          endpoint,
          leadTagInput,
          fallbackLeadTag,
          onSuccess: () => {
            if (shell.classList.contains('is-modal-open')) {
              setTimeout(() => closeModal(), 2000);
            }
          }
        });
      });
    }

    function createStatusSetter(statusEl) {
      const setter = (message = '', state = 'info') => {
        if (!statusEl) return;
        const text = message ?? '';
        statusEl.textContent = text;
        if (text) {
          statusEl.dataset.state = state;
        } else {
          statusEl.removeAttribute('data-state');
        }
        setter.currentMessage = text;
        setter.currentState = text ? state : undefined;
      };
      setter.currentMessage = statusEl?.textContent ?? '';
      setter.currentState = statusEl?.dataset?.state;
      return setter;
    }

    function handleAreaLimit(event, form, setStatus, fieldErrors) {
      const checkedAreas = form.querySelectorAll('input[name="areas"]:checked');
      if (checkedAreas.length > AREA_LIMIT) {
        event.target.checked = false;
        setStatus(`Chỉ chọn tối đa ${AREA_LIMIT} khu vực.`, 'error');
        fieldErrors?.set('areas', `Chỉ chọn tối đa ${AREA_LIMIT} khu vực.`);
        focusField(event.target);
        return;
      }
      if (typeof setStatus === 'function' && setStatus.currentMessage?.includes('Chỉ chọn tối đa')) {
        setStatus('');
      }
      fieldErrors?.clear('areas');
    }

    function getSelectedAreaLabels(form) {
      return Array.from(form.querySelectorAll('input[name="areas"]:checked'))
        .map((input) => input.nextElementSibling?.textContent?.trim())
        .filter((label) => Boolean(label));
    }

    function broadcastIntentChange(intentValue) {
      if (typeof window === 'undefined' || !intentValue) return;
      window.dispatchEvent(new CustomEvent('lead-intent-change', {
        detail: { intent: intentValue }
      }));
    }

    function broadcastAreasChange(labels) {
      if (typeof window === 'undefined') return;
      window.dispatchEvent(new CustomEvent('lead-areas-change', {
        detail: { areas: labels }
      }));
    }

    function setupValidationListeners(form, fieldErrors, setStatus) {
      if (!form) return;
      SECTION_FLOW.forEach((key) => {
        const group = form.querySelector(`[data-field-group="${key}"]`);
        if (!group) return;
        const inputs = group.querySelectorAll('input, select, textarea');
        inputs.forEach((input) => {
          const eventName = input.type === 'radio' || input.type === 'checkbox' ? 'change' : 'input';
          input.addEventListener(eventName, () => {
            const result = validateSection(key, form);
            if (result.valid) {
              fieldErrors?.clear(key);
              if (allSectionsValid(form) && setStatus?.currentState !== 'success') {
                setStatus?.('');
              }
            } else if (result.message) {
              fieldErrors?.set(key, result.message);
            }
          });
        });
      });

      form.addEventListener('reset', () => {
        fieldErrors?.clearAll();
      });
    }

    function serializeForm(formElement) {
      const formData = new FormData(formElement);
      const data = Object.fromEntries(formData);
      const selectedAreas = formData.getAll('areas');
      if (selectedAreas.length > 0) {
        data.areas = selectedAreas.join(', ');
      }
      return data;
    }

    function computeLeadTag({ intent, budgetRange, legalRisk, areas }) {
      let score = 0;
      score += intentWeights[intent] ?? 0;
      score += budgetWeights[budgetRange] ?? 0;
      score += legalWeights[legalRisk] ?? 0;
      if (areas?.some((area) => priorityAreas.includes(area))) {
        score += 1;
      }

      if (intent === 'luot_song' && legalRisk === 'co_the_rui_ro') {
        return 'lead_cold';
      }
      if (score >= 6) {
        return 'lead_hot';
      }
      if (score >= 3) {
        return 'lead_warm';
      }
      return 'lead_cold';
    }

    async function submitLead({ event, form, setStatus, fieldErrors, sectionFlow, endpoint, leadTagInput, fallbackLeadTag, onSuccess }) {
      event.preventDefault();
      if (!form) return;

      const validation = runSequentialValidation({ form, fieldErrors, setStatus });
      if (!validation.ok) {
        focusSection(validation.section, form);
        return;
      }

      const selectedAreaValues = Array.from(form.querySelectorAll('input[name="areas"]:checked')).map((input) => input.value);

      const now = new Date();
      const vnDateTime = now.toLocaleString('vi-VN', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        hour12: false
      });

      const data = serializeForm(form);
      data.areas = selectedAreaValues.join(', ');
      const computedTag = computeLeadTag({
        intent: data.intent,
        budgetRange: data.budgetRange,
        legalRisk: data.legalRisk,
        areas: selectedAreaValues
      }) ?? fallbackLeadTag;
      data.leadTag = computedTag;
      if (typeof data.contact === 'string') {
        data.contact = data.contact.replace(/\s+/g, '').replace(/^0*/, (match) => (match ? '0' : ''));
      }
      if (leadTagInput) {
        leadTagInput.value = computedTag;
      }
      data.submittedAt = now.toISOString();
      data.submittedAtLocal = vnDateTime;

      if (data.company) {
        setStatus?.('Đã chặn spam.', 'warning');
        return;
      }

      if (!endpoint) {
        setStatus?.('Chưa cấu hình PUBLIC_LEAD_ENDPOINT.', 'error');
        return;
      }

      setStatus?.('Đang gửi...', 'info');
      try {
        const body = new URLSearchParams();
        Object.entries(data).forEach(([key, value]) => {
          body.append(key, typeof value === 'string' ? value : String(value ?? ''));
        });

        const response = await fetch(endpoint, {
          method: 'POST',
          body
        });

        if (response.ok) {
          let payloadMessage = 'Đã nhận thông tin!';
          try {
            const payload = await response.json();
            if (payload?.message) payloadMessage = payload.message;
          } catch (parseErr) {
            console.warn('Không parse được payload, dùng message mặc định.', parseErr);
          }
          setStatus?.(payloadMessage, 'success');
          form.reset();
          sectionFlow?.reset?.();
          fieldErrors?.clearAll();
          if (typeof onSuccess === 'function') {
            onSuccess();
          }
          return;
        }

        throw new Error(`Request failed with status ${response.status}`);
      } catch (error) {
        console.error(error);
        if (error instanceof TypeError) {
          setStatus?.('Đã nhận thông tin!', 'success');
          if (typeof onSuccess === 'function') {
            onSuccess();
          }
          form.reset();
          sectionFlow?.reset?.();
          fieldErrors?.clearAll();
        } else {
          setStatus?.('Không gửi được, vui lòng thử lại.', 'error');
        }
      }
    }

    function runSequentialValidation({ form, fieldErrors, setStatus }) {
      if (!form) {
        return { ok: false, section: undefined };
      }
      for (const key of SECTION_FLOW) {
        const result = validateSection(key, form);
        if (!result.valid) {
          if (result.message) {
            fieldErrors?.set(key, result.message);
            setStatus?.(result.message, 'error');
          }
          return { ok: false, section: key };
        }
        fieldErrors?.clear(key);
      }
      if (setStatus?.currentState !== 'success') {
        setStatus?.('');
      }
      return { ok: true };
    }

    function createFieldErrorRegistry(form) {
      const errorNodes = new Map();
      form.querySelectorAll('[data-error-for]').forEach((node) => {
        if (!(node instanceof HTMLElement)) return;
        const key = node.dataset.errorFor;
        if (!key) return;
        errorNodes.set(key, node);
        node.setAttribute('hidden', 'hidden');
      });

      const getGroup = (key) => form.querySelector(`[data-field-group="${key}"]`);

      const set = (key, message = '') => {
        if (!key) return;
        const node = errorNodes.get(key);
        const text = message?.trim() ?? '';
        if (node) {
          if (text) {
            node.textContent = text;
            node.removeAttribute('hidden');
          } else {
            node.textContent = '';
            node.setAttribute('hidden', 'hidden');
          }
        }
        const group = getGroup(key);
        if (group) {
          if (text) {
            group.classList.add('is-invalid');
          } else {
            group.classList.remove('is-invalid');
          }
        }
      };

      const clear = (key) => set(key, '');
      const clearAll = () => {
        errorNodes.forEach((_node, key) => {
          clear(key);
        });
      };

      return { set, clear, clearAll };
    }

    function focusField(field) {
      if (!field) return;
      requestAnimationFrame(() => {
        if (typeof field.scrollIntoView === 'function') {
          field.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'nearest' });
        }
        if (typeof field.focus === 'function') {
          field.focus({ preventScroll: true });
        }
      });
    }

    function getFieldErrorKey(field) {
      if (!field) return '';
      if (field.name) return field.name;
      if (field.dataset?.errorKey) return field.dataset.errorKey;
      const group = field.closest('[data-field-group]');
      return group instanceof HTMLElement ? group.dataset.fieldGroup ?? '' : '';
    }

    function setupSectionFlow(form, fieldErrors) {
      if (!form) return null;
      const completedSections = new Set();

      const handleProgress = (key) => {
        if (!isSectionComplete(key, form)) {
          completedSections.delete(key);
          return;
        }
        if (completedSections.has(key)) {
          return;
        }
        completedSections.add(key);
        fieldErrors?.clear(key);
        const nextKey = getNextSectionKey(key);
        if (nextKey) {
          focusSection(nextKey, form);
        } else {
          const submitButton = form.querySelector('button[type="submit"]');
          focusField(submitButton);
        }
      };

      SECTION_FLOW.forEach((key) => {
        const group = form.querySelector(`[data-field-group="${key}"]`);
        if (!group) return;
        const inputs = group.querySelectorAll('input, select, textarea');
        inputs.forEach((input) => {
          const eventName = input.type === 'radio' || input.type === 'checkbox' ? 'change' : 'input';
          input.addEventListener(eventName, () => handleProgress(key));
        });
      });

      return {
        reset: () => completedSections.clear()
      };
    }

    function isSectionComplete(key, form) {
      switch (key) {
        case 'intent':
        case 'budgetRange':
        case 'legalRisk':
          return Boolean(form.querySelector(`input[name="${key}"]:checked`));
        case 'areas':
          return form.querySelectorAll('input[name="areas"]:checked').length > 0;
        case 'contact': {
          const input = form.querySelector('input[name="contact"]');
          const value = input?.value?.trim() ?? '';
          return PHONE_PATTERN.test(value);
        }
        default:
          return true;
      }
    }

    function validateSection(key, form) {
      switch (key) {
        case 'intent': {
          const checked = form.querySelector('input[name="intent"]:checked');
          return checked ? { valid: true } : { valid: false, message: SECTION_MESSAGES.intent };
        }
        case 'budgetRange': {
          const checked = form.querySelector('input[name="budgetRange"]:checked');
          return checked ? { valid: true } : { valid: false, message: SECTION_MESSAGES.budgetRange };
        }
        case 'areas': {
          const checkedCount = form.querySelectorAll('input[name="areas"]:checked').length;
          if (checkedCount === 0) {
            return { valid: false, message: SECTION_MESSAGES.areas };
          }
          if (checkedCount > AREA_LIMIT) {
            return { valid: false, message: `Chỉ chọn tối đa ${AREA_LIMIT} khu vực.` };
          }
          return { valid: true };
        }
        case 'legalRisk': {
          const checked = form.querySelector('input[name="legalRisk"]:checked');
          return checked ? { valid: true } : { valid: false, message: SECTION_MESSAGES.legalRisk };
        }
        case 'contact': {
          const input = form.querySelector('input[name="contact"]');
          const value = input?.value?.trim() ?? '';
          if (!value) {
            return { valid: false, message: 'Vui lòng nhập số liên hệ.' };
          }
          if (!PHONE_PATTERN.test(value)) {
            return { valid: false, message: 'Số liên hệ phải đủ 10 số và bắt đầu bằng 03, 05, 07, 08, 09 hoặc 01[2|6|8|9].' };
          }
          return { valid: true };
        }
        default:
          return { valid: true };
      }
    }

    function focusSection(key, form) {
      if (!key || !form) return;
      const group = form.querySelector(`[data-field-group="${key}"]`);
      if (!group) return;
      const focusable = group.querySelector('input:not([type="hidden"]), select, textarea, button');
      if (focusable) {
        focusField(focusable);
      }
    }

    function getNextSectionKey(key) {
      const index = SECTION_FLOW.indexOf(key);
      if (index === -1) return undefined;
      return SECTION_FLOW[index + 1];
    }

    function allSectionsValid(form) {
      return SECTION_FLOW.every((key) => validateSection(key, form).valid);
    }

    function applySequentialTabIndex(form) {
      if (!form) return;
      const focusableSelectors = [
        'input:not([type="hidden"]):not(.hp)',
        'select',
        'textarea',
        'button'
      ].join(',');
      const focusables = Array.from(form.querySelectorAll(focusableSelectors));
      let order = 1;
      focusables.forEach((node) => {
        if (node instanceof HTMLInputElement || node instanceof HTMLSelectElement || node instanceof HTMLTextAreaElement || node instanceof HTMLButtonElement) {
          if (node.disabled || node.tabIndex < 0) {
            return;
          }
          node.tabIndex = order;
          order += 1;
        }
      });
    }
  })();
</script> <script type="module">
      const anchors = Array.from(document.querySelectorAll('a[href="#lead-form"]'));
      const portalQueueKey = '__hoaLacLeadPortalQueue__';
      window[portalQueueKey] = window[portalQueueKey] || [];

      const requestPortalOpen = () => {
        window.dispatchEvent(new CustomEvent('lead-form:request-open', {
          detail: { source: 'global-nav' }
        }));

        if (window.__hoaLacLeadPortal?.open) {
          window.__hoaLacLeadPortal.open();
          return;
        }

        window[portalQueueKey].push('open');
      };

      anchors.forEach((anchor) => {
        anchor.addEventListener('click', (event) => {
          const inlineForm = document.getElementById('lead-form');
          if (inlineForm) {
            return;
          }
          event.preventDefault();
          requestPortalOpen();
        });
      });
    </script> <script type="module" src="data:video/mp2t;base64,aW1wb3J0IGluaXRUYWJsZUVuaGFuY2VyIGZyb20gJy4vdGFibGVFbmhhbmNlcic7DQoNCmluaXRUYWJsZUVuaGFuY2VyKHsgc2VsZWN0b3I6ICcucmVhZGluZy1jb250ZW50IHRhYmxlJyB9KTsNCmluaXRUYWJsZUVuaGFuY2VyKHsgc2VsZWN0b3I6ICcucGlsbGFyLWNvbnRlbnQgdGFibGUnIH0pOw0K"></script> </body> </html> 