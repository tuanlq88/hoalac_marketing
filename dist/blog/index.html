<!DOCTYPE html><html lang="vi"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Bài viết Hòa Lạc</title><meta name="description" content="Thư viện bài phân tích thị trường đất Hòa Lạc"><meta property="og:title" content="Bài viết Hòa Lạc"><meta property="og:description" content="Thư viện bài phân tích thị trường đất Hòa Lạc"><meta property="og:type" content="website"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&family=Playfair+Display:wght@500;600;700&display=swap" rel="stylesheet"><link rel="stylesheet" href="/hoalac_marketing/_astro/_slug_._nX_QdcR.css"></head> <body> <header class="site-header"> <div class="site-header__inner"> <a href="/hoalac_marketing" class="site-brand"> <span class="site-brand__title">Insight Hòa Lạc</span> <span class="site-brand__subtitle">Bản tin dữ liệu &amp; funnel 2026</span> </a> <nav class="site-nav" aria-label="Điều hướng chính"> <a href="#lead-form" class="site-nav__pill"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"> <path d="M8 6h8"></path> <path d="M8 12h8"></path> <path d="M8 18h5"></path> <rect x="4" y="3" width="16" height="18" rx="2" ry="2"></rect> </svg> <span>Form tư vấn</span> </a> <a href="/hoalac_marketing/blog" class="site-nav__pill site-nav__pill--accent"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"> <path d="M4 19.5C4 18.12 5.12 17 6.5 17h13"></path> <path d="M4 4.5C4 5.88 5.12 7 6.5 7h13"></path> <path d="M6.5 7C5.12 7 4 5.88 4 4.5V19.5C4 18.12 5.12 17 6.5 17"></path> <path d="M19.5 7C20.88 7 22 5.88 22 4.5V19.5C22 18.12 20.88 17 19.5 17"></path> </svg> <span>Bài viết</span> </a> <a href="/hoalac_marketing/pillars" class="site-nav__pill"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"> <circle cx="12" cy="12" r="3.5"></circle> <path d="M12 2v3"></path> <path d="M12 19v3"></path> <path d="M4 12h3"></path> <path d="M17 12h3"></path> </svg> <span>Trung tâm trụ cột</span> </a> </nav> </div> <div class="site-header__meta"> <a href="mailto:contact@example.com" class="site-meta__item">contact@example.com</a> <span class="site-meta__divider" aria-hidden="true">•</span> <a href="https://t.me/" class="site-meta__item" target="_blank" rel="noreferrer">Telegram cập nhật</a> </div> </header> <main class="site-main">  <section style="max-width: 900px; margin: 3rem auto;"> <h1 style="margin-top: 0;">Bản tin thị trường Hòa Lạc</h1> <p style="color: var(--muted);">
Tổng hợp phân tích thực địa, dữ liệu quy hoạch và báo cáo giao dịch mới nhất dành cho nhà đầu tư và gia đình đang săn đất Hòa Lạc.
</p> <div style="margin-top: 2rem; display: grid; gap: 2rem;"> <article>  <h2 style="margin: 0.5rem 0;"><a href="/hoalac_marketing/blog/quy-trinh-kiem-tra-so-do-hoa-lac">Quy trình kiểm tra sổ đỏ Hòa Lạc: 6 bước xác nhận pháp lý trước khi đặt cọc</a></h2> <p style="margin: 0; color: var(--muted);">Quy trình 6 bước để kiểm tra sổ đỏ, nguồn gốc và rủi ro quy hoạch tại Hòa Lạc trước khi xuống tiền trong giai đoạn 2026.</p> <p style="margin-top: 0.5rem; font-weight: 600;">17/1/2026</p> </article><article> <p class="tag">quy_hoach / tong_quan</p> <h2 style="margin: 0.5rem 0;"><a href="/hoalac_marketing/blog/ban-do-quy-hoach-moi-hoa-lac">Bản đồ quy hoạch mới Hòa Lạc 2025</a></h2> <p style="margin: 0; color: var(--muted);">Tổng hợp những thay đổi lớn nhất trong bản đồ quy hoạch Hòa Lạc giai đoạn 2025–2030, kèm cách đọc và kiểm chứng dữ liệu trước khi xuống tiền.</p> <p style="margin-top: 0.5rem; font-weight: 600;">16/1/2026</p> </article><article>  <h2 style="margin: 0.5rem 0;"><a href="/hoalac_marketing/blog/diem-nong-dau-tu-tien-xuan">Điểm nóng đầu tư Tiến Xuân 2026: chọn cụm nào để xuống tiền an toàn</a></h2> <p style="margin: 0; color: var(--muted);">Phân tích các cụm hot ở Tiến Xuân 2026, so sánh với khu lân cận và liệt kê kịch bản đầu tư, rủi ro cần khóa trước khi xuống tiền.</p> <p style="margin-top: 0.5rem; font-weight: 600;">16/1/2026</p> </article><article>  <h2 style="margin: 0.5rem 0;"><a href="/hoalac_marketing/blog/lo-trinh-ha-tang-thach-hoa-2026">Lộ trình hạ tầng Thạch Hòa 2026: mốc tiến độ cần nắm trước khi xuống tiền</a></h2> <p style="margin: 0; color: var(--muted);">Tổng hợp tiến độ đường, hầm chui, cấp nước và chính sách pháp lý ở Thạch Hòa 2026 để người mua đánh giá cơ hội một cách thực tế.</p> <p style="margin-top: 0.5rem; font-weight: 600;">16/1/2026</p> </article> </div> </section>  </main> <footer class="site-footer"> <div class="site-footer__inner"> <div> <p class="site-footer__brand">Insight Hòa Lạc © 2026</p> <p class="site-footer__copy">Landing page thử nghiệm GitHub Pages + funnel marketing.</p> </div> <div class="site-footer__links"> <a href="/hoalac_marketing/blog">Truy cập blog</a> <a href="#lead-form" class="site-footer__cta">Đăng ký tư vấn</a> </div> <div class="site-footer__contact"> <a href="mailto:contact@example.com">contact@example.com</a> <a href="https://t.me/" target="_blank" rel="noreferrer">Telegram</a> </div> </div> </footer> <section id="lead-form-global" class="section-shell section-shell--lead lead-shell--portal" data-lead-shell data-defer="true" data-endpoint="https://script.google.com/macros/s/AKfycbwM3REFLKfi9x765dPhBp2Hyd5hpEcx_DEL36kxudIMhnjCE5nIV7--HTeERxdpA-erLg/exec" data-global="true" data-force-modal="true" data-floating-enabled="false" data-astro-cid-xyq5hly5> <div class="lead-modal-overlay" data-lead-overlay aria-hidden="true" data-astro-cid-xyq5hly5></div> <div class="shell-inner lead-shell" data-astro-cid-xyq5hly5> <div class="lead-card" data-astro-cid-xyq5hly5> <div class="lead-copy" data-astro-cid-xyq5hly5> <p class="tag" data-astro-cid-xyq5hly5>Lead Qualification</p> <h2 data-astro-cid-xyq5hly5>Đánh giá mức phù hợp Hòa Lạc</h2> <p data-astro-cid-xyq5hly5>Trả lời 5 câu để đội ngũ gợi ý khu vực, pháp lý và room tài chính khớp với nhu cầu trong 24 giờ.</p> </div> <form class="lead-form" data-lead-form novalidate data-astro-cid-xyq5hly5> <button class="lead-form__close" type="button" data-lead-close aria-label="Đóng form" data-astro-cid-xyq5hly5> <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" data-astro-cid-xyq5hly5> <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" data-astro-cid-xyq5hly5></path> </svg> </button> <fieldset class="field" data-astro-cid-xyq5hly5> <legend data-astro-cid-xyq5hly5>Anh/chị quan tâm đất Hòa Lạc để:</legend> <div class="option-grid" data-astro-cid-xyq5hly5> <label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="intent" value="o_thuc" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Ở thật</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="intent" value="dau_tu_trung_han" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Đầu tư trung hạn</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="intent" value="luot_song" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Lướt sóng</span> </div> </label> </div> </fieldset> <fieldset class="field" data-astro-cid-xyq5hly5> <legend data-astro-cid-xyq5hly5>Tầm tài chính:</legend> <div class="option-grid" data-astro-cid-xyq5hly5> <label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="budgetRange" value="<1.5" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>&lt; 1,5 tỷ</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="budgetRange" value="1.5-2.5" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>1,5 – 2,5 tỷ</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="budgetRange" value="2.5-3.5" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>2,5 – 3,5 tỷ</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="budgetRange" value=">3.5" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>&gt; 3,5 tỷ</span> </div> </label> </div> </fieldset> <fieldset class="field" data-astro-cid-xyq5hly5> <legend data-astro-cid-xyq5hly5>Khu vực ưu tiên:</legend> <p class="hint" data-astro-cid-xyq5hly5>Chọn tối đa 2 khu vực (nếu cần).</p> <div class="option-grid" data-astro-cid-xyq5hly5> <label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="gan_dhqg" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Gần ĐHQG</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="gan_cnc" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Gần khu CNC</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="binh_yen_thach_hoa" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Bình Yên – Thạch Hòa</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="tien_xuan_yen_binh" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Tiến Xuân – Yên Bình</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="hoa_lac_trung_tam" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Trung tâm Hòa Lạc</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="khu_tay_bac" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Cụm Tây Bắc</span> </div> </label> </div> </fieldset> <fieldset class="field" data-astro-cid-xyq5hly5> <legend data-astro-cid-xyq5hly5>Mức chấp nhận pháp lý:</legend> <div class="option-grid option-grid--legal" data-astro-cid-xyq5hly5> <label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="legalRisk" value="so_do_san" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Chỉ sổ đỏ</span> <small data-astro-cid-xyq5hly5>Nhận đất ở ngay, pháp lý chuẩn</small> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="legalRisk" value="cho_len_tho_cu" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Chờ lên thổ cư</span> <small data-astro-cid-xyq5hly5>Chấp nhận 6–12 tháng làm thủ tục</small> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="legalRisk" value="co_the_rui_ro" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Có thể rủi ro</span> <small data-astro-cid-xyq5hly5>Chấp nhận đất vườn, quy hoạch chờ</small> </div> </label> </div> </fieldset> <div class="field" data-astro-cid-xyq5hly5> <label data-astro-cid-xyq5hly5>Để lại Zalo / SĐT</label> <input type="tel" name="contact" required inputmode="tel" pattern="^(03|05|07|08|09|01[2689])[0-9]{8}$" placeholder="Zalo hoặc số điện thoại" data-astro-cid-xyq5hly5> </div> <input type="hidden" name="source" value="lead-portal" data-astro-cid-xyq5hly5> <input type="hidden" name="leadTag" value="pending_classification" data-lead-tag data-astro-cid-xyq5hly5> <input type="text" name="company" class="hp" tabindex="-1" autocomplete="off" data-astro-cid-xyq5hly5> <button class="button" type="submit" data-astro-cid-xyq5hly5>Gửi yêu cầu</button> <p class="status" data-status role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> </form> </div> </div>  </section>  <script type="module">
  (() => {
    const AREA_LIMIT = 2;
    const SCROLL_THRESHOLD = 0.65;
    const intentWeights = {
      o_thuc: 3,
      dau_tu_trung_han: 2,
      luot_song: 0
    };
    const budgetWeights = {
      '<1.5': 0,
      '1.5-2.5': 1,
      '2.5-3.5': 2,
      '>3.5': 3
    };
    const legalWeights = {
      so_do_san: 3,
      cho_len_tho_cu: 1,
      co_the_rui_ro: 0
    };
    const priorityAreas = ['gan_dhqg', 'gan_cnc'];

    const initKey = '__hoaLacLeadFormInit__';
    if (window[initKey]) {
      return;
    }

    window[initKey] = true;

    const boot = () => {
      const shells = Array.from(document.querySelectorAll('[data-lead-shell]'));
      shells.forEach((shell) => initLeadShell(shell));
    };

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', boot, { once: true });
    } else {
      boot();
    }

    function initLeadShell(shell) {
      const form = shell.querySelector('[data-lead-form]');
      if (!form) return;

      const status = shell.querySelector('[data-status]');
      const floatingCta = shell.querySelector('button[data-floating-cta]');
      const overlay = shell.querySelector('[data-lead-overlay]');
      const closeControls = Array.from(shell.querySelectorAll('[data-lead-close]'));
      const endpoint = shell.dataset.endpoint ?? '';
      const deferDisplay = shell.dataset.defer === 'true';
      const showFloatingCta = shell.dataset.floatingEnabled !== 'false';
      const isGlobalFallback = shell.dataset.global === 'true';
      const forceModal = shell.dataset.forceModal === 'true';
      const leadTagInput = form.querySelector('[data-lead-tag]');
      const fallbackLeadTag = leadTagInput?.value ?? 'pending_classification';
      let modalQuery;
      let preferModal = forceModal;
      let previousOverflow = '';

      setCustomMessages(form);

      const areaCheckboxes = form.querySelectorAll('input[name="areas"]');
      areaCheckboxes.forEach((checkbox) => {
        checkbox.addEventListener('change', (event) => handleAreaLimit(event, form, status));
      });

      const intentInputs = form.querySelectorAll('input[name="intent"]');
      intentInputs.forEach((input) => {
        input.addEventListener('change', () => broadcastIntentChange(input.value));
        if (input.checked) {
          broadcastIntentChange(input.value);
        }
      });

      const areaInputs = form.querySelectorAll('input[name="areas"]');
      areaInputs.forEach((input) => {
        input.addEventListener('change', () => broadcastAreasChange(getSelectedAreaLabels(form)));
      });

      const setBodyScrollLock = (locked) => {
        if (typeof document === 'undefined') return;
        if (locked) {
          previousOverflow = document.body.style.overflow;
          document.body.style.overflow = 'hidden';
        } else {
          document.body.style.overflow = previousOverflow;
        }
      };

      const closeModal = () => {
        if (!shell.classList.contains('is-modal-open')) return;
        shell.classList.remove('is-modal-open');
        overlay?.setAttribute('aria-hidden', 'true');
        setBodyScrollLock(false);
        form.reset();
        if (leadTagInput) {
          leadTagInput.value = fallbackLeadTag;
        }
        if (status) {
          status.textContent = '';
        }
        shell.classList.remove('is-expanded');
        if (deferDisplay && showFloatingCta) {
          shell.classList.add('is-collapsed');
          shell.classList.add('cta-visible');
          floatingCta?.removeAttribute('aria-hidden');
        }
      };

      const openModal = () => {
        shell.classList.add('is-modal-open');
        shell.classList.add('is-expanded');
        shell.classList.remove('is-collapsed');
        shell.classList.remove('cta-visible');
        floatingCta?.setAttribute('aria-hidden', 'true');
        overlay?.removeAttribute('aria-hidden');
        setBodyScrollLock(true);
        const firstField = form.querySelector('input, select, textarea');
        firstField?.focus({ preventScroll: true });
      };

      const shouldUseModal = () => forceModal || preferModal;

      const updateModalPreference = () => {
        if (typeof window === 'undefined' || !deferDisplay || !showFloatingCta || forceModal) {
          return;
        }
        if (!modalQuery) {
          modalQuery = window.matchMedia('(max-width: 768px)');
          modalQuery.addEventListener('change', (event) => {
            preferModal = event.matches;
            if (!preferModal) {
              closeModal();
            }
          });
        }
        preferModal = modalQuery.matches;
      };

      updateModalPreference();

      const revealLeadCapture = () => {
        if (shouldUseModal()) {
          openModal();
          return;
        }
        shell.classList.add('is-expanded');
        shell.classList.remove('is-collapsed');
        shell.classList.remove('cta-visible');
        floatingCta?.setAttribute('aria-hidden', 'true');
        const firstField = form.querySelector('input, select, textarea');
        firstField?.focus();
        form.scrollIntoView({ behavior: 'smooth', block: 'center' });
      };

      closeControls.forEach((control) => {
        control.addEventListener('click', closeModal);
      });
      overlay?.addEventListener('click', closeModal);

      window.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') {
          closeModal();
        }
      });
      window.addEventListener('resize', updateModalPreference);

      function handleScrollReveal() {
        if (!deferDisplay || !floatingCta || !showFloatingCta) return;
        shell.classList.add('is-collapsed');

        const showCta = () => {
          const maxScroll = document.documentElement.scrollHeight - window.innerHeight;
          const progress = maxScroll <= 0 ? 1 : window.scrollY / maxScroll;
          if (progress >= SCROLL_THRESHOLD) {
            shell.classList.add('cta-visible');
            floatingCta.removeAttribute('aria-hidden');
            window.removeEventListener('scroll', onScroll);
          }
        };

        let ticking = false;
        const onScroll = () => {
          if (ticking) return;
          ticking = true;
          requestAnimationFrame(() => {
            showCta();
            ticking = false;
          });
        };

        window.addEventListener('scroll', onScroll, { passive: true });
        setTimeout(showCta, 8000);

        floatingCta.addEventListener('click', revealLeadCapture);
      }

      handleScrollReveal();

      function attachAnchorReveal() {
        if (!shell.id) return;
        const inlineAnchors = Array.from(document.querySelectorAll(`a[href="#${shell.id}"]`));
        if (inlineAnchors.length === 0) return;

        inlineAnchors.forEach((anchor) => {
          anchor.addEventListener('click', (event) => {
            if (!shell.classList.contains('is-collapsed')) return;
            if (!deferDisplay || !showFloatingCta) return;
            if (shouldUseModal()) return;
            event.preventDefault();
            revealLeadCapture();
          });
        });
      }

      attachAnchorReveal();

      if (isGlobalFallback) {
        const portalQueueKey = '__hoaLacLeadPortalQueue__';
        window.addEventListener('lead-form:request-open', openModal);
        window.addEventListener('lead-form:request-close', closeModal);

        window.__hoaLacLeadPortal = {
          open: () => openModal(),
          close: () => closeModal()
        };

        const queue = window[portalQueueKey];
        if (Array.isArray(queue) && queue.length > 0) {
          while (queue.length > 0) {
            const action = queue.shift();
            if (action === 'open') {
              openModal();
            } else if (action === 'close') {
              closeModal();
            }
          }
        }
        window[portalQueueKey] = [];
      }

      form.addEventListener('submit', (event) => {
        submitLead({
          event,
          form,
          status,
          endpoint,
          leadTagInput,
          fallbackLeadTag,
          onSuccess: () => {
            if (shell.classList.contains('is-modal-open')) {
              setTimeout(() => closeModal(), 2000);
            }
          }
        });
      });
    }

    function handleAreaLimit(event, form, status) {
      const checkedAreas = form.querySelectorAll('input[name="areas"]:checked');
      if (checkedAreas.length > AREA_LIMIT) {
        event.target.checked = false;
        if (status) {
          status.textContent = `Chỉ chọn tối đa ${AREA_LIMIT} khu vực.`;
        }
      }
    }

    function getSelectedAreaLabels(form) {
      return Array.from(form.querySelectorAll('input[name="areas"]:checked'))
        .map((input) => input.nextElementSibling?.textContent?.trim())
        .filter((label) => Boolean(label));
    }

    function broadcastIntentChange(intentValue) {
      if (typeof window === 'undefined' || !intentValue) return;
      window.dispatchEvent(new CustomEvent('lead-intent-change', {
        detail: { intent: intentValue }
      }));
    }

    function broadcastAreasChange(labels) {
      if (typeof window === 'undefined') return;
      window.dispatchEvent(new CustomEvent('lead-areas-change', {
        detail: { areas: labels }
      }));
    }

    function setCustomMessages(form) {
      const REQUIRED_TEXT = 'Vui lòng điền thông tin này.';
      const PHONE_TEXT = 'Số liên hệ phải đủ 10 số và bắt đầu bằng 03, 05, 07, 08, 09 hoặc 01[2|6|8|9].';

      form.addEventListener('invalid', (event) => {
        const field = event.target;
        if (!(field instanceof HTMLInputElement || field instanceof HTMLTextAreaElement || field instanceof HTMLSelectElement)) {
          return;
        }
        if (field.validity.valueMissing) {
          field.setCustomValidity(REQUIRED_TEXT);
        } else if (field.type === 'tel' && field.validity.patternMismatch) {
          field.setCustomValidity(PHONE_TEXT);
        } else {
          field.setCustomValidity('');
        }
      }, true);

      form.addEventListener('input', (event) => {
        const field = event.target;
        if (field instanceof HTMLInputElement || field instanceof HTMLTextAreaElement || field instanceof HTMLSelectElement) {
          field.setCustomValidity('');
        }
      });
    }

    function serializeForm(formElement) {
      const formData = new FormData(formElement);
      const data = Object.fromEntries(formData);
      const selectedAreas = formData.getAll('areas');
      if (selectedAreas.length > 0) {
        data.areas = selectedAreas.join(', ');
      }
      return data;
    }

    function computeLeadTag({ intent, budgetRange, legalRisk, areas }) {
      let score = 0;
      score += intentWeights[intent] ?? 0;
      score += budgetWeights[budgetRange] ?? 0;
      score += legalWeights[legalRisk] ?? 0;
      if (areas?.some((area) => priorityAreas.includes(area))) {
        score += 1;
      }

      if (intent === 'luot_song' && legalRisk === 'co_the_rui_ro') {
        return 'lead_cold';
      }
      if (score >= 6) {
        return 'lead_hot';
      }
      if (score >= 3) {
        return 'lead_warm';
      }
      return 'lead_cold';
    }

    async function submitLead({ event, form, status, endpoint, leadTagInput, fallbackLeadTag, onSuccess }) {
      event.preventDefault();
      if (!form || !status) return;
      if (!form.reportValidity()) {
        return;
      }

      const selectedAreaNodes = form.querySelectorAll('input[name="areas"]:checked');
      if (selectedAreaNodes.length === 0) {
        status.textContent = 'Vui lòng chọn ít nhất 1 khu vực ưu tiên.';
        return;
      }
      const selectedAreaValues = Array.from(selectedAreaNodes).map((input) => input.value);

      const now = new Date();
      const vnDateTime = now.toLocaleString('vi-VN', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        hour12: false
      });

      const data = serializeForm(form);
      data.areas = selectedAreaValues.join(', ');
      const computedTag = computeLeadTag({
        intent: data.intent,
        budgetRange: data.budgetRange,
        legalRisk: data.legalRisk,
        areas: selectedAreaValues
      }) ?? fallbackLeadTag;
      data.leadTag = computedTag;
      if (typeof data.contact === 'string') {
        data.contact = data.contact.replace(/\s+/g, '').replace(/^0*/, (match) => (match ? '0' : ''));
      }
      if (leadTagInput) {
        leadTagInput.value = computedTag;
      }
      data.submittedAt = now.toISOString();
      data.submittedAtLocal = vnDateTime;

      if (data.company) {
        status.textContent = 'Đã chặn spam.';
        return;
      }

      if (!endpoint) {
        status.textContent = 'Chưa cấu hình PUBLIC_LEAD_ENDPOINT.';
        return;
      }

      status.textContent = 'Đang gửi...';
      try {
        const body = new URLSearchParams();
        Object.entries(data).forEach(([key, value]) => {
          body.append(key, typeof value === 'string' ? value : String(value ?? ''));
        });

        const response = await fetch(endpoint, {
          method: 'POST',
          body
        });

        if (response.ok) {
          let payloadMessage = 'Đã nhận thông tin!';
          try {
            const payload = await response.json();
            if (payload?.message) payloadMessage = payload.message;
          } catch (parseErr) {
            console.warn('Không parse được payload, dùng message mặc định.', parseErr);
          }
          status.textContent = payloadMessage;
          form.reset();
          if (typeof onSuccess === 'function') {
            onSuccess();
          }
          return;
        }

        throw new Error(`Request failed with status ${response.status}`);
      } catch (error) {
        console.error(error);
        if (error instanceof TypeError) {
          status.textContent = 'Đã nhận thông tin!';
          if (typeof onSuccess === 'function') {
            onSuccess();
          }
          form.reset();
        } else {
          status.textContent = 'Không gửi được, vui lòng thử lại.';
        }
      }
    }
  })();
</script> <script type="module">
      const anchors = Array.from(document.querySelectorAll('a[href="#lead-form"]'));
      const portalQueueKey = '__hoaLacLeadPortalQueue__';
      window[portalQueueKey] = window[portalQueueKey] || [];

      const requestPortalOpen = () => {
        window.dispatchEvent(new CustomEvent('lead-form:request-open', {
          detail: { source: 'global-nav' }
        }));

        if (window.__hoaLacLeadPortal?.open) {
          window.__hoaLacLeadPortal.open();
          return;
        }

        window[portalQueueKey].push('open');
      };

      anchors.forEach((anchor) => {
        anchor.addEventListener('click', (event) => {
          const inlineForm = document.getElementById('lead-form');
          if (inlineForm) {
            return;
          }
          event.preventDefault();
          requestPortalOpen();
        });
      });
    </script> </body> </html>