<!DOCTYPE html><html lang="vi"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Điểm nóng đầu tư Tiến Xuân 2026: chọn cụm nào để xuống tiền an toàn</title><meta name="description" content="Phân tích các cụm hot ở Tiến Xuân 2026, so sánh với khu lân cận và liệt kê kịch bản đầu tư, rủi ro cần khóa trước khi xuống tiền."><meta property="og:title" content="Điểm nóng đầu tư Tiến Xuân 2026: chọn cụm nào để xuống tiền an toàn"><meta property="og:description" content="Phân tích các cụm hot ở Tiến Xuân 2026, so sánh với khu lân cận và liệt kê kịch bản đầu tư, rủi ro cần khóa trước khi xuống tiền."><meta property="og:type" content="website"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&family=Playfair+Display:wght@500;600;700&display=swap" rel="stylesheet"><link rel="stylesheet" href="/hoalac_marketing/_astro/_slug_.Db8Iv-6v.css">
<style>.reading-cta[data-astro-cid-4sn4zg3r]{margin-top:4rem}
</style></head> <body> <header class="site-header"> <div class="site-header__inner"> <a href="/hoalac_marketing" class="site-brand"> <span class="site-brand__title">Insight Hòa Lạc</span> <span class="site-brand__subtitle">Bản tin dữ liệu &amp; funnel 2026</span> </a> <nav class="site-nav" aria-label="Điều hướng chính"> <a href="#lead-form" class="site-nav__pill"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"> <path d="M8 6h8"></path> <path d="M8 12h8"></path> <path d="M8 18h5"></path> <rect x="4" y="3" width="16" height="18" rx="2" ry="2"></rect> </svg> <span>Form tư vấn</span> </a> <a href="/hoalac_marketing/blog" class="site-nav__pill site-nav__pill--accent"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"> <path d="M4 19.5C4 18.12 5.12 17 6.5 17h13"></path> <path d="M4 4.5C4 5.88 5.12 7 6.5 7h13"></path> <path d="M6.5 7C5.12 7 4 5.88 4 4.5V19.5C4 18.12 5.12 17 6.5 17"></path> <path d="M19.5 7C20.88 7 22 5.88 22 4.5V19.5C22 18.12 20.88 17 19.5 17"></path> </svg> <span>Bài viết</span> </a> <a href="/hoalac_marketing/pillars" class="site-nav__pill"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"> <circle cx="12" cy="12" r="3.5"></circle> <path d="M12 2v3"></path> <path d="M12 19v3"></path> <path d="M4 12h3"></path> <path d="M17 12h3"></path> </svg> <span>Trung tâm trụ cột</span> </a> </nav> </div> <div class="site-header__meta"> <a href="mailto:contact@example.com" class="site-meta__item">contact@example.com</a> <span class="site-meta__divider" aria-hidden="true">•</span> <a href="https://t.me/" class="site-meta__item" target="_blank" rel="noreferrer">Telegram cập nhật</a> </div> </header> <main class="site-main">  <article class="reading-shell" data-astro-cid-4sn4zg3r> <div class="reading-meta" data-astro-cid-4sn4zg3r>  <p data-astro-cid-4sn4zg3r>19/1/2026</p> </div> <h1 class="reading-title" data-astro-cid-4sn4zg3r>Điểm nóng đầu tư Tiến Xuân 2026: chọn cụm nào để xuống tiền an toàn</h1> <div class="reading-content" data-astro-cid-4sn4zg3r> <p>Tiến Xuân đang trải qua giai đoạn chuyển mình khi hàng loạt dự án hạ tầng thuộc chương trình phát triển Hòa Lạc được kích hoạt từ cuối 2025. Nhà đầu tư đang thực địa dễ dàng nhận ra mặt bằng giá bị kéo giãn giữa các thôn, khu vực gần Đại lộ Thăng Long và đất sát vùng sinh thái. Bài viết này tổng hợp các cụm được xem là “điểm nóng” trong năm 2026, đồng thời so sánh với những khu lân cận để anh/chị định vị đúng vị thế của Tiến Xuân trước khi xuống tiền.</p>
<h2 id="1-vì-sao-tiến-xuân-nổi-bật-trên-bản-đồ-2026">1. Vì sao Tiến Xuân nổi bật trên bản đồ 2026?</h2>
<ol>
<li><strong>Quỹ đất còn rộng nhưng đã có quy hoạch chi tiết</strong>: Sau khi sáp nhập vào xã Hòa Lạc mở rộng, Tiến Xuân nằm trong vùng ưu tiên chuyển đổi đất nông nghiệp sang đất hỗn hợp dịch vụ – lưu trú. Tỷ lệ diện tích đã cắm mốc GPMB đạt khoảng 65%, cao hơn mặt bằng chung Quốc Oai.</li>
<li><strong>Liền kề hai trục hạ tầng lớn</strong>: Một mặt giáp Đại lộ Thăng Long, mặt còn lại kết nối nhanh với tuyến tránh Xuân Mai và đường liên xã Tiến Xuân – Thạch Hòa đang mở rộng lên 20 m. Điều này giúp thời gian di chuyển vào <a href="/hoalac_marketing/articles/khu-cong-nghe-cao-hoa-lac">khu công nghệ cao</a> chỉ còn 15–18 phút.</li>
<li><strong>Được định vị là vùng đệm sinh thái</strong>: Thành phố muốn giữ mật độ xây dựng trung bình dưới 45%, tạo không gian cho mô hình farmstay, homestay cao cấp và kho lưu trữ nhẹ. Đây là phân khúc bổ sung cho khu lõi công nghệ vốn thiếu dịch vụ nghỉ dưỡng.</li>
</ol>
<h2 id="2-ba-cụm-nên-khảo-sát-kỹ-trước-khi-ra-quyết-định">2. Ba cụm nên khảo sát kỹ trước khi ra quyết định</h2>
<h3 id="21-tiểu-khu-đồng-sương--suối-tía">2.1 Tiểu khu Đồng Sương – Suối Tía</h3>
<ul>
<li><strong>Hiện trạng</strong>: Đất vườn 400–800 m², đã có quy hoạch đường nội khu 10–12 m. Một số thửa đã chuyển lên đất ở lâu dài.</li>
<li><strong>Động lực giá</strong>: Hưởng lợi trực tiếp từ nút giao mới trên Đại lộ Thăng Long (dự kiến hoàn thành quý IV/2026), giúp xe du lịch vào thẳng khu sinh thái mà không đi vòng qua Hòa Thạch.</li>
<li><strong>Rủi ro</strong>: Vẫn còn 2 dự án du lịch sinh thái nộp hồ sơ PPP; nếu trùng vị trí, người mua phải chờ phương án đền bù.</li>
</ul>
<h3 id="22-vành-đai-tiến-xuân--yên-bình-đoạn-giáp-hồ">2.2 Vành đai Tiến Xuân – Yên Bình (đoạn giáp hồ)</h3>
<ul>
<li><strong>Hiện trạng</strong>: Tỷ lệ xây dựng thấp, phù hợp mô hình kho lạnh, trung chuyển nông sản. Đất chủ yếu là đất trồng cây lâu năm 1.000–3.000 m².</li>
<li><strong>Động lực giá</strong>: Dự án “Logistics nông nghiệp sạch” của huyện đang lựa chọn nhà đầu tư; nếu triển khai, toàn bộ trục sẽ có hạ tầng điện 3 pha và đường bê tông 14 m.</li>
<li><strong>Rủi ro</strong>: Đường bê tông hiện hữu tải trọng nhỏ; xe container chưa thể vào thường xuyên, khiến dòng tiền cho thuê ngắn hạn bị hạn chế.</li>
</ul>
<h3 id="23-lõi-dân-cư-tiến-xuân-cũ-gần-ubnd">2.3 Lõi dân cư Tiến Xuân cũ (gần UBND)</h3>
<ul>
<li><strong>Hiện trạng</strong>: Đất ở 120–200 m², mật độ dân cư đông, có sẵn trường học và chợ.</li>
<li><strong>Động lực giá</strong>: Khi tuyến bus nhanh ĐHQG – Xuân Mai vận hành thử (2027), đây sẽ là điểm trung chuyển. Giá cho thuê nhà phố, phòng trọ dự báo tăng 10–15%/năm.</li>
<li><strong>Rủi ro</strong>: Một số tuyến đường nội khu chỉ rộng 5 m, khó đáp ứng yêu cầu PCCC mới. Người cải tạo nhà phải xin phép điều chỉnh kết cấu.</li>
</ul>
<h2 id="3-tiến-xuân-đang-đứng-ở-đâu-so-với-khu-lân-cận">3. Tiến Xuân đang đứng ở đâu so với khu lân cận?</h2>









































<table><thead><tr><th>Tiêu chí</th><th>Tiến Xuân</th><th>Bình Yên</th><th>Thạch Hòa</th></tr></thead><tbody><tr><td>Vai trò</td><td>Vùng đệm sinh thái, dịch vụ hỗ trợ du lịch</td><td>Hành lang dịch vụ quanh Đại học Quốc gia</td><td>Cửa ngõ Khu CNC, ở thật</td></tr><tr><td>Mặt bằng giá 2026 (ước tính)</td><td>10–14 triệu/m² đất vườn chuyển đổi</td><td>15–22 triệu/m² đất ở</td><td>22–30 triệu/m² đất ở trung tâm</td></tr><tr><td>Hạ tầng 2026</td><td>Đang nâng cấp liên xã, nút giao mới</td><td>Tuyến gom ĐHQG, đường làng 12–15 m</td><td>Liên xã 24 m, hầm chui km31</td></tr><tr><td>Phù hợp mô hình</td><td>Farmstay, kho nhẹ, homestay cao cấp</td><td>Nhà ở cho chuyên gia, dịch vụ giáo dục</td><td>Nhà phố thương mại, căn hộ mini</td></tr><tr><td>Rủi ro chính</td><td>Hành lang sinh thái, hạn chế mật độ</td><td>GPMB tuyến gom, áp lực giá</td><td>Thuế đất phi nông nghiệp, cạnh tranh cao</td></tr></tbody></table>
<p>Điểm mạnh của Tiến Xuân nằm ở việc chi phí vốn ban đầu thấp hơn nhưng vẫn bám sát trục tăng trưởng của Hòa Lạc. Nhà đầu tư muốn so sánh sâu hơn giữa Bình Yên và Thạch Hòa có thể tham khảo bài <a href="/hoalac_marketing/blog/so-sanh-binh-yen-vs-thach-hoa"><code>So sánh Bình Yên vs Thạch Hòa</code></a> để hiểu mức giá “chuẩn” trong cùng chu kỳ.</p>
<h2 id="4-kịch-bản-sản-phẩm--ngân-sách-tham-khảo">4. Kịch bản sản phẩm &#x26; ngân sách tham khảo</h2>
<ol>
<li><strong>Farmstay cuối tuần 6–8 phòng</strong>
<ul>
<li>Diện tích tối ưu: 700–1.000 m² ở Đồng Sương.</li>
<li>Ngân sách: 5–6 tỷ (đất + xây dựng nhẹ).</li>
<li>Dòng tiền: 80–120 triệu/tháng nếu vận hành ổn định, cần hệ thống đặt phòng online.</li>
</ul>
</li>
<li><strong>Kho lạnh nhỏ hỗ trợ nông sản sạch</strong>
<ul>
<li>Diện tích: 1.000–1.500 m² vùng giáp Yên Bình.</li>
<li>Ngân sách: 4–5 tỷ, ưu tiên thửa đã có đường xe tải 3,5 tấn.</li>
<li>Dòng tiền: cho thuê 45–60 triệu/tháng, tùy hợp đồng với HTX.</li>
</ul>
</li>
<li><strong>Nhà phố phòng trọ cho cán bộ trẻ</strong>
<ul>
<li>Diện tích: 120–160 m² trong lõi dân cư.</li>
<li>Ngân sách: 3,5–4 tỷ, cần dự phòng thêm 300 triệu nâng cấp PCCC.</li>
<li>Dòng tiền: 25–35 triệu/tháng ngay khi tuyến bus nhanh đi vào hoạt động.</li>
</ul>
</li>
</ol>
<p>Các kịch bản trên đòi hỏi người mua kiểm tra kỹ điều kiện chuyển mục đích đất, giấy phép xây dựng và quy định cách nhiệt, tiếng ồn đối với khu dân cư. Đặc biệt với kho lạnh, phải xin giấy phép môi trường cấp huyện.</p>
<h2 id="5-rủi-ro-cần-khóa-trước-khi-chốt-cọc">5. Rủi ro cần khóa trước khi chốt cọc</h2>
<ul>
<li><strong>Hành lang bảo vệ suối và hồ</strong>: Tiến Xuân có nhiều suối nhỏ; hành lang tối thiểu 10–20 m tùy cấp. Nếu thửa đất nằm trong phạm vi này, việc xây dựng sẽ bị hạn chế chiều cao và mật độ.</li>
<li><strong>Nguồn điện trung thế</strong>: Một số cụm chưa có trạm biến áp đủ tải. Nhà đầu tư phải tự lắp đặt hoặc chờ kế hoạch của Điện lực Quốc Oai, ảnh hưởng tiến độ khai thác.</li>
<li><strong>Giấy tờ chuyển đổi mục đích</strong>: Nhiều thửa vẫn đang trong diện rà soát nghĩa vụ tài chính sau dồn điền. Cần yêu cầu bên bán cung cấp biên lai mới nhất để tránh tranh chấp.</li>
<li><strong>Thị trường thứ cấp mỏng</strong>: Dù nhu cầu tăng, thanh khoản vẫn phụ thuộc vào thông tin hạ tầng. Nhà đầu tư ngắn hạn nên chuẩn bị kế hoạch nắm giữ 18–24 tháng.</li>
</ul>
<h2 id="6-checklist-cho-nhà-đầu-tư-mofu">6. Checklist cho nhà đầu tư MOFU</h2>
<ol>
<li><strong>Khoanh vùng theo loại hình</strong>: Farmstay và kho lạnh không thể dùng chung tiêu chí. Xác định rõ tỷ lệ thời gian sử dụng, khách hàng mục tiêu trước khi tìm đất.</li>
<li><strong>So sánh với khu thay thế</strong>: Luôn đặt câu hỏi “Tại sao không chọn Bình Yên hay Thạch Hòa?” để đảm bảo Tiến Xuân mang lại lợi thế thực sự.</li>
<li><strong>Đo đạc lại hiện trạng</strong>: Thuê đơn vị đo GPS, đặc biệt với thửa lớn giáp suối để biết chính xác diện tích sử dụng.</li>
<li><strong>Kiểm tra quy hoạch 1/500</strong>: Một số khu đã có bản vẽ chi tiết, giúp xác định hành lang xanh và vị trí trường học. Đây là dữ liệu quan trọng cho dự án lưu trú.</li>
<li><strong>Theo dõi lịch giải phóng mặt bằng</strong>: UBND xã sẽ niêm yết đợt cắm mốc mới mỗi quý. Nếu thửa dính mốc, nên đàm phán lại giá hoặc chuyển hướng.</li>
</ol>
<p>Ngay khi checklist trên hoàn tất và danh mục sẵn sàng chuyển phễu, hãy đọc bài <a href="/hoalac_marketing/blog/chien-luoc-giu-room-dau-tu-hoa-lac"><code>Chiến lược giữ room đầu tư Hòa Lạc 2026</code></a> để khóa room tín dụng và pháp lý trước khi ký hợp đồng.</p>
<h2 id="7-góc-nhìn-20262028">7. Góc nhìn 2026–2028</h2>
<p>Tiến Xuân có thể bước vào giai đoạn “tái định vị” khi tuyến bus nhanh hoàn thành và chuỗi dịch vụ sinh thái đi vào vận hành đồng loạt. Điều này giúp khu vực bớt phụ thuộc vào kỳ vọng quy hoạch và chuyển sang giá trị khai thác thực tế. Để nắm toàn bộ chuỗi bài phân tích khu vực Hòa Lạc, anh/chị có thể quay lại hub <a href="/hoalac_marketing/pillars/phan-tich-khu-vuc"><code>Phân tích khu vực</code></a> và đối chiếu với các số liệu cập nhật hàng quý.</p>
<p>Tóm lại, Tiến Xuân là lựa chọn phù hợp với nhà đầu tư trung hạn muốn nắm giữ sản phẩm “đệm” giữa vùng sinh thái và khu công nghệ. Tuy nhiên, lợi thế chỉ phát huy khi anh/chị kiểm soát tốt hành lang hạ tầng, chuẩn bị ngân sách nâng cấp tiện ích và đặt kế hoạch vận hành rõ ràng ngay từ ngày đầu khảo sát.</p>
<script type="application/ld+json">
{
   "@context": "https://schema.org",
   "@type": "BlogPosting",
   "headline": "Điểm nóng đầu tư Tiến Xuân 2026: chọn cụm nào để xuống tiền an toàn",
   "description": "Phân tích các cụm hot ở Tiến Xuân 2026, so sánh với khu lân cận và liệt kê kịch bản đầu tư, rủi ro cần khóa trước khi xuống tiền.",
   "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://hoalac.marketing/blog/diem-nong-dau-tu-tien-xuan"
   },
   "url": "https://hoalac.marketing/blog/diem-nong-dau-tu-tien-xuan",
   "inLanguage": "vi-VN",
   "articleSection": "phan-tich-khu-vuc",
   "keywords": [
      "Tiến Xuân",
      "Hòa Lạc",
      "đầu tư bất động sản"
   ],
   "datePublished": "2026-01-16",
   "dateModified": "2026-01-19",
   "author": {
      "@type": "Organization",
      "name": "Hòa Lạc Marketing"
   },
   "publisher": {
      "@type": "Organization",
      "name": "Hòa Lạc Marketing",
      "url": "https://hoalac.marketing"
   }
}
</script> </div> <section class="cta-module reading-cta" data-cta-key="mofu"> <section id="lead-form" class="section-shell section-shell--lead" data-lead-shell data-defer="false" data-endpoint="https://script.google.com/macros/s/AKfycbwM3REFLKfi9x765dPhBp2Hyd5hpEcx_DEL36kxudIMhnjCE5nIV7--HTeERxdpA-erLg/exec" data-global="false" data-force-modal="false" data-floating-enabled="true" data-astro-cid-xyq5hly5> <div class="lead-modal-overlay" data-lead-overlay aria-hidden="true" data-astro-cid-xyq5hly5></div> <div class="shell-inner lead-shell" data-astro-cid-xyq5hly5> <div class="lead-card" data-astro-cid-xyq5hly5> <div class="lead-copy" data-astro-cid-xyq5hly5> <p class="tag" data-astro-cid-xyq5hly5>So sánh khu vực</p> <h2 data-astro-cid-xyq5hly5>Nhận shortlist khu vực khớp room tài chính</h2> <p data-astro-cid-xyq5hly5>Ghi chú ngân sách, yêu cầu pháp lý để nhận 2-3 phương án cụ thể cùng checklist làm việc với môi giới tại Hòa Lạc.</p> </div> <form class="lead-form" data-lead-form novalidate data-astro-cid-xyq5hly5> <button class="lead-form__close" type="button" data-lead-close aria-label="Đóng form" data-astro-cid-xyq5hly5> <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" data-astro-cid-xyq5hly5> <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" data-astro-cid-xyq5hly5></path> </svg> </button> <fieldset class="field" data-field-group="intent" data-astro-cid-xyq5hly5> <legend data-astro-cid-xyq5hly5>Anh/chị quan tâm đất Hòa Lạc để:</legend> <div class="option-grid" data-astro-cid-xyq5hly5> <label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="intent" value="o_thuc" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Ở thật</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="intent" value="dau_tu_trung_han" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Đầu tư trung hạn</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="intent" value="luot_song" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Lướt sóng</span> </div> </label> </div> </fieldset> <p class="field-error" data-error-for="intent" role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> <fieldset class="field" data-field-group="budgetRange" data-astro-cid-xyq5hly5> <legend data-astro-cid-xyq5hly5>Tầm tài chính:</legend> <div class="option-grid" data-astro-cid-xyq5hly5> <label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="budgetRange" value="<1.5" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>&lt; 1,5 tỷ</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="budgetRange" value="1.5-2.5" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>1,5 – 2,5 tỷ</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="budgetRange" value="2.5-3.5" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>2,5 – 3,5 tỷ</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="budgetRange" value=">3.5" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>&gt; 3,5 tỷ</span> </div> </label> </div> </fieldset> <p class="field-error" data-error-for="budgetRange" role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> <fieldset class="field" data-field-group="areas" data-astro-cid-xyq5hly5> <legend data-astro-cid-xyq5hly5>Khu vực ưu tiên:</legend> <p class="hint" data-astro-cid-xyq5hly5>Chọn tối đa 2 khu vực (nếu cần).</p> <div class="option-grid" data-astro-cid-xyq5hly5> <label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="gan_dhqg" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Gần ĐHQG</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="gan_cnc" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Gần khu CNC</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="binh_yen_thach_hoa" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Bình Yên – Thạch Hòa</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="tien_xuan_yen_binh" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Tiến Xuân – Yên Bình</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="hoa_lac_trung_tam" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Trung tâm Hòa Lạc</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="khu_tay_bac" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Cụm Tây Bắc</span> </div> </label> </div> </fieldset> <p class="field-error" data-error-for="areas" role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> <fieldset class="field" data-field-group="legalRisk" data-astro-cid-xyq5hly5> <legend data-astro-cid-xyq5hly5>Mức chấp nhận pháp lý:</legend> <div class="option-grid option-grid--legal" data-astro-cid-xyq5hly5> <label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="legalRisk" value="so_do_san" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Chỉ sổ đỏ</span> <small data-astro-cid-xyq5hly5>Nhận đất ở ngay, pháp lý chuẩn</small> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="legalRisk" value="cho_len_tho_cu" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Chờ lên thổ cư</span> <small data-astro-cid-xyq5hly5>Chấp nhận 6–12 tháng làm thủ tục</small> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="legalRisk" value="co_the_rui_ro" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Có thể rủi ro</span> <small data-astro-cid-xyq5hly5>Chấp nhận đất vườn, quy hoạch chờ</small> </div> </label> </div> </fieldset> <p class="field-error" data-error-for="legalRisk" role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> <div class="field" data-field-group="contact" data-astro-cid-xyq5hly5> <label data-astro-cid-xyq5hly5>Để lại Zalo / SĐT</label> <input type="tel" name="contact" required inputmode="tel" pattern="^(03|05|07|08|09|01[2689])[0-9]{8}$" placeholder="Zalo hoặc số điện thoại" data-astro-cid-xyq5hly5> <p class="field-error" data-error-for="contact" role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> </div> <input type="hidden" name="source" value="lead-inline" data-astro-cid-xyq5hly5> <input type="hidden" name="leadTag" value="pending_classification" data-lead-tag data-astro-cid-xyq5hly5> <input type="text" name="company" class="hp" tabindex="-1" autocomplete="off" data-astro-cid-xyq5hly5> <button class="button" type="submit" data-astro-cid-xyq5hly5>Gửi yêu cầu</button> <p class="status" data-status role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> </form> </div> </div> <button class="floating-cta" type="button" data-floating-cta aria-hidden="true" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Đánh giá mức phù hợp</span> <small data-astro-cid-xyq5hly5>Trả lời 5 câu, nhận shortlist trong 24h</small> </button> </section>  <script type="module">
  (() => {
    const AREA_LIMIT = 2;
    const SCROLL_THRESHOLD = 0.65;
    const intentWeights = {
      o_thuc: 3,
      dau_tu_trung_han: 2,
      luot_song: 0
    };
    const budgetWeights = {
      '<1.5': 0,
      '1.5-2.5': 1,
      '2.5-3.5': 2,
      '>3.5': 3
    };
    const legalWeights = {
      so_do_san: 3,
      cho_len_tho_cu: 1,
      co_the_rui_ro: 0
    };
    const priorityAreas = ['gan_dhqg', 'gan_cnc'];
    const SECTION_FLOW = ['intent', 'budgetRange', 'areas', 'legalRisk', 'contact'];
    const SECTION_MESSAGES = {
      intent: 'Vui lòng chọn mục đích sử dụng.',
      budgetRange: 'Vui lòng chọn tầm tài chính.',
      areas: 'Vui lòng chọn ít nhất 1 khu vực ưu tiên.',
      legalRisk: 'Vui lòng chọn mức chấp nhận pháp lý.',
      contact: 'Vui lòng nhập số liên hệ hợp lệ.'
    };
    const PHONE_PATTERN = /^(03|05|07|08|09|01[2689])[0-9]{8}$/;

    const initKey = '__hoaLacLeadFormInit__';
    if (window[initKey]) {
      return;
    }

    window[initKey] = true;

    const boot = () => {
      const shells = Array.from(document.querySelectorAll('[data-lead-shell]'));
      shells.forEach((shell) => initLeadShell(shell));
    };

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', boot, { once: true });
    } else {
      boot();
    }

    function initLeadShell(shell) {
      const form = shell.querySelector('[data-lead-form]');
      if (!form) return;

      const status = shell.querySelector('[data-status]');
      const setStatus = createStatusSetter(status);
      const fieldErrors = createFieldErrorRegistry(form);
      const floatingCta = shell.querySelector('button[data-floating-cta]');
      const overlay = shell.querySelector('[data-lead-overlay]');
      const closeControls = Array.from(shell.querySelectorAll('[data-lead-close]'));
      const endpoint = shell.dataset.endpoint ?? '';
      const deferDisplay = shell.dataset.defer === 'true';
      const showFloatingCta = shell.dataset.floatingEnabled !== 'false';
      const isGlobalFallback = shell.dataset.global === 'true';
      const forceModal = shell.dataset.forceModal === 'true';
      const leadTagInput = form.querySelector('[data-lead-tag]');
      const fallbackLeadTag = leadTagInput?.value ?? 'pending_classification';
      let modalQuery;
      let preferModal = forceModal;
      let previousOverflow = '';

      setupValidationListeners(form, fieldErrors, setStatus);
      applySequentialTabIndex(form);
      const sectionFlow = setupSectionFlow(form, fieldErrors);
      form.addEventListener('reset', () => sectionFlow?.reset?.());

      const areaCheckboxes = form.querySelectorAll('input[name="areas"]');
      areaCheckboxes.forEach((checkbox) => {
        checkbox.addEventListener('change', (event) => handleAreaLimit(event, form, setStatus, fieldErrors));
      });

      const intentInputs = form.querySelectorAll('input[name="intent"]');
      intentInputs.forEach((input) => {
        input.addEventListener('change', () => broadcastIntentChange(input.value));
        if (input.checked) {
          broadcastIntentChange(input.value);
        }
      });

      const areaInputs = form.querySelectorAll('input[name="areas"]');
      areaInputs.forEach((input) => {
        input.addEventListener('change', () => broadcastAreasChange(getSelectedAreaLabels(form)));
      });

      const setBodyScrollLock = (locked) => {
        if (typeof document === 'undefined') return;
        if (locked) {
          previousOverflow = document.body.style.overflow;
          document.body.style.overflow = 'hidden';
        } else {
          document.body.style.overflow = previousOverflow;
        }
      };

      const closeModal = () => {
        if (!shell.classList.contains('is-modal-open')) return;
        shell.classList.remove('is-modal-open');
        overlay?.setAttribute('aria-hidden', 'true');
        setBodyScrollLock(false);
        form.reset();
        sectionFlow?.reset();
        if (leadTagInput) {
          leadTagInput.value = fallbackLeadTag;
        }
        setStatus('');
        fieldErrors.clearAll();
        shell.classList.remove('is-expanded');
        if (deferDisplay && showFloatingCta) {
          shell.classList.add('is-collapsed');
          shell.classList.add('cta-visible');
          floatingCta?.removeAttribute('aria-hidden');
        }
      };

      const openModal = () => {
        shell.classList.add('is-modal-open');
        shell.classList.add('is-expanded');
        shell.classList.remove('is-collapsed');
        shell.classList.remove('cta-visible');
        floatingCta?.setAttribute('aria-hidden', 'true');
        overlay?.removeAttribute('aria-hidden');
        setBodyScrollLock(true);
        const firstField = form.querySelector('input, select, textarea');
        firstField?.focus({ preventScroll: true });
      };

      const shouldUseModal = () => forceModal || preferModal;

      const updateModalPreference = () => {
        if (typeof window === 'undefined' || !deferDisplay || !showFloatingCta || forceModal) {
          return;
        }
        if (!modalQuery) {
          modalQuery = window.matchMedia('(max-width: 768px)');
          modalQuery.addEventListener('change', (event) => {
            preferModal = event.matches;
            if (!preferModal) {
              closeModal();
            }
          });
        }
        preferModal = modalQuery.matches;
      };

      updateModalPreference();

      const revealLeadCapture = () => {
        if (shouldUseModal()) {
          openModal();
          return;
        }
        shell.classList.add('is-expanded');
        shell.classList.remove('is-collapsed');
        shell.classList.remove('cta-visible');
        floatingCta?.setAttribute('aria-hidden', 'true');
        const firstField = form.querySelector('input, select, textarea');
        firstField?.focus();
        form.scrollIntoView({ behavior: 'smooth', block: 'center' });
      };

      closeControls.forEach((control) => {
        control.addEventListener('click', closeModal);
      });
      overlay?.addEventListener('click', closeModal);

      window.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') {
          closeModal();
        }
      });
      window.addEventListener('resize', updateModalPreference);

      function handleScrollReveal() {
        if (!deferDisplay || !floatingCta || !showFloatingCta) return;
        shell.classList.add('is-collapsed');

        const showCta = () => {
          const maxScroll = document.documentElement.scrollHeight - window.innerHeight;
          const progress = maxScroll <= 0 ? 1 : window.scrollY / maxScroll;
          if (progress >= SCROLL_THRESHOLD) {
            shell.classList.add('cta-visible');
            floatingCta.removeAttribute('aria-hidden');
            window.removeEventListener('scroll', onScroll);
          }
        };

        let ticking = false;
        const onScroll = () => {
          if (ticking) return;
          ticking = true;
          requestAnimationFrame(() => {
            showCta();
            ticking = false;
          });
        };

        window.addEventListener('scroll', onScroll, { passive: true });
        setTimeout(showCta, 8000);

        floatingCta.addEventListener('click', revealLeadCapture);
      }

      handleScrollReveal();

      function attachAnchorReveal() {
        if (!shell.id) return;
        const inlineAnchors = Array.from(document.querySelectorAll(`a[href="#${shell.id}"]`));
        if (inlineAnchors.length === 0) return;

        inlineAnchors.forEach((anchor) => {
          anchor.addEventListener('click', (event) => {
            if (!shell.classList.contains('is-collapsed')) return;
            if (!deferDisplay || !showFloatingCta) return;
            if (shouldUseModal()) return;
            event.preventDefault();
            revealLeadCapture();
          });
        });
      }

      attachAnchorReveal();

      if (isGlobalFallback) {
        const portalQueueKey = '__hoaLacLeadPortalQueue__';
        window.addEventListener('lead-form:request-open', openModal);
        window.addEventListener('lead-form:request-close', closeModal);

        window.__hoaLacLeadPortal = {
          open: () => openModal(),
          close: () => closeModal()
        };

        const queue = window[portalQueueKey];
        if (Array.isArray(queue) && queue.length > 0) {
          while (queue.length > 0) {
            const action = queue.shift();
            if (action === 'open') {
              openModal();
            } else if (action === 'close') {
              closeModal();
            }
          }
        }
        window[portalQueueKey] = [];
      }

      form.addEventListener('submit', (event) => {
        submitLead({
          event,
          form,
          setStatus,
          fieldErrors,
          sectionFlow,
          endpoint,
          leadTagInput,
          fallbackLeadTag,
          onSuccess: () => {
            if (shell.classList.contains('is-modal-open')) {
              setTimeout(() => closeModal(), 2000);
            }
          }
        });
      });
    }

    function createStatusSetter(statusEl) {
      const setter = (message = '', state = 'info') => {
        if (!statusEl) return;
        const text = message ?? '';
        statusEl.textContent = text;
        if (text) {
          statusEl.dataset.state = state;
        } else {
          statusEl.removeAttribute('data-state');
        }
        setter.currentMessage = text;
        setter.currentState = text ? state : undefined;
      };
      setter.currentMessage = statusEl?.textContent ?? '';
      setter.currentState = statusEl?.dataset?.state;
      return setter;
    }

    function handleAreaLimit(event, form, setStatus, fieldErrors) {
      const checkedAreas = form.querySelectorAll('input[name="areas"]:checked');
      if (checkedAreas.length > AREA_LIMIT) {
        event.target.checked = false;
        setStatus(`Chỉ chọn tối đa ${AREA_LIMIT} khu vực.`, 'error');
        fieldErrors?.set('areas', `Chỉ chọn tối đa ${AREA_LIMIT} khu vực.`);
        focusField(event.target);
        return;
      }
      if (typeof setStatus === 'function' && setStatus.currentMessage?.includes('Chỉ chọn tối đa')) {
        setStatus('');
      }
      fieldErrors?.clear('areas');
    }

    function getSelectedAreaLabels(form) {
      return Array.from(form.querySelectorAll('input[name="areas"]:checked'))
        .map((input) => input.nextElementSibling?.textContent?.trim())
        .filter((label) => Boolean(label));
    }

    function broadcastIntentChange(intentValue) {
      if (typeof window === 'undefined' || !intentValue) return;
      window.dispatchEvent(new CustomEvent('lead-intent-change', {
        detail: { intent: intentValue }
      }));
    }

    function broadcastAreasChange(labels) {
      if (typeof window === 'undefined') return;
      window.dispatchEvent(new CustomEvent('lead-areas-change', {
        detail: { areas: labels }
      }));
    }

    function setupValidationListeners(form, fieldErrors, setStatus) {
      if (!form) return;
      SECTION_FLOW.forEach((key) => {
        const group = form.querySelector(`[data-field-group="${key}"]`);
        if (!group) return;
        const inputs = group.querySelectorAll('input, select, textarea');
        inputs.forEach((input) => {
          const eventName = input.type === 'radio' || input.type === 'checkbox' ? 'change' : 'input';
          input.addEventListener(eventName, () => {
            const result = validateSection(key, form);
            if (result.valid) {
              fieldErrors?.clear(key);
              if (allSectionsValid(form) && setStatus?.currentState !== 'success') {
                setStatus?.('');
              }
            } else if (result.message) {
              fieldErrors?.set(key, result.message);
            }
          });
        });
      });

      form.addEventListener('reset', () => {
        fieldErrors?.clearAll();
      });
    }

    function serializeForm(formElement) {
      const formData = new FormData(formElement);
      const data = Object.fromEntries(formData);
      const selectedAreas = formData.getAll('areas');
      if (selectedAreas.length > 0) {
        data.areas = selectedAreas.join(', ');
      }
      return data;
    }

    function computeLeadTag({ intent, budgetRange, legalRisk, areas }) {
      let score = 0;
      score += intentWeights[intent] ?? 0;
      score += budgetWeights[budgetRange] ?? 0;
      score += legalWeights[legalRisk] ?? 0;
      if (areas?.some((area) => priorityAreas.includes(area))) {
        score += 1;
      }

      if (intent === 'luot_song' && legalRisk === 'co_the_rui_ro') {
        return 'lead_cold';
      }
      if (score >= 6) {
        return 'lead_hot';
      }
      if (score >= 3) {
        return 'lead_warm';
      }
      return 'lead_cold';
    }

    async function submitLead({ event, form, setStatus, fieldErrors, sectionFlow, endpoint, leadTagInput, fallbackLeadTag, onSuccess }) {
      event.preventDefault();
      if (!form) return;

      const validation = runSequentialValidation({ form, fieldErrors, setStatus });
      if (!validation.ok) {
        focusSection(validation.section, form);
        return;
      }

      const selectedAreaValues = Array.from(form.querySelectorAll('input[name="areas"]:checked')).map((input) => input.value);

      const now = new Date();
      const vnDateTime = now.toLocaleString('vi-VN', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        hour12: false
      });

      const data = serializeForm(form);
      data.areas = selectedAreaValues.join(', ');
      const computedTag = computeLeadTag({
        intent: data.intent,
        budgetRange: data.budgetRange,
        legalRisk: data.legalRisk,
        areas: selectedAreaValues
      }) ?? fallbackLeadTag;
      data.leadTag = computedTag;
      if (typeof data.contact === 'string') {
        data.contact = data.contact.replace(/\s+/g, '').replace(/^0*/, (match) => (match ? '0' : ''));
      }
      if (leadTagInput) {
        leadTagInput.value = computedTag;
      }
      data.submittedAt = now.toISOString();
      data.submittedAtLocal = vnDateTime;

      if (data.company) {
        setStatus?.('Đã chặn spam.', 'warning');
        return;
      }

      if (!endpoint) {
        setStatus?.('Chưa cấu hình PUBLIC_LEAD_ENDPOINT.', 'error');
        return;
      }

      setStatus?.('Đang gửi...', 'info');
      try {
        const body = new URLSearchParams();
        Object.entries(data).forEach(([key, value]) => {
          body.append(key, typeof value === 'string' ? value : String(value ?? ''));
        });

        const response = await fetch(endpoint, {
          method: 'POST',
          body
        });

        if (response.ok) {
          let payloadMessage = 'Đã nhận thông tin!';
          try {
            const payload = await response.json();
            if (payload?.message) payloadMessage = payload.message;
          } catch (parseErr) {
            console.warn('Không parse được payload, dùng message mặc định.', parseErr);
          }
          setStatus?.(payloadMessage, 'success');
          form.reset();
          sectionFlow?.reset?.();
          fieldErrors?.clearAll();
          if (typeof onSuccess === 'function') {
            onSuccess();
          }
          return;
        }

        throw new Error(`Request failed with status ${response.status}`);
      } catch (error) {
        console.error(error);
        if (error instanceof TypeError) {
          setStatus?.('Đã nhận thông tin!', 'success');
          if (typeof onSuccess === 'function') {
            onSuccess();
          }
          form.reset();
          sectionFlow?.reset?.();
          fieldErrors?.clearAll();
        } else {
          setStatus?.('Không gửi được, vui lòng thử lại.', 'error');
        }
      }
    }

    function runSequentialValidation({ form, fieldErrors, setStatus }) {
      if (!form) {
        return { ok: false, section: undefined };
      }
      for (const key of SECTION_FLOW) {
        const result = validateSection(key, form);
        if (!result.valid) {
          if (result.message) {
            fieldErrors?.set(key, result.message);
            setStatus?.(result.message, 'error');
          }
          return { ok: false, section: key };
        }
        fieldErrors?.clear(key);
      }
      if (setStatus?.currentState !== 'success') {
        setStatus?.('');
      }
      return { ok: true };
    }

    function createFieldErrorRegistry(form) {
      const errorNodes = new Map();
      form.querySelectorAll('[data-error-for]').forEach((node) => {
        if (!(node instanceof HTMLElement)) return;
        const key = node.dataset.errorFor;
        if (!key) return;
        errorNodes.set(key, node);
        node.setAttribute('hidden', 'hidden');
      });

      const getGroup = (key) => form.querySelector(`[data-field-group="${key}"]`);

      const set = (key, message = '') => {
        if (!key) return;
        const node = errorNodes.get(key);
        const text = message?.trim() ?? '';
        if (node) {
          if (text) {
            node.textContent = text;
            node.removeAttribute('hidden');
          } else {
            node.textContent = '';
            node.setAttribute('hidden', 'hidden');
          }
        }
        const group = getGroup(key);
        if (group) {
          if (text) {
            group.classList.add('is-invalid');
          } else {
            group.classList.remove('is-invalid');
          }
        }
      };

      const clear = (key) => set(key, '');
      const clearAll = () => {
        errorNodes.forEach((_node, key) => {
          clear(key);
        });
      };

      return { set, clear, clearAll };
    }

    function focusField(field) {
      if (!field) return;
      requestAnimationFrame(() => {
        if (typeof field.scrollIntoView === 'function') {
          field.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'nearest' });
        }
        if (typeof field.focus === 'function') {
          field.focus({ preventScroll: true });
        }
      });
    }

    function getFieldErrorKey(field) {
      if (!field) return '';
      if (field.name) return field.name;
      if (field.dataset?.errorKey) return field.dataset.errorKey;
      const group = field.closest('[data-field-group]');
      return group instanceof HTMLElement ? group.dataset.fieldGroup ?? '' : '';
    }

    function setupSectionFlow(form, fieldErrors) {
      if (!form) return null;
      const completedSections = new Set();

      const handleProgress = (key) => {
        if (!isSectionComplete(key, form)) {
          completedSections.delete(key);
          return;
        }
        if (completedSections.has(key)) {
          return;
        }
        completedSections.add(key);
        fieldErrors?.clear(key);
        const nextKey = getNextSectionKey(key);
        if (nextKey) {
          focusSection(nextKey, form);
        } else {
          const submitButton = form.querySelector('button[type="submit"]');
          focusField(submitButton);
        }
      };

      SECTION_FLOW.forEach((key) => {
        const group = form.querySelector(`[data-field-group="${key}"]`);
        if (!group) return;
        const inputs = group.querySelectorAll('input, select, textarea');
        inputs.forEach((input) => {
          const eventName = input.type === 'radio' || input.type === 'checkbox' ? 'change' : 'input';
          input.addEventListener(eventName, () => handleProgress(key));
        });
      });

      return {
        reset: () => completedSections.clear()
      };
    }

    function isSectionComplete(key, form) {
      switch (key) {
        case 'intent':
        case 'budgetRange':
        case 'legalRisk':
          return Boolean(form.querySelector(`input[name="${key}"]:checked`));
        case 'areas':
          return form.querySelectorAll('input[name="areas"]:checked').length > 0;
        case 'contact': {
          const input = form.querySelector('input[name="contact"]');
          const value = input?.value?.trim() ?? '';
          return PHONE_PATTERN.test(value);
        }
        default:
          return true;
      }
    }

    function validateSection(key, form) {
      switch (key) {
        case 'intent': {
          const checked = form.querySelector('input[name="intent"]:checked');
          return checked ? { valid: true } : { valid: false, message: SECTION_MESSAGES.intent };
        }
        case 'budgetRange': {
          const checked = form.querySelector('input[name="budgetRange"]:checked');
          return checked ? { valid: true } : { valid: false, message: SECTION_MESSAGES.budgetRange };
        }
        case 'areas': {
          const checkedCount = form.querySelectorAll('input[name="areas"]:checked').length;
          if (checkedCount === 0) {
            return { valid: false, message: SECTION_MESSAGES.areas };
          }
          if (checkedCount > AREA_LIMIT) {
            return { valid: false, message: `Chỉ chọn tối đa ${AREA_LIMIT} khu vực.` };
          }
          return { valid: true };
        }
        case 'legalRisk': {
          const checked = form.querySelector('input[name="legalRisk"]:checked');
          return checked ? { valid: true } : { valid: false, message: SECTION_MESSAGES.legalRisk };
        }
        case 'contact': {
          const input = form.querySelector('input[name="contact"]');
          const value = input?.value?.trim() ?? '';
          if (!value) {
            return { valid: false, message: 'Vui lòng nhập số liên hệ.' };
          }
          if (!PHONE_PATTERN.test(value)) {
            return { valid: false, message: 'Số liên hệ phải đủ 10 số và bắt đầu bằng 03, 05, 07, 08, 09 hoặc 01[2|6|8|9].' };
          }
          return { valid: true };
        }
        default:
          return { valid: true };
      }
    }

    function focusSection(key, form) {
      if (!key || !form) return;
      const group = form.querySelector(`[data-field-group="${key}"]`);
      if (!group) return;
      const focusable = group.querySelector('input:not([type="hidden"]), select, textarea, button');
      if (focusable) {
        focusField(focusable);
      }
    }

    function getNextSectionKey(key) {
      const index = SECTION_FLOW.indexOf(key);
      if (index === -1) return undefined;
      return SECTION_FLOW[index + 1];
    }

    function allSectionsValid(form) {
      return SECTION_FLOW.every((key) => validateSection(key, form).valid);
    }

    function applySequentialTabIndex(form) {
      if (!form) return;
      const focusableSelectors = [
        'input:not([type="hidden"]):not(.hp)',
        'select',
        'textarea',
        'button'
      ].join(',');
      const focusables = Array.from(form.querySelectorAll(focusableSelectors));
      let order = 1;
      focusables.forEach((node) => {
        if (node instanceof HTMLInputElement || node instanceof HTMLSelectElement || node instanceof HTMLTextAreaElement || node instanceof HTMLButtonElement) {
          if (node.disabled || node.tabIndex < 0) {
            return;
          }
          node.tabIndex = order;
          order += 1;
        }
      });
    }
  })();
</script> </section> </article>  </main> <footer class="site-footer"> <div class="site-footer__inner"> <div> <p class="site-footer__brand">Insight Hòa Lạc © 2026</p> <p class="site-footer__copy">Landing page thử nghiệm GitHub Pages + funnel marketing.</p> </div> <div class="site-footer__links"> <a href="/hoalac_marketing/blog">Truy cập blog</a> <a href="#lead-form" class="site-footer__cta">Đăng ký tư vấn</a> </div> <div class="site-footer__contact"> <a href="mailto:contact@example.com">contact@example.com</a> <a href="https://t.me/" target="_blank" rel="noreferrer">Telegram</a> </div> </div> </footer> <section id="lead-form-global" class="section-shell section-shell--lead lead-shell--portal" data-lead-shell data-defer="true" data-endpoint="https://script.google.com/macros/s/AKfycbwM3REFLKfi9x765dPhBp2Hyd5hpEcx_DEL36kxudIMhnjCE5nIV7--HTeERxdpA-erLg/exec" data-global="true" data-force-modal="true" data-floating-enabled="false" data-astro-cid-xyq5hly5> <div class="lead-modal-overlay" data-lead-overlay aria-hidden="true" data-astro-cid-xyq5hly5></div> <div class="shell-inner lead-shell" data-astro-cid-xyq5hly5> <div class="lead-card" data-astro-cid-xyq5hly5> <div class="lead-copy" data-astro-cid-xyq5hly5> <p class="tag" data-astro-cid-xyq5hly5>Lead Qualification</p> <h2 data-astro-cid-xyq5hly5>Đánh giá mức phù hợp Hòa Lạc</h2> <p data-astro-cid-xyq5hly5>Trả lời 5 câu để đội ngũ gợi ý khu vực, pháp lý và room tài chính khớp với nhu cầu trong 24 giờ.</p> </div> <form class="lead-form" data-lead-form novalidate data-astro-cid-xyq5hly5> <button class="lead-form__close" type="button" data-lead-close aria-label="Đóng form" data-astro-cid-xyq5hly5> <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" data-astro-cid-xyq5hly5> <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" data-astro-cid-xyq5hly5></path> </svg> </button> <fieldset class="field" data-field-group="intent" data-astro-cid-xyq5hly5> <legend data-astro-cid-xyq5hly5>Anh/chị quan tâm đất Hòa Lạc để:</legend> <div class="option-grid" data-astro-cid-xyq5hly5> <label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="intent" value="o_thuc" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Ở thật</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="intent" value="dau_tu_trung_han" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Đầu tư trung hạn</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="intent" value="luot_song" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Lướt sóng</span> </div> </label> </div> </fieldset> <p class="field-error" data-error-for="intent" role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> <fieldset class="field" data-field-group="budgetRange" data-astro-cid-xyq5hly5> <legend data-astro-cid-xyq5hly5>Tầm tài chính:</legend> <div class="option-grid" data-astro-cid-xyq5hly5> <label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="budgetRange" value="<1.5" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>&lt; 1,5 tỷ</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="budgetRange" value="1.5-2.5" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>1,5 – 2,5 tỷ</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="budgetRange" value="2.5-3.5" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>2,5 – 3,5 tỷ</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="budgetRange" value=">3.5" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>&gt; 3,5 tỷ</span> </div> </label> </div> </fieldset> <p class="field-error" data-error-for="budgetRange" role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> <fieldset class="field" data-field-group="areas" data-astro-cid-xyq5hly5> <legend data-astro-cid-xyq5hly5>Khu vực ưu tiên:</legend> <p class="hint" data-astro-cid-xyq5hly5>Chọn tối đa 2 khu vực (nếu cần).</p> <div class="option-grid" data-astro-cid-xyq5hly5> <label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="gan_dhqg" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Gần ĐHQG</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="gan_cnc" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Gần khu CNC</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="binh_yen_thach_hoa" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Bình Yên – Thạch Hòa</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="tien_xuan_yen_binh" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Tiến Xuân – Yên Bình</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="hoa_lac_trung_tam" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Trung tâm Hòa Lạc</span> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="checkbox" name="areas" value="khu_tay_bac" data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Cụm Tây Bắc</span> </div> </label> </div> </fieldset> <p class="field-error" data-error-for="areas" role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> <fieldset class="field" data-field-group="legalRisk" data-astro-cid-xyq5hly5> <legend data-astro-cid-xyq5hly5>Mức chấp nhận pháp lý:</legend> <div class="option-grid option-grid--legal" data-astro-cid-xyq5hly5> <label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="legalRisk" value="so_do_san" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Chỉ sổ đỏ</span> <small data-astro-cid-xyq5hly5>Nhận đất ở ngay, pháp lý chuẩn</small> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="legalRisk" value="cho_len_tho_cu" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Chờ lên thổ cư</span> <small data-astro-cid-xyq5hly5>Chấp nhận 6–12 tháng làm thủ tục</small> </div> </label><label class="option" data-astro-cid-xyq5hly5> <input type="radio" name="legalRisk" value="co_the_rui_ro" required data-astro-cid-xyq5hly5> <div class="option-text" data-astro-cid-xyq5hly5> <span data-astro-cid-xyq5hly5>Có thể rủi ro</span> <small data-astro-cid-xyq5hly5>Chấp nhận đất vườn, quy hoạch chờ</small> </div> </label> </div> </fieldset> <p class="field-error" data-error-for="legalRisk" role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> <div class="field" data-field-group="contact" data-astro-cid-xyq5hly5> <label data-astro-cid-xyq5hly5>Để lại Zalo / SĐT</label> <input type="tel" name="contact" required inputmode="tel" pattern="^(03|05|07|08|09|01[2689])[0-9]{8}$" placeholder="Zalo hoặc số điện thoại" data-astro-cid-xyq5hly5> <p class="field-error" data-error-for="contact" role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> </div> <input type="hidden" name="source" value="lead-portal" data-astro-cid-xyq5hly5> <input type="hidden" name="leadTag" value="pending_classification" data-lead-tag data-astro-cid-xyq5hly5> <input type="text" name="company" class="hp" tabindex="-1" autocomplete="off" data-astro-cid-xyq5hly5> <button class="button" type="submit" data-astro-cid-xyq5hly5>Gửi yêu cầu</button> <p class="status" data-status role="status" aria-live="polite" data-astro-cid-xyq5hly5></p> </form> </div> </div>  </section>  <script type="module">
  (() => {
    const AREA_LIMIT = 2;
    const SCROLL_THRESHOLD = 0.65;
    const intentWeights = {
      o_thuc: 3,
      dau_tu_trung_han: 2,
      luot_song: 0
    };
    const budgetWeights = {
      '<1.5': 0,
      '1.5-2.5': 1,
      '2.5-3.5': 2,
      '>3.5': 3
    };
    const legalWeights = {
      so_do_san: 3,
      cho_len_tho_cu: 1,
      co_the_rui_ro: 0
    };
    const priorityAreas = ['gan_dhqg', 'gan_cnc'];
    const SECTION_FLOW = ['intent', 'budgetRange', 'areas', 'legalRisk', 'contact'];
    const SECTION_MESSAGES = {
      intent: 'Vui lòng chọn mục đích sử dụng.',
      budgetRange: 'Vui lòng chọn tầm tài chính.',
      areas: 'Vui lòng chọn ít nhất 1 khu vực ưu tiên.',
      legalRisk: 'Vui lòng chọn mức chấp nhận pháp lý.',
      contact: 'Vui lòng nhập số liên hệ hợp lệ.'
    };
    const PHONE_PATTERN = /^(03|05|07|08|09|01[2689])[0-9]{8}$/;

    const initKey = '__hoaLacLeadFormInit__';
    if (window[initKey]) {
      return;
    }

    window[initKey] = true;

    const boot = () => {
      const shells = Array.from(document.querySelectorAll('[data-lead-shell]'));
      shells.forEach((shell) => initLeadShell(shell));
    };

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', boot, { once: true });
    } else {
      boot();
    }

    function initLeadShell(shell) {
      const form = shell.querySelector('[data-lead-form]');
      if (!form) return;

      const status = shell.querySelector('[data-status]');
      const setStatus = createStatusSetter(status);
      const fieldErrors = createFieldErrorRegistry(form);
      const floatingCta = shell.querySelector('button[data-floating-cta]');
      const overlay = shell.querySelector('[data-lead-overlay]');
      const closeControls = Array.from(shell.querySelectorAll('[data-lead-close]'));
      const endpoint = shell.dataset.endpoint ?? '';
      const deferDisplay = shell.dataset.defer === 'true';
      const showFloatingCta = shell.dataset.floatingEnabled !== 'false';
      const isGlobalFallback = shell.dataset.global === 'true';
      const forceModal = shell.dataset.forceModal === 'true';
      const leadTagInput = form.querySelector('[data-lead-tag]');
      const fallbackLeadTag = leadTagInput?.value ?? 'pending_classification';
      let modalQuery;
      let preferModal = forceModal;
      let previousOverflow = '';

      setupValidationListeners(form, fieldErrors, setStatus);
      applySequentialTabIndex(form);
      const sectionFlow = setupSectionFlow(form, fieldErrors);
      form.addEventListener('reset', () => sectionFlow?.reset?.());

      const areaCheckboxes = form.querySelectorAll('input[name="areas"]');
      areaCheckboxes.forEach((checkbox) => {
        checkbox.addEventListener('change', (event) => handleAreaLimit(event, form, setStatus, fieldErrors));
      });

      const intentInputs = form.querySelectorAll('input[name="intent"]');
      intentInputs.forEach((input) => {
        input.addEventListener('change', () => broadcastIntentChange(input.value));
        if (input.checked) {
          broadcastIntentChange(input.value);
        }
      });

      const areaInputs = form.querySelectorAll('input[name="areas"]');
      areaInputs.forEach((input) => {
        input.addEventListener('change', () => broadcastAreasChange(getSelectedAreaLabels(form)));
      });

      const setBodyScrollLock = (locked) => {
        if (typeof document === 'undefined') return;
        if (locked) {
          previousOverflow = document.body.style.overflow;
          document.body.style.overflow = 'hidden';
        } else {
          document.body.style.overflow = previousOverflow;
        }
      };

      const closeModal = () => {
        if (!shell.classList.contains('is-modal-open')) return;
        shell.classList.remove('is-modal-open');
        overlay?.setAttribute('aria-hidden', 'true');
        setBodyScrollLock(false);
        form.reset();
        sectionFlow?.reset();
        if (leadTagInput) {
          leadTagInput.value = fallbackLeadTag;
        }
        setStatus('');
        fieldErrors.clearAll();
        shell.classList.remove('is-expanded');
        if (deferDisplay && showFloatingCta) {
          shell.classList.add('is-collapsed');
          shell.classList.add('cta-visible');
          floatingCta?.removeAttribute('aria-hidden');
        }
      };

      const openModal = () => {
        shell.classList.add('is-modal-open');
        shell.classList.add('is-expanded');
        shell.classList.remove('is-collapsed');
        shell.classList.remove('cta-visible');
        floatingCta?.setAttribute('aria-hidden', 'true');
        overlay?.removeAttribute('aria-hidden');
        setBodyScrollLock(true);
        const firstField = form.querySelector('input, select, textarea');
        firstField?.focus({ preventScroll: true });
      };

      const shouldUseModal = () => forceModal || preferModal;

      const updateModalPreference = () => {
        if (typeof window === 'undefined' || !deferDisplay || !showFloatingCta || forceModal) {
          return;
        }
        if (!modalQuery) {
          modalQuery = window.matchMedia('(max-width: 768px)');
          modalQuery.addEventListener('change', (event) => {
            preferModal = event.matches;
            if (!preferModal) {
              closeModal();
            }
          });
        }
        preferModal = modalQuery.matches;
      };

      updateModalPreference();

      const revealLeadCapture = () => {
        if (shouldUseModal()) {
          openModal();
          return;
        }
        shell.classList.add('is-expanded');
        shell.classList.remove('is-collapsed');
        shell.classList.remove('cta-visible');
        floatingCta?.setAttribute('aria-hidden', 'true');
        const firstField = form.querySelector('input, select, textarea');
        firstField?.focus();
        form.scrollIntoView({ behavior: 'smooth', block: 'center' });
      };

      closeControls.forEach((control) => {
        control.addEventListener('click', closeModal);
      });
      overlay?.addEventListener('click', closeModal);

      window.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') {
          closeModal();
        }
      });
      window.addEventListener('resize', updateModalPreference);

      function handleScrollReveal() {
        if (!deferDisplay || !floatingCta || !showFloatingCta) return;
        shell.classList.add('is-collapsed');

        const showCta = () => {
          const maxScroll = document.documentElement.scrollHeight - window.innerHeight;
          const progress = maxScroll <= 0 ? 1 : window.scrollY / maxScroll;
          if (progress >= SCROLL_THRESHOLD) {
            shell.classList.add('cta-visible');
            floatingCta.removeAttribute('aria-hidden');
            window.removeEventListener('scroll', onScroll);
          }
        };

        let ticking = false;
        const onScroll = () => {
          if (ticking) return;
          ticking = true;
          requestAnimationFrame(() => {
            showCta();
            ticking = false;
          });
        };

        window.addEventListener('scroll', onScroll, { passive: true });
        setTimeout(showCta, 8000);

        floatingCta.addEventListener('click', revealLeadCapture);
      }

      handleScrollReveal();

      function attachAnchorReveal() {
        if (!shell.id) return;
        const inlineAnchors = Array.from(document.querySelectorAll(`a[href="#${shell.id}"]`));
        if (inlineAnchors.length === 0) return;

        inlineAnchors.forEach((anchor) => {
          anchor.addEventListener('click', (event) => {
            if (!shell.classList.contains('is-collapsed')) return;
            if (!deferDisplay || !showFloatingCta) return;
            if (shouldUseModal()) return;
            event.preventDefault();
            revealLeadCapture();
          });
        });
      }

      attachAnchorReveal();

      if (isGlobalFallback) {
        const portalQueueKey = '__hoaLacLeadPortalQueue__';
        window.addEventListener('lead-form:request-open', openModal);
        window.addEventListener('lead-form:request-close', closeModal);

        window.__hoaLacLeadPortal = {
          open: () => openModal(),
          close: () => closeModal()
        };

        const queue = window[portalQueueKey];
        if (Array.isArray(queue) && queue.length > 0) {
          while (queue.length > 0) {
            const action = queue.shift();
            if (action === 'open') {
              openModal();
            } else if (action === 'close') {
              closeModal();
            }
          }
        }
        window[portalQueueKey] = [];
      }

      form.addEventListener('submit', (event) => {
        submitLead({
          event,
          form,
          setStatus,
          fieldErrors,
          sectionFlow,
          endpoint,
          leadTagInput,
          fallbackLeadTag,
          onSuccess: () => {
            if (shell.classList.contains('is-modal-open')) {
              setTimeout(() => closeModal(), 2000);
            }
          }
        });
      });
    }

    function createStatusSetter(statusEl) {
      const setter = (message = '', state = 'info') => {
        if (!statusEl) return;
        const text = message ?? '';
        statusEl.textContent = text;
        if (text) {
          statusEl.dataset.state = state;
        } else {
          statusEl.removeAttribute('data-state');
        }
        setter.currentMessage = text;
        setter.currentState = text ? state : undefined;
      };
      setter.currentMessage = statusEl?.textContent ?? '';
      setter.currentState = statusEl?.dataset?.state;
      return setter;
    }

    function handleAreaLimit(event, form, setStatus, fieldErrors) {
      const checkedAreas = form.querySelectorAll('input[name="areas"]:checked');
      if (checkedAreas.length > AREA_LIMIT) {
        event.target.checked = false;
        setStatus(`Chỉ chọn tối đa ${AREA_LIMIT} khu vực.`, 'error');
        fieldErrors?.set('areas', `Chỉ chọn tối đa ${AREA_LIMIT} khu vực.`);
        focusField(event.target);
        return;
      }
      if (typeof setStatus === 'function' && setStatus.currentMessage?.includes('Chỉ chọn tối đa')) {
        setStatus('');
      }
      fieldErrors?.clear('areas');
    }

    function getSelectedAreaLabels(form) {
      return Array.from(form.querySelectorAll('input[name="areas"]:checked'))
        .map((input) => input.nextElementSibling?.textContent?.trim())
        .filter((label) => Boolean(label));
    }

    function broadcastIntentChange(intentValue) {
      if (typeof window === 'undefined' || !intentValue) return;
      window.dispatchEvent(new CustomEvent('lead-intent-change', {
        detail: { intent: intentValue }
      }));
    }

    function broadcastAreasChange(labels) {
      if (typeof window === 'undefined') return;
      window.dispatchEvent(new CustomEvent('lead-areas-change', {
        detail: { areas: labels }
      }));
    }

    function setupValidationListeners(form, fieldErrors, setStatus) {
      if (!form) return;
      SECTION_FLOW.forEach((key) => {
        const group = form.querySelector(`[data-field-group="${key}"]`);
        if (!group) return;
        const inputs = group.querySelectorAll('input, select, textarea');
        inputs.forEach((input) => {
          const eventName = input.type === 'radio' || input.type === 'checkbox' ? 'change' : 'input';
          input.addEventListener(eventName, () => {
            const result = validateSection(key, form);
            if (result.valid) {
              fieldErrors?.clear(key);
              if (allSectionsValid(form) && setStatus?.currentState !== 'success') {
                setStatus?.('');
              }
            } else if (result.message) {
              fieldErrors?.set(key, result.message);
            }
          });
        });
      });

      form.addEventListener('reset', () => {
        fieldErrors?.clearAll();
      });
    }

    function serializeForm(formElement) {
      const formData = new FormData(formElement);
      const data = Object.fromEntries(formData);
      const selectedAreas = formData.getAll('areas');
      if (selectedAreas.length > 0) {
        data.areas = selectedAreas.join(', ');
      }
      return data;
    }

    function computeLeadTag({ intent, budgetRange, legalRisk, areas }) {
      let score = 0;
      score += intentWeights[intent] ?? 0;
      score += budgetWeights[budgetRange] ?? 0;
      score += legalWeights[legalRisk] ?? 0;
      if (areas?.some((area) => priorityAreas.includes(area))) {
        score += 1;
      }

      if (intent === 'luot_song' && legalRisk === 'co_the_rui_ro') {
        return 'lead_cold';
      }
      if (score >= 6) {
        return 'lead_hot';
      }
      if (score >= 3) {
        return 'lead_warm';
      }
      return 'lead_cold';
    }

    async function submitLead({ event, form, setStatus, fieldErrors, sectionFlow, endpoint, leadTagInput, fallbackLeadTag, onSuccess }) {
      event.preventDefault();
      if (!form) return;

      const validation = runSequentialValidation({ form, fieldErrors, setStatus });
      if (!validation.ok) {
        focusSection(validation.section, form);
        return;
      }

      const selectedAreaValues = Array.from(form.querySelectorAll('input[name="areas"]:checked')).map((input) => input.value);

      const now = new Date();
      const vnDateTime = now.toLocaleString('vi-VN', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        hour12: false
      });

      const data = serializeForm(form);
      data.areas = selectedAreaValues.join(', ');
      const computedTag = computeLeadTag({
        intent: data.intent,
        budgetRange: data.budgetRange,
        legalRisk: data.legalRisk,
        areas: selectedAreaValues
      }) ?? fallbackLeadTag;
      data.leadTag = computedTag;
      if (typeof data.contact === 'string') {
        data.contact = data.contact.replace(/\s+/g, '').replace(/^0*/, (match) => (match ? '0' : ''));
      }
      if (leadTagInput) {
        leadTagInput.value = computedTag;
      }
      data.submittedAt = now.toISOString();
      data.submittedAtLocal = vnDateTime;

      if (data.company) {
        setStatus?.('Đã chặn spam.', 'warning');
        return;
      }

      if (!endpoint) {
        setStatus?.('Chưa cấu hình PUBLIC_LEAD_ENDPOINT.', 'error');
        return;
      }

      setStatus?.('Đang gửi...', 'info');
      try {
        const body = new URLSearchParams();
        Object.entries(data).forEach(([key, value]) => {
          body.append(key, typeof value === 'string' ? value : String(value ?? ''));
        });

        const response = await fetch(endpoint, {
          method: 'POST',
          body
        });

        if (response.ok) {
          let payloadMessage = 'Đã nhận thông tin!';
          try {
            const payload = await response.json();
            if (payload?.message) payloadMessage = payload.message;
          } catch (parseErr) {
            console.warn('Không parse được payload, dùng message mặc định.', parseErr);
          }
          setStatus?.(payloadMessage, 'success');
          form.reset();
          sectionFlow?.reset?.();
          fieldErrors?.clearAll();
          if (typeof onSuccess === 'function') {
            onSuccess();
          }
          return;
        }

        throw new Error(`Request failed with status ${response.status}`);
      } catch (error) {
        console.error(error);
        if (error instanceof TypeError) {
          setStatus?.('Đã nhận thông tin!', 'success');
          if (typeof onSuccess === 'function') {
            onSuccess();
          }
          form.reset();
          sectionFlow?.reset?.();
          fieldErrors?.clearAll();
        } else {
          setStatus?.('Không gửi được, vui lòng thử lại.', 'error');
        }
      }
    }

    function runSequentialValidation({ form, fieldErrors, setStatus }) {
      if (!form) {
        return { ok: false, section: undefined };
      }
      for (const key of SECTION_FLOW) {
        const result = validateSection(key, form);
        if (!result.valid) {
          if (result.message) {
            fieldErrors?.set(key, result.message);
            setStatus?.(result.message, 'error');
          }
          return { ok: false, section: key };
        }
        fieldErrors?.clear(key);
      }
      if (setStatus?.currentState !== 'success') {
        setStatus?.('');
      }
      return { ok: true };
    }

    function createFieldErrorRegistry(form) {
      const errorNodes = new Map();
      form.querySelectorAll('[data-error-for]').forEach((node) => {
        if (!(node instanceof HTMLElement)) return;
        const key = node.dataset.errorFor;
        if (!key) return;
        errorNodes.set(key, node);
        node.setAttribute('hidden', 'hidden');
      });

      const getGroup = (key) => form.querySelector(`[data-field-group="${key}"]`);

      const set = (key, message = '') => {
        if (!key) return;
        const node = errorNodes.get(key);
        const text = message?.trim() ?? '';
        if (node) {
          if (text) {
            node.textContent = text;
            node.removeAttribute('hidden');
          } else {
            node.textContent = '';
            node.setAttribute('hidden', 'hidden');
          }
        }
        const group = getGroup(key);
        if (group) {
          if (text) {
            group.classList.add('is-invalid');
          } else {
            group.classList.remove('is-invalid');
          }
        }
      };

      const clear = (key) => set(key, '');
      const clearAll = () => {
        errorNodes.forEach((_node, key) => {
          clear(key);
        });
      };

      return { set, clear, clearAll };
    }

    function focusField(field) {
      if (!field) return;
      requestAnimationFrame(() => {
        if (typeof field.scrollIntoView === 'function') {
          field.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'nearest' });
        }
        if (typeof field.focus === 'function') {
          field.focus({ preventScroll: true });
        }
      });
    }

    function getFieldErrorKey(field) {
      if (!field) return '';
      if (field.name) return field.name;
      if (field.dataset?.errorKey) return field.dataset.errorKey;
      const group = field.closest('[data-field-group]');
      return group instanceof HTMLElement ? group.dataset.fieldGroup ?? '' : '';
    }

    function setupSectionFlow(form, fieldErrors) {
      if (!form) return null;
      const completedSections = new Set();

      const handleProgress = (key) => {
        if (!isSectionComplete(key, form)) {
          completedSections.delete(key);
          return;
        }
        if (completedSections.has(key)) {
          return;
        }
        completedSections.add(key);
        fieldErrors?.clear(key);
        const nextKey = getNextSectionKey(key);
        if (nextKey) {
          focusSection(nextKey, form);
        } else {
          const submitButton = form.querySelector('button[type="submit"]');
          focusField(submitButton);
        }
      };

      SECTION_FLOW.forEach((key) => {
        const group = form.querySelector(`[data-field-group="${key}"]`);
        if (!group) return;
        const inputs = group.querySelectorAll('input, select, textarea');
        inputs.forEach((input) => {
          const eventName = input.type === 'radio' || input.type === 'checkbox' ? 'change' : 'input';
          input.addEventListener(eventName, () => handleProgress(key));
        });
      });

      return {
        reset: () => completedSections.clear()
      };
    }

    function isSectionComplete(key, form) {
      switch (key) {
        case 'intent':
        case 'budgetRange':
        case 'legalRisk':
          return Boolean(form.querySelector(`input[name="${key}"]:checked`));
        case 'areas':
          return form.querySelectorAll('input[name="areas"]:checked').length > 0;
        case 'contact': {
          const input = form.querySelector('input[name="contact"]');
          const value = input?.value?.trim() ?? '';
          return PHONE_PATTERN.test(value);
        }
        default:
          return true;
      }
    }

    function validateSection(key, form) {
      switch (key) {
        case 'intent': {
          const checked = form.querySelector('input[name="intent"]:checked');
          return checked ? { valid: true } : { valid: false, message: SECTION_MESSAGES.intent };
        }
        case 'budgetRange': {
          const checked = form.querySelector('input[name="budgetRange"]:checked');
          return checked ? { valid: true } : { valid: false, message: SECTION_MESSAGES.budgetRange };
        }
        case 'areas': {
          const checkedCount = form.querySelectorAll('input[name="areas"]:checked').length;
          if (checkedCount === 0) {
            return { valid: false, message: SECTION_MESSAGES.areas };
          }
          if (checkedCount > AREA_LIMIT) {
            return { valid: false, message: `Chỉ chọn tối đa ${AREA_LIMIT} khu vực.` };
          }
          return { valid: true };
        }
        case 'legalRisk': {
          const checked = form.querySelector('input[name="legalRisk"]:checked');
          return checked ? { valid: true } : { valid: false, message: SECTION_MESSAGES.legalRisk };
        }
        case 'contact': {
          const input = form.querySelector('input[name="contact"]');
          const value = input?.value?.trim() ?? '';
          if (!value) {
            return { valid: false, message: 'Vui lòng nhập số liên hệ.' };
          }
          if (!PHONE_PATTERN.test(value)) {
            return { valid: false, message: 'Số liên hệ phải đủ 10 số và bắt đầu bằng 03, 05, 07, 08, 09 hoặc 01[2|6|8|9].' };
          }
          return { valid: true };
        }
        default:
          return { valid: true };
      }
    }

    function focusSection(key, form) {
      if (!key || !form) return;
      const group = form.querySelector(`[data-field-group="${key}"]`);
      if (!group) return;
      const focusable = group.querySelector('input:not([type="hidden"]), select, textarea, button');
      if (focusable) {
        focusField(focusable);
      }
    }

    function getNextSectionKey(key) {
      const index = SECTION_FLOW.indexOf(key);
      if (index === -1) return undefined;
      return SECTION_FLOW[index + 1];
    }

    function allSectionsValid(form) {
      return SECTION_FLOW.every((key) => validateSection(key, form).valid);
    }

    function applySequentialTabIndex(form) {
      if (!form) return;
      const focusableSelectors = [
        'input:not([type="hidden"]):not(.hp)',
        'select',
        'textarea',
        'button'
      ].join(',');
      const focusables = Array.from(form.querySelectorAll(focusableSelectors));
      let order = 1;
      focusables.forEach((node) => {
        if (node instanceof HTMLInputElement || node instanceof HTMLSelectElement || node instanceof HTMLTextAreaElement || node instanceof HTMLButtonElement) {
          if (node.disabled || node.tabIndex < 0) {
            return;
          }
          node.tabIndex = order;
          order += 1;
        }
      });
    }
  })();
</script> <script type="module">
      const anchors = Array.from(document.querySelectorAll('a[href="#lead-form"]'));
      const portalQueueKey = '__hoaLacLeadPortalQueue__';
      window[portalQueueKey] = window[portalQueueKey] || [];

      const requestPortalOpen = () => {
        window.dispatchEvent(new CustomEvent('lead-form:request-open', {
          detail: { source: 'global-nav' }
        }));

        if (window.__hoaLacLeadPortal?.open) {
          window.__hoaLacLeadPortal.open();
          return;
        }

        window[portalQueueKey].push('open');
      };

      anchors.forEach((anchor) => {
        anchor.addEventListener('click', (event) => {
          const inlineForm = document.getElementById('lead-form');
          if (inlineForm) {
            return;
          }
          event.preventDefault();
          requestPortalOpen();
        });
      });
    </script> <script type="module" src="data:video/mp2t;base64,aW1wb3J0IGluaXRUYWJsZUVuaGFuY2VyIGZyb20gJy4vdGFibGVFbmhhbmNlcic7DQoNCmluaXRUYWJsZUVuaGFuY2VyKHsgc2VsZWN0b3I6ICcucmVhZGluZy1jb250ZW50IHRhYmxlJyB9KTsNCmluaXRUYWJsZUVuaGFuY2VyKHsgc2VsZWN0b3I6ICcucGlsbGFyLWNvbnRlbnQgdGFibGUnIH0pOw0K"></script> </body> </html> 